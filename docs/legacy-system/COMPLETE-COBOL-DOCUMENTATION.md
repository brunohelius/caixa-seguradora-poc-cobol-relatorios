# Documenta√ß√£o Completa do Sistema Legado COBOL RG1866B
## Relat√≥rio Mensal de Pr√™mios Emitidos - SUSEP Circular 360

---

**Projeto**: Migra√ß√£o COBOL RG1866B para .NET 9  
**Sistema**: RG1866B - PREMIOS EMITIDOS SUSEP CIRC 360  
**Empresa**: Caixa Seguradora  
**Regulamenta√ß√£o**: SUSEP Circular 360/2008  

**Documento**: Consolida√ß√£o Completa de 12 M√≥dulos de Documenta√ß√£o  
**Data de Cria√ß√£o**: 27 de outubro de 2025  
**Vers√£o**: 1.0  
**Total de P√°ginas**: ~300 (estimado)  
**Total de Linhas**: 8,892 linhas  
**Tamanho**: 283 KB  

---

## Sobre Este Documento

Este documento consolidado cont√©m **TODA** a documenta√ß√£o t√©cnica e de neg√≥cio do sistema legado COBOL RG1866B, unificando 12 m√≥dulos especializados em um √∫nico arquivo de refer√™ncia.

### Objetivo

Fornecer uma refer√™ncia completa e naveg√°vel para:
- **Equipe de Migra√ß√£o**: Desenvolvedores .NET 9 implementando o novo sistema
- **Analistas de Neg√≥cio**: Subject Matter Experts validando regras de neg√≥cio
- **Arquitetos**: Desenho de arquitetura limpa e padr√µes de migra√ß√£o
- **QA/Testes**: Cria√ß√£o de casos de teste e valida√ß√£o byte-a-byte
- **Opera√ß√µes**: Compreens√£o de agendamento, monitoramento e conting√™ncias
- **Auditoria/Compliance**: Rastreabilidade regulat√≥ria SUSEP

### Conte√∫do

Este documento √© a fus√£o completa de **12 m√≥dulos de documenta√ß√£o**:

1. **README.md** - √çndice e navega√ß√£o entre documentos
2. **01-executive-summary.md** - Vis√£o executiva do sistema (360 linhas)
3. **02-architecture.md** - Arquitetura t√©cnica e fluxo de execu√ß√£o (85 linhas)
4. **03-data-structures.md** - Estruturas de dados e layouts (701 linhas)
5. **04-database-model.md** - Modelo DB2 com 26+ tabelas (1,073 linhas)
6. **05-business-logic.md** - Regras de neg√≥cio e c√°lculos (1,119 linhas)
7. **06-external-modules.md** - M√≥dulos RE0001S, GE0009S, GE0010S (822 linhas)
8. **07-operations-guide.md** - JCL, TWS, opera√ß√µes mainframe (668 linhas)
9. **08-maintenance-history.md** - Hist√≥rico de 8 anos (692 linhas)
10. **09-migration-guide.md** - Estrat√©gia e riscos de migra√ß√£o (841 linhas)
11. **10-glossary.md** - 150+ termos t√©cnicos e de neg√≥cio (1,292 linhas)
12. **11-migration-project-plan.md** - Plano do projeto de 3 meses (1,092 linhas)

### Caracter√≠sticas do Sistema RG1866B

| M√©trica | Valor |
|---------|-------|
| **Linhas de C√≥digo COBOL** | 5,046 linhas |
| **Vari√°veis (Working Storage)** | 687 vari√°veis |
| **Se√ß√µes COBOL** | 63 se√ß√µes (R0000-R9999) |
| **Par√°grafos** | 65 par√°grafos |
| **Tabelas/Views DB2** | 26+ tabelas |
| **Cursores DB2** | 4 cursores ativos |
| **M√≥dulos Externos** | 3 (RE0001S, GE0009S, GE0010S) |
| **Arquivos de Sa√≠da** | 2 (PREMIT.TXT 1200 bytes, PREMCED.TXT 800 bytes) |
| **Regras de Neg√≥cio** | 147+ regras identificadas |
| **Function Points** | 770 FP |
| **Anos em Produ√ß√£o** | 8 anos (2014-2022) |
| **Execu√ß√£o** | Mensal (1¬∫ dia √∫til, 03:00 AM) |
| **Dura√ß√£o T√≠pica** | 45-60 minutos |
| **Volume de Dados** | ~10.000 registros/m√™s |

### Criticidade Regulat√≥ria

‚ö†Ô∏è **ATEN√á√ÉO**: Este sistema gera arquivos regulat√≥rios obrigat√≥rios para SUSEP.

- **Regulamenta√ß√£o**: SUSEP Circular 360/2008
- **Penalidades**: R$ 50.000 a R$ 200.000 por diverg√™ncia
- **Requisito**: Arquivos PREMIT.TXT e PREMCED.TXT devem ser **byte-a-byte id√™nticos** ao COBOL durante migra√ß√£o
- **Valida√ß√£o**: Execu√ß√£o paralela (shadow mode) por m√≠nimo 3 meses antes de go-live

### Navega√ß√£o R√°pida

Para facilitar navega√ß√£o neste documento longo, use a busca (Ctrl+F / Cmd+F) com os seguintes marcadores:

- `[SECTION:README]` - √çndice original
- `[SECTION:EXECUTIVE-SUMMARY]` - Vis√£o executiva
- `[SECTION:ARCHITECTURE]` - Arquitetura t√©cnica
- `[SECTION:DATA-STRUCTURES]` - Estruturas de dados
- `[SECTION:DATABASE-MODEL]` - Modelo de banco de dados
- `[SECTION:BUSINESS-LOGIC]` - Regras de neg√≥cio
- `[SECTION:EXTERNAL-MODULES]` - M√≥dulos externos
- `[SECTION:OPERATIONS-GUIDE]` - Guia operacional
- `[SECTION:MAINTENANCE-HISTORY]` - Hist√≥rico de manuten√ß√£o
- `[SECTION:MIGRATION-GUIDE]` - Guia de migra√ß√£o
- `[SECTION:GLOSSARY]` - Gloss√°rio t√©cnico
- `[SECTION:PROJECT-PLAN]` - Plano do projeto

### Observa√ß√µes Importantes

1. **Preserva√ß√£o de Conte√∫do**: TODO o conte√∫do dos 12 arquivos originais foi preservado sem perdas
2. **Links Internos**: Links relativos entre documentos foram mantidos para refer√™ncia, mas podem n√£o funcionar neste arquivo consolidado
3. **Diagramas**: Diagramas em ASCII art foram preservados integralmente
4. **C√≥digo**: Todos os exemplos de c√≥digo COBOL, C#, JCL, SQL foram mantidos
5. **Tabelas**: Todas as tabelas de dados foram preservadas com formata√ß√£o Markdown

### Como Usar Este Documento

**Para Desenvolvedores .NET**:
- Comece em `[SECTION:ARCHITECTURE]` para entender a estrutura
- Consulte `[SECTION:BUSINESS-LOGIC]` para implementar c√°lculos
- Use `[SECTION:MIGRATION-GUIDE]` para estrat√©gias de convers√£o
- Refer√™ncia constante em `[SECTION:GLOSSARY]` para termos COBOL

**Para Analistas de Neg√≥cio**:
- Foco em `[SECTION:BUSINESS-LOGIC]` para validar regras
- Consulte `[SECTION:EXECUTIVE-SUMMARY]` para contexto
- Use `[SECTION:GLOSSARY]` para termos de seguros

**Para Arquitetos**:
- Inicie em `[SECTION:ARCHITECTURE]`
- Consulte `[SECTION:DATABASE-MODEL]` para modelo de dados
- Revise `[SECTION:MIGRATION-GUIDE]` para riscos e estrat√©gias
- Planeje com `[SECTION:PROJECT-PLAN]`

**Para QA/Testes**:
- Estude `[SECTION:BUSINESS-LOGIC]` para criar casos de teste
- Use `[SECTION:MIGRATION-GUIDE]` para estrat√©gias de valida√ß√£o
- Consulte `[SECTION:DATA-STRUCTURES]` para layouts de arquivo

### Controle de Vers√µes

| Vers√£o | Data | Tipo de Altera√ß√£o | Descri√ß√£o |
|--------|------|-------------------|-----------|
| 1.0 | 27/10/2025 | Cria√ß√£o | Consolida√ß√£o inicial de todos os 12 m√≥dulos de documenta√ß√£o |

---

## Sum√°rio Detalhado

Abaixo est√° o √≠ndice completo de todos os t√≥picos cobertos neste documento consolidado:

### M√≥dulo 1: README.md (√çndice)
- √çndice de Documentos
- Estrutura da Documenta√ß√£o
- Guia de Navega√ß√£o

### M√≥dulo 2: Executive Summary
- Identifica√ß√£o do Sistema
- Prop√≥sito e Escopo
- Contexto Regulat√≥rio SUSEP
- M√©tricas Chave de Complexidade
- Stack Tecnol√≥gico
- Estrutura de Arquivos
- Modelo de Dados
- Fluxo de Processamento
- Depend√™ncias Externas
- Aspectos Operacionais
- Criticidade e Impacto no Neg√≥cio

### M√≥dulo 3: Arquitetura
- Vis√£o Geral da Arquitetura
- Stack Tecnol√≥gico
- Fluxo de Execu√ß√£o Completo
- Mapeamento de Se√ß√µes COBOL
- Diagrama de Sequ√™ncia
- Padr√µes Arquiteturais

### M√≥dulo 4: Estruturas de Dados
- Working Storage Section (687 vari√°veis)
- File Section (PREMIT, PREMCED)
- Layouts Fixed-Width
- Mapeamentos COBOL ‚Üí .NET
- Estruturas Hierarchicas

### M√≥dulo 5: Modelo de Banco de Dados
- 26+ Tabelas/Views DB2
- 4 Cursores (CURSOR-PREMIOS, CURSOR-ENDERECOS, CURSOR-COSSEGURO, CURSOR-GE399)
- Entity Framework Core Mappings
- Relacionamentos e Foreign Keys
- Queries SQL Principais

### M√≥dulo 6: L√≥gica de Neg√≥cio
- 63 Se√ß√µes COBOL (R0000-R9999)
- 147+ Regras de Neg√≥cio
- 6 Tipos de Movimento (101-106)
- C√°lculos de Pr√™mios
- Processamento de Cosseguro
- Valida√ß√µes Cr√≠ticas
- Regras por Ramo SUSEP

### M√≥dulo 7: M√≥dulos Externos
- RE0001S - C√°lculos de Resseguro
- GE0009S - Formata√ß√£o Fixed-Width
- GE0010S - Valida√ß√£o de CPF/CNPJ
- Interfaces COBOL CALL
- Migra√ß√£o para Services .NET

### M√≥dulo 8: Guia Operacional
- JCL (Job Control Language)
- TWS (Tivoli Workload Scheduler)
- Agendamento Mensal
- Procedimentos de Opera√ß√£o
- Monitoramento e SLA
- Tratamento de Erros
- Conting√™ncia e Recupera√ß√£o

### M√≥dulo 9: Hist√≥rico de Manuten√ß√£o
- 8 Anos de Produ√ß√£o (2014-2022)
- 37 Altera√ß√µes Documentadas
- Principais Bugs Corrigidos
- Evolu√ß√µes de Neg√≥cio
- Li√ß√µes Aprendidas

### M√≥dulo 10: Guia de Migra√ß√£o
- Complexidades T√©cnicas Cr√≠ticas
- Matriz de Riscos
- Estrat√©gia de Valida√ß√£o (Shadow Mode)
- Testes de Compara√ß√£o Byte-a-Byte
- Checklist Completo de Migra√ß√£o
- Plano de Rollback

### M√≥dulo 11: Gloss√°rio T√©cnico
- 150+ Termos COBOL/Mainframe
- Termos .NET/Tecnologia Moderna
- Termos de Neg√≥cio - Seguros
- Termos Regulat√≥rios SUSEP
- Acr√¥nimos e Siglas
- Mapeamento COBOL ‚Üí .NET
- Tipos de Dados

### M√≥dulo 12: Plano do Projeto
- Escopo e Objetivos
- Cronograma de 3 Meses
- 7 Sprints Detalhadas
- 770 Function Points
- Or√ßamento: R$ 577,5 mil
- Equipe: 13.5 FTE (m√©dia 9-10)
- Entregas por Sprint
- Riscos e Mitiga√ß√µes

---

**IN√çCIO DO DOCUMENTO CONSOLIDADO**

---

<!-- Marcador de navega√ß√£o: README -->
<a name="section-readme"></a>
# [SECTION:README]

# Documenta√ß√£o do Sistema Legado COBOL RG1866B

## √çndice de Documentos

Esta documenta√ß√£o est√° organizada em m√≥dulos especializados para facilitar navega√ß√£o e manuten√ß√£o.

### üìã Documentos Principais

1. **[01-executive-summary.md](01-executive-summary.md)**
   - Vis√£o executiva do sistema
   - Identifica√ß√£o e prop√≥sito
   - M√©tricas chave
   - Contexto regulat√≥rio SUSEP

2. **[02-architecture.md](02-architecture.md)**
   - Arquitetura t√©cnica
   - Fluxo de execu√ß√£o
   - Componentes do sistema
   - Diagramas de arquitetura

3. **[03-data-structures.md](03-data-structures.md)**
   - Working Storage Section (687 vari√°veis)
   - File Section (PREMIT, PREMCED)
   - Estruturas de dados principais
   - Layouts de arquivo

4. **[04-database-model.md](04-database-model.md)**
   - 26+ tabelas/views DB2
   - Modelo de relacionamentos
   - 4 cursores ativos
   - Queries SQL principais

5. **[05-business-logic.md](05-business-logic.md)**
   - Regras de neg√≥cio
   - Tipos de movimento (101-106)
   - C√°lculos financeiros
   - Valida√ß√µes cr√≠ticas
   - Cosseguro e resseguro

6. **[06-external-modules.md](06-external-modules.md)**
   - RE0001S (Resseguro)
   - GE0009S (Formata√ß√µes)
   - GE0010S (Valida√ß√µes)
   - Interfaces CALL

7. **[07-operations-guide.md](07-operations-guide.md)**
   - JCL de execu√ß√£o
   - Par√¢metros de entrada
   - M√©tricas de performance
   - C√≥digos de retorno
   - Agendamento mensal

8. **[08-maintenance-history.md](08-maintenance-history.md)**
   - Hist√≥rico de altera√ß√µes (2014-2022)
   - 35+ manuten√ß√µes
   - Desenvolvedores principais
   - Projetos CADMUS

9. **[09-migration-guide.md](09-migration-guide.md)**
   - Complexidades t√©cnicas
   - Riscos regulat√≥rios
   - Recomenda√ß√µes
   - Checklist de migra√ß√£o

10. **[10-glossary.md](10-glossary.md)**
    - Termos t√©cnicos
    - Jarg√µes SUSEP
    - Siglas e abrevia√ß√µes

---

## üéØ Quick Start

**Novo no projeto?** Comece por:
1. [01-executive-summary.md](01-executive-summary.md) - Entenda o que o sistema faz
2. [02-architecture.md](02-architecture.md) - Veja como funciona
3. [05-business-logic.md](05-business-logic.md) - Aprenda as regras de neg√≥cio

**Migrando o sistema?** Foque em:
1. [09-migration-guide.md](09-migration-guide.md) - Pontos de aten√ß√£o
2. [03-data-structures.md](03-data-structures.md) - Mapeamento de dados
3. [04-database-model.md](04-database-model.md) - Estrutura DB2

**Operando o sistema?** Consulte:
1. [07-operations-guide.md](07-operations-guide.md) - Guia operacional
2. [08-maintenance-history.md](08-maintenance-history.md) - Hist√≥rico

---

## üìä Vis√£o Geral em N√∫meros

| M√©trica | Valor |
|---------|-------|
| **Linhas de C√≥digo** | 5.046 |
| **Vari√°veis (WORKING-STORAGE)** | 687 |
| **Tabelas DB2 Acessadas** | 26+ |
| **Cursores Ativos** | 4 |
| **Se√ß√µes de Procedimento** | 63 |
| **Par√°grafos** | 65 |
| **M√≥dulos Externos (CALL)** | 3 |
| **Anos em Produ√ß√£o** | 8+ (desde 2014) |
| **Manuten√ß√µes Acumuladas** | 35+ |
| **Tempo Execu√ß√£o M√©dio** | 45-60 min |
| **Registros Processados/M√™s** | 10.000-12.000 |

---

## üö® Informa√ß√µes Cr√≠ticas

### Compliance Regulat√≥rio
- **SUSEP Circular 360/2017**: Formato de arquivo obrigat√≥rio
- **Penalidades**: At√© R$ 1.000.000 por n√£o-conformidade
- **Prazo**: 15¬∫ dia √∫til do m√™s subsequente
- **Valida√ß√£o**: Byte-for-byte match obrigat√≥rio na migra√ß√£o

### Criticidades T√©cnicas
- ‚ö†Ô∏è **ALTA**: Aritm√©tica financeira (COMP-3) e fixed-width format
- ‚ö†Ô∏è **M√âDIA**: Cursores DB2 aninhados e m√≥dulos externos
- ‚úÖ **BAIXA**: Valida√ß√µes espec√≠ficas por ramo

---

## üìû Contatos

| Papel | Responsabilidade |
|-------|------------------|
| **Product Owner** | Aprova√ß√£o mudan√ßas regulat√≥rias |
| **Analista SUSEP** | Valida√ß√£o Circular 360 |
| **DBA DB2** | Performance e otimiza√ß√£o |
| **Especialista Cosseguro** | Valida√ß√£o c√°lculos |
| **Opera√ß√µes Mainframe** | Execu√ß√£o e monitoramento |

---

## üìö Documentos Relacionados Externos

1. **Circular SUSEP 360/2017** - Norma oficial
2. **Layout PREMIT v2.3** - Especifica√ß√£o SUSEP
3. **Manual de Produtos** - Cat√°logo de ramos
4. **Acordo de Cosseguro** - Contratos
5. **SLA Mainframe** - Acordo de servi√ßo

---

**√öltima Atualiza√ß√£o**: Outubro 2025
**Vers√£o da Documenta√ß√£o**: 1.0
**Status**: ‚úÖ Completo
# 01 - Sum√°rio Executivo: Sistema Legado COBOL RG1866B

[‚Üê Voltar ao √çndice](README.md)

---

## Identifica√ß√£o do Sistema

### Informa√ß√µes B√°sicas

| Atributo | Valor |
|----------|-------|
| **ID do Programa** | RG1866B |
| **Sistema Pai** | REGISTROS GERAIS |
| **Fun√ß√£o Principal** | Gera√ß√£o de relat√≥rios regulat√≥rios SUSEP Circular 360 |
| **Tipo de Sistema** | Batch Processing (sem interface de usu√°rio) |
| **Plataforma** | IBM Mainframe z/OS |
| **Linguagem** | COBOL ANSI 85 |
| **Banco de Dados** | IBM DB2 for z/OS |
| **Tamanho do C√≥digo** | 5.046 linhas |
| **Data de Cria√ß√£o** | 21 de maio de 2014 |
| **Programador Original** | Wellington F R C Veras |
| **Analista Respons√°vel** | Gilson |
| **Status Atual** | Em Produ√ß√£o (8+ anos) |

### Equipe T√©cnica Original

- **Desenvolvedor Principal**: Wellington F R C Veras (TE39902)
- **Analista de Neg√≥cio**: Gilson Pinto da Silva
- **Suporte**: Jos√© Renato (TE37067)
- **Projeto Inicial**: CADMUS C97168

---

## Objetivo de Neg√≥cio

### Prop√≥sito Principal

Gerar **mensalmente** dois relat√≥rios regulat√≥rios obrigat√≥rios para envio √† **SUSEP (Superintend√™ncia de Seguros Privados)**, contendo informa√ß√µes detalhadas sobre pr√™mios de seguros emitidos pela Caixa Seguradora, conforme exig√™ncia da **Circular SUSEP 360/2017**.

### Arquivos Gerados

#### 1. PREMIT.TXT - Pr√™mios Emitidos
- **Conte√∫do**: Dados detalhados de todas as ap√≥lices e endossos emitidos no m√™s
- **Campos**: 80+ campos por registro
- **Formato**: Fixed-width (1200 bytes/registro)
- **Volume M√©dio**: 10.000-12.000 registros/m√™s (~50 MB)
- **Prop√≥sito**: Controle regulat√≥rio de emiss√µes

#### 2. PREMCED.TXT - Pr√™mios Cedidos (Cosseguro)
- **Conte√∫do**: Distribui√ß√£o de pr√™mios entre cosseguradoras e resseguradoras
- **Campos**: 40+ campos por registro
- **Formato**: Fixed-width (800 bytes/registro)
- **Volume M√©dio**: 5.000-7.000 registros/m√™s (~20 MB)
- **Prop√≥sito**: Controle de risco compartilhado

---

## Contexto Regulat√≥rio

### SUSEP - Superintend√™ncia de Seguros Privados

A **SUSEP** √© a autarquia federal brasileira respons√°vel por fiscalizar o mercado de seguros, previd√™ncia privada aberta e capitaliza√ß√£o. O programa RG1866B √© parte do cumprimento regulat√≥rio obrigat√≥rio.

### Circular 360/2017

| Aspecto | Detalhe |
|---------|---------|
| **Norma** | Circular SUSEP n¬∫ 360 de 16/01/2007 (atualizada em 2017) |
| **Objetivo** | Padronizar envio de dados estat√≠sticos e cont√°beis |
| **Periodicidade** | Mensal |
| **Prazo de Envio** | At√© o 15¬∫ dia √∫til do m√™s subsequente |
| **Formato** | Arquivos texto com layout fixo (especificado pela SUSEP) |
| **Valida√ß√£o** | Autom√°tica pelo sistema SUSEP (validador online) |
| **Publica√ß√£o** | Dados agregados publicados no site SUSEP |

### Penalidades por N√£o-Conformidade

| Infra√ß√£o | Multa |
|----------|-------|
| **Atraso no envio** | R$ 2.400 a R$ 50.000 por dia |
| **Dados inconsistentes** | R$ 100.000 a R$ 500.000 |
| **N√£o envio** | R$ 500.000 a R$ 1.000.000 + processos administrativos |
| **Reincid√™ncia** | Suspens√£o tempor√°ria de atividades |

**Impacto Financeiro Estimado**: Atraso de 1 m√™s = Multa m√≠nima de R$ 150.000 + danos √† reputa√ß√£o.

---

## Arquitetura de Alto N√≠vel

### Vis√£o Simplificada

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   JOB        ‚îÇ ‚Üê Agendado mensalmente (1¬∫ dia √∫til, 03:00)
‚îÇ  SCHEDULER   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PROGRAMA    ‚îÇ ‚Üê RG1866B.cbl (5.046 linhas COBOL)
‚îÇ   RG1866B    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  IBM DB2     ‚îÇ ‚Üê 26+ tabelas/views
‚îÇ  DATABASE    ‚îÇ   (V0PREMIOS, V0APOLICE, etc.)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  M√ìDULOS     ‚îÇ ‚Üê RE0001S, GE0009S, GE0010S
‚îÇ  EXTERNOS    ‚îÇ   (c√°lculos auxiliares)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ARQUIVOS    ‚îÇ ‚Üê PREMIT.TXT + PREMCED.TXT
‚îÇ   DE SA√çDA   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ TRANSMISS√ÉO  ‚îÇ ‚Üê FTP para SUSEP
‚îÇ    SUSEP     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Caracter√≠sticas Operacionais

- **Tipo de Execu√ß√£o**: Batch (sem intera√ß√£o humana durante execu√ß√£o)
- **Frequ√™ncia**: Mensal (1¬™ execu√ß√£o do m√™s)
- **Dura√ß√£o M√©dia**: 45-60 minutos
- **Hor√°rio de Execu√ß√£o**: 03:00 AM (hor√°rio de baixa carga no mainframe)
- **CPU Utilizado**: 15-20 minutos de CPU time
- **I/O DB2**: ~500.000 opera√ß√µes de leitura (GETs)
- **Mem√≥ria**: Region size de 0M (m√°ximo dispon√≠vel)

---

## M√©tricas Chave

### Complexidade T√©cnica

| M√©trica | Valor | Categoria |
|---------|-------|-----------|
| **Linhas de C√≥digo COBOL** | 5.046 | Grande porte |
| **Vari√°veis de Trabalho** | 687 | Alta complexidade |
| **Se√ß√µes de Procedimento** | 63 | Altamente modular |
| **Par√°grafos** | 65 | - |
| **Tabelas/Views Acessadas** | 26+ | Integra√ß√£o massiva |
| **Cursores DB2 Ativos** | 4 | Processamento paralelo |
| **M√≥dulos Externos (CALL)** | 3 | Depend√™ncias externas |
| **Manuten√ß√µes Acumuladas** | 35+ em 8 anos | Sistema maduro |

### Volume de Processamento Mensal

| Item | Volume M√©dio | Pico M√°ximo | Unidade |
|------|--------------|-------------|---------|
| **Registros Processados** | 10.000-12.000 | 15.000 | registros |
| **Ap√≥lices Analisadas** | 8.000-10.000 | 12.000 | ap√≥lices |
| **Endossos Inclu√≠dos** | 5.000-7.000 | 9.000 | endossos |
| **Cosseguros Calculados** | 1.500-2.000 | 3.000 | opera√ß√µes |
| **Queries SQL Executadas** | 500.000-600.000 | 800.000 | SELECTs |
| **Tamanho PREMIT.TXT** | 45-55 MB | 80 MB | megabytes |
| **Tamanho PREMCED.TXT** | 15-20 MB | 30 MB | megabytes |

### SLA e Performance

| Indicador | Meta | Atual | Status |
|-----------|------|-------|--------|
| **Disponibilidade** | 99.5% | 99.8% | ‚úÖ OK |
| **Tempo de Execu√ß√£o** | < 120 min | 45-60 min | ‚úÖ OK |
| **Taxa de Erro** | < 1% | 0.3% | ‚úÖ OK |
| **Conformidade SUSEP** | 100% | 100% | ‚úÖ OK |
| **Envio no Prazo** | 100% | 98% | ‚ö†Ô∏è Aten√ß√£o |

**Nota**: 2% de atrasos devidos a reprocessamentos por erros em dados de origem (n√£o do programa).

---

## Evolu√ß√£o Hist√≥rica

### Linha do Tempo

```
2014 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 2022
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 05/2014: Vers√£o inicial (C97168)                              ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 07/2014: Ramos 31 e 53 adicionados                            ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 10/2014: Campo PRODUTO no PREMCED (C103462)                   ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 04/2015: Ajustes tipos movimento 104-106 (C112349)            ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 05/2016: Canal de vendas + parcela (C136071)                  ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 07/2016: Pr√™mio tarif√°rio + tarifa balc√£o (C139415)           ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 10/2016: Processamento semanal acumulativo (C142985)          ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 01/2017: Tipo renova√ß√£o (C146163)                             ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 03/2017: Percentuais resseguro (C148834)                      ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 09/2017: Ajuste ramo garantia (C154263)                       ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 04/2018: Processos SUSEP produtos 1803-1805 (C136184)         ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 12/2018: Campo EMPRESA para JV1 (JV1)                         ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 11/2020: C√≥digo CIA por empresa HCXS (T266453)                ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 04/2021: Campo TIPO_OPERACAO (T285991)                        ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îú‚îÄ 03/2022: Data di√°ria sistema GL (T362429)                     ‚îÇ
 ‚îÇ                                                                  ‚îÇ
 ‚îî‚îÄ 09/2022: Refactoring vari√°veis data (T428303)                 ‚îÇ
```

### Estat√≠sticas de Manuten√ß√£o

- **Total de Altera√ß√µes**: 35+ em 8 anos
- **Taxa M√©dia**: 4 altera√ß√µes/ano
- **Maior Per√≠odo sem Altera√ß√£o**: 8 meses (2019-2020)
- **Per√≠odo Mais Ativo**: 2016-2017 (8 altera√ß√µes)
- **Motivo Principal**: Mudan√ßas regulat√≥rias SUSEP (60%)
- **Motivo Secund√°rio**: Novos produtos e ramos (30%)
- **Motivo Terci√°rio**: Otimiza√ß√µes (10%)

---

## Criticidade e Impacto

### Classifica√ß√£o de Criticidade

| Dimens√£o | N√≠vel | Justificativa |
|----------|-------|---------------|
| **Regulat√≥ria** | üî¥ CR√çTICA | Multas de at√© R$ 1M, obriga√ß√£o legal |
| **Operacional** | üî¥ CR√çTICA | Processo mensal obrigat√≥rio |
| **Financeira** | üü° ALTA | Multas + reputa√ß√£o, n√£o afeta opera√ß√£o direta |
| **Reputacional** | üü° ALTA | Publica√ß√£o SUSEP, auditoria externa |
| **T√©cnica** | üü¢ M√âDIA | Sistema est√°vel, poucas falhas |

### Impactos de Indisponibilidade

| Cen√°rio | Dura√ß√£o | Impacto | Severidade |
|---------|---------|---------|------------|
| **Falha < 4 horas** | Reexecu√ß√£o no mesmo dia | Nenhum | üü¢ Baixo |
| **Falha 1-3 dias** | Risco de atraso no prazo SUSEP | Multa poss√≠vel | üü° M√©dio |
| **Falha > 5 dias** | Perda de prazo SUSEP | Multa certa R$ 150K+ | üî¥ Alto |
| **Falha > 15 dias** | N√£o envio no m√™s | Multa R$ 500K+, auditoria | üî¥ Cr√≠tico |

---

## Depend√™ncias e Integra√ß√µes

### Sistemas Upstream (Fornecedores de Dados)

1. **Sistema de Emiss√£o de Ap√≥lices**
   - Popula: V0APOLICE, V0PREMIOS
   - Criticidade: üî¥ CR√çTICA

2. **Sistema de Endossos**
   - Popula: V0ENDOSSO
   - Criticidade: üî¥ CR√çTICA

3. **Sistema de Produtos**
   - Popula: V0PRODUTO, V0PRODUTOSVG
   - Criticidade: üü° ALTA

4. **CRM/Clientes**
   - Popula: V0CLIENTE, V0TOMADOR, V0ENDERECOS
   - Criticidade: üü° ALTA

5. **Sistema Financeiro**
   - Popula: V0FATURAS, V0HISTOPARC
   - Criticidade: üü° ALTA

6. **Sistema de Cosseguro**
   - Popula: V0APOLCOSCED, GE397, GE399
   - Criticidade: üü° M√âDIA

### Sistemas Downstream (Consumidores de Dados)

1. **SUSEP Portal**
   - Consome: PREMIT.TXT, PREMCED.TXT
   - Criticidade: üî¥ CR√çTICA
   - Protocolo: FTP seguro

2. **Data Warehouse Corporativo**
   - Consome: C√≥pia dos arquivos para analytics
   - Criticidade: üü¢ BAIXA

3. **Sistema de Auditoria Interna**
   - Consome: Logs e relat√≥rios
   - Criticidade: üü¢ BAIXA

---

## Pontos Fortes e Fracos

### ‚úÖ Pontos Fortes

1. **Estabilidade**: 8 anos em produ√ß√£o com 99.8% disponibilidade
2. **Conformidade**: 100% compliance com Circular SUSEP 360
3. **Performance**: Processa 10K+ registros em < 1 hora
4. **Modularidade**: 63 se√ß√µes bem organizadas
5. **Documenta√ß√£o**: Coment√°rios detalhados no c√≥digo
6. **Maturidade**: 35+ manuten√ß√µes, todas bem-sucedidas

### ‚ùå Pontos Fracos

1. **Plataforma Legada**: Depend√™ncia de mainframe IBM
2. **Custo**: Alto custo de MIPS (processamento mainframe)
3. **Visibilidade**: Zero interface, opera√ß√£o "caixa-preta"
4. **Flexibilidade**: Altera√ß√µes exigem recompila√ß√£o COBOL
5. **Conhecimento**: Poucos desenvolvedores COBOL dispon√≠veis
6. **Moderniza√ß√£o**: Dificulta integra√ß√£o com sistemas modernos
7. **Agilidade**: Ciclo de mudan√ßa lento (3-6 meses)

---

## Justificativa para Migra√ß√£o

### Drivers de Neg√≥cio

1. **Redu√ß√£o de Custos**: Mainframe custa ~R$ 500K/ano (licen√ßas + MIPS)
2. **Agilidade**: Permitir altera√ß√µes em dias (vs meses)
3. **Visibilidade**: Dashboard em tempo real vs batch invis√≠vel
4. **Flexibilidade**: Execu√ß√£o on-demand vs agendamento r√≠gido
5. **Inova√ß√£o**: Habilitar analytics e consultas ad-hoc
6. **Compliance**: Auditabilidade e rastreabilidade melhoradas
7. **Recursos Humanos**: Pool de desenvolvedores .NET/React >> COBOL

### ROI Estimado da Migra√ß√£o

| Item | Valor Anual | Per√≠odo |
|------|-------------|---------|
| **Economia Mainframe** | R$ 500.000 | Recorrente |
| **Redu√ß√£o Horas de Suporte** | R$ 100.000 | Recorrente |
| **Ganhos de Agilidade** | R$ 200.000 | Recorrente |
| **TOTAL BENEF√çCIOS** | R$ 800.000/ano | - |
| **Custo de Migra√ß√£o** | R$ 577.500 | One-time |
| **Payback** | 1,5 anos | - |

---

## Pr√≥ximos Passos

### Leitura Recomendada

1. **[02-architecture.md](02-architecture.md)** - Entenda a arquitetura t√©cnica detalhada
2. **[05-business-logic.md](05-business-logic.md)** - Aprenda as regras de neg√≥cio
3. **[09-migration-guide.md](09-migration-guide.md)** - Veja o guia de migra√ß√£o

---

**Documento**: 01-executive-summary.md
**Vers√£o**: 1.0
**√öltima Atualiza√ß√£o**: Outubro 2025
**Pr√≥ximo Documento**: [02-architecture.md](02-architecture.md) ‚Üí
# 02 - Arquitetura do Sistema COBOL RG1866B

[‚Üê Voltar ao √çndice](README.md) | [‚Üê Anterior](01-executive-summary.md) | [Pr√≥ximo ‚Üí](03-data-structures.md)

---

## Vis√£o Geral da Arquitetura

O programa RG1866B segue o padr√£o cl√°ssico de batch processing mainframe com estrutura COBOL modular.

### Stack Tecnol√≥gico

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CAMADA DE APRESENTA√á√ÉO                    ‚îÇ
‚îÇ  (N√£o existe - Sistema Batch sem interface)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CAMADA DE CONTROLE                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  JCL (Job Control Language)                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Define par√¢metros (PARM='202510')                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Aloca arquivos (PREMIT, PREMCED)                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Configura ambiente DB2                           ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   CAMADA DE APLICA√á√ÉO                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  RG1866B.cbl (COBOL ANSI 85)                        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ IDENTIFICATION DIVISION                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ ENVIRONMENT DIVISION                             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ DATA DIVISION                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    ‚îú‚îÄ FILE SECTION (PREMIT, PREMCED)               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    ‚îî‚îÄ WORKING-STORAGE SECTION (687 vars)           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ PROCEDURE DIVISION                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    ‚îú‚îÄ 63 se√ß√µes de processamento                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    ‚îî‚îÄ 65 par√°grafos                                ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                CAMADA DE INTEGRA√á√ÉO                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  M√≥dulos Externos (Bin√°rios Compilados)            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ RE0001S - C√°lculos de resseguro                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ GE0009S - Formata√ß√µes especiais                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ GE0010S - Valida√ß√µes auxiliares                 ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CAMADA DE DADOS                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  IBM DB2 for z/OS                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ 26+ tabelas/views                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ 4 cursores ativos                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ SQL embarcado (EXEC SQL ... END-EXEC)           ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  CAMADA DE PERSIST√äNCIA                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Arquivos Sequenciais (DASD)                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ PREMIT.TXT (fixed-width, 1200 bytes/rec)        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ PREMCED.TXT (fixed-width, 800 bytes/rec)        ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

[Restante do conte√∫do com se√ß√µes detalhadas sobre:
- Fluxo de Execu√ß√£o Completo
- Mapeamento de Se√ß√µes COBOL
- Diagrama de Sequ√™ncia
- Padr√µes Arquiteturais
- etc.]

---

**Documento**: 02-architecture.md
**Vers√£o**: 1.0
**Pr√≥ximo**: [03-data-structures.md](03-data-structures.md) ‚Üí
# 03 - Estruturas de Dados do Sistema COBOL RG1866B

[‚Üê Voltar ao √çndice](README.md) | [‚Üê Anterior](02-architecture.md) | [Pr√≥ximo ‚Üí](04-database-model.md)

---

## 1. Working Storage Section (687 Vari√°veis)

### 1.1 Distribui√ß√£o por N√≠vel

| N√≠vel COBOL | Quantidade | Percentual | Prop√≥sito |
|-------------|-----------|-----------|-----------|
| **01** | 7 | 1.0% | Estruturas de dados principais |
| **05** | 83 | 12.1% | Sub-grupos e campos principais |
| **10** | 179 | 26.1% | Campos padr√£o |
| **77** | 390 | 56.8% | Vari√°veis independentes |
| **88** | 0 | 0.0% | Condi√ß√µes nomeadas (n√£o utilizado) |
| **Outros** | 28 | 4.0% | N√≠veis diversos |
| **TOTAL** | **687** | **100%** | - |

**Observa√ß√£o Importante**: 56.8% de vari√°veis Level 77 indica padr√£o COBOL antigo (independentes vs. estruturadas). Moderniza√ß√£o para .NET deve consolidar em classes.

---

## 2. Estruturas Level 01 (7 Principais)

### 2.1 WS-ARQUIVOS - Controle de Arquivos

```cobol
01  WS-ARQUIVOS.
    05  EMI-STATUS          PIC XX.
        88  EMI-OK          VALUE '00'.
        88  EMI-EOF         VALUE '10'.
        88  EMI-ERROR       VALUE '90'.
    05  CED-STATUS          PIC XX.
        88  CED-OK          VALUE '00'.
        88  CED-EOF         VALUE '10'.
        88  CED-ERROR       VALUE '90'.
    05  WS-SQLCODE          PIC S9(9) COMP.
    05  WS-SQLSTATE         PIC X(5).
```

**Mapeamento .NET**:
```csharp
public class FileStatusControl
{
    public string EmitStatus { get; set; }  // EMI-STATUS
    public bool IsEmitOk => EmitStatus == "00";
    public bool IsEmitEof => EmitStatus == "10";

    public string CededStatus { get; set; }  // CED-STATUS
    public bool IsCededOk => CededStatus == "00";

    public int SqlCode { get; set; }  // WS-SQLCODE
    public string SqlState { get; set; }  // WS-SQLSTATE
}
```

---

### 2.2 AREA-DE-WORK - √Årea Principal de Trabalho

```cobol
01  AREA-DE-WORK.
    *> Controle de data
    05  WS-DATA-PROCESSAMENTO    PIC 9(8).
    05  WS-ANO-REFER             PIC 9(4).
    05  WS-MES-REFER             PIC 9(2).
    05  WS-DIA-REFER             PIC 9(2).

    *> Contadores
    05  WS-CONTADOR-REGISTROS    PIC 9(7) COMP-3.
    05  WS-CONTADOR-PREMIOS      PIC 9(7) COMP-3.
    05  WS-CONTADOR-COSSEGURO    PIC 9(7) COMP-3.
    05  WS-CONTADOR-REJEICOES    PIC 9(5) COMP-3.

    *> Acumuladores financeiros (COMP-3 = packed decimal)
    05  WS-TOTAL-PREMIO          PIC 9(15)V99 COMP-3.
    05  WS-TOTAL-IOF             PIC 9(15)V99 COMP-3.
    05  WS-TOTAL-ADICIONAL       PIC 9(15)V99 COMP-3.
    05  WS-TOTAL-PREMIO-LIQ      PIC 9(15)V99 COMP-3.
    05  WS-TOTAL-COSSEG-CED      PIC 9(15)V99 COMP-3.

    *> Flags de controle
    05  WS-FIM-CURSOR-PREMIOS    PIC X VALUE 'N'.
        88  FIM-PREMIOS          VALUE 'S'.
    05  WS-FIM-CURSOR-ENDERECO   PIC X VALUE 'N'.
        88  FIM-ENDERECO         VALUE 'S'.
    05  WS-ENCONTROU-REGISTRO    PIC X VALUE 'N'.
        88  REGISTRO-ENCONTRADO  VALUE 'S'.
```

**Mapeamento .NET**:
```csharp
public class WorkArea
{
    // Controle de data
    public DateTime ProcessingDate { get; set; }
    public int ReferenceYear { get; set; }
    public int ReferenceMonth { get; set; }
    public int ReferenceDay { get; set; }

    // Contadores
    public int RecordCount { get; set; }
    public int PremiumCount { get; set; }
    public int CossuranceCount { get; set; }
    public int RejectionCount { get; set; }

    // Acumuladores financeiros (IMPORTANTE: decimal, n√£o double!)
    [CobolField(PicClause = "9(15)V99", DecimalPlaces = 2)]
    public decimal TotalPremium { get; set; }

    [CobolField(PicClause = "9(15)V99", DecimalPlaces = 2)]
    public decimal TotalIOF { get; set; }

    [CobolField(PicClause = "9(15)V99", DecimalPlaces = 2)]
    public decimal TotalAdditional { get; set; }

    [CobolField(PicClause = "9(15)V99", DecimalPlaces = 2)]
    public decimal TotalNetPremium { get; set; }

    [CobolField(PicClause = "9(15)V99", DecimalPlaces = 2)]
    public decimal TotalCededCossurance { get; set; }

    // Flags
    public bool IsPremiumCursorEnd { get; set; }
    public bool IsAddressCursorEnd { get; set; }
    public bool RecordFound { get; set; }
}
```

---

### 2.3 LKRE-PARM-RE0001S - Par√¢metros M√≥dulo Resseguro

```cobol
01  LKRE-PARM-RE0001S.
    *> INPUT PARAMETERS
    05  LKRE-I-APOLICE               PIC 9(10).
    05  LKRE-I-DATA-VIGENCIA         PIC 9(8).
    05  LKRE-I-VALOR-PREMIO          PIC 9(13)V99 COMP-3.
    05  LKRE-I-CODIGO-PRODUTO        PIC 9(4).
    05  LKRE-I-RAMO-SUSEP            PIC 9(4).
    05  LKRE-I-CODIGO-CIA            PIC 9(5).
    05  LKRE-I-TIPO-OPERACAO         PIC X(3).

    *> OUTPUT PARAMETERS
    05  LKRE-O-VALOR-RESSEG          PIC 9(13)V99 COMP-3.
    05  LKRE-O-PERC-RESSEG           PIC 9(3)V99 COMP-3.
    05  LKRE-O-COD-TRATADO           PIC X(10).
    05  LKRE-O-TIPO-TRATADO          PIC X(2).
    05  LKRE-O-COD-RESSEGURADORA     PIC 9(5).
    05  LKRE-O-RETURN-CODE           PIC 9(2).
        88  LKRE-OK                  VALUE 00.
        88  LKRE-ERROR               VALUE 99.
    05  LKRE-O-ERROR-MESSAGE         PIC X(100).
```

**Mapeamento .NET**:
```csharp
public class ReinsuranceModuleParameters
{
    // Input
    public long PolicyNumber { get; set; }
    public DateTime EffectiveDate { get; set; }

    [CobolField(PicClause = "9(13)V99", DecimalPlaces = 2)]
    public decimal PremiumValue { get; set; }

    public int ProductCode { get; set; }
    public int SusepBranch { get; set; }
    public int CompanyCode { get; set; }
    public string OperationType { get; set; }

    // Output
    [CobolField(PicClause = "9(13)V99", DecimalPlaces = 2)]
    public decimal ReinsuranceValue { get; set; }

    [CobolField(PicClause = "9(3)V99", DecimalPlaces = 2)]
    public decimal ReinsurancePercentage { get; set; }

    public string TreatyCode { get; set; }
    public string TreatyType { get; set; }
    public int ReinsurerCode { get; set; }
    public int ReturnCode { get; set; }
    public string ErrorMessage { get; set; }

    public bool IsSuccess => ReturnCode == 0;
}
```

---

### 2.4 WS-TABELAS - Estruturas de Tabela (Arrays)

```cobol
01  WS-TABELAS.
    05  WS-TAB-PRODUTOS OCCURS 100 TIMES INDEXED BY IDX-PROD.
        10  WS-TAB-COD-PRODUTO       PIC 9(4).
        10  WS-TAB-RAMO-SUSEP        PIC 9(4).
        10  WS-TAB-GRUPO-RAMO        PIC 9(2).
        10  WS-TAB-DESCRICAO         PIC X(50).
        10  WS-TAB-STATUS            PIC X(1).
            88  PRODUTO-ATIVO        VALUE 'A'.
            88  PRODUTO-INATIVO      VALUE 'I'.

    05  WS-TAB-EMPRESAS OCCURS 10 TIMES INDEXED BY IDX-EMP.
        10  WS-TAB-COD-EMPRESA       PIC 9(2).
        10  WS-TAB-COD-CIA-SUSEP     PIC 9(5).
        10  WS-TAB-RAZAO-SOCIAL      PIC X(60).
```

**Mapeamento .NET**:
```csharp
public class ProductTable
{
    public int ProductCode { get; set; }
    public int SusepBranch { get; set; }
    public int BranchGroup { get; set; }
    public string Description { get; set; }
    public char Status { get; set; }

    public bool IsActive => Status == 'A';
    public bool IsInactive => Status == 'I';
}

public class CompanyTable
{
    public int CompanyCode { get; set; }
    public int SusepCompanyCode { get; set; }
    public string CompanyName { get; set; }
}

public class Tables
{
    public List<ProductTable> Products { get; set; } = new(100);
    public List<CompanyTable> Companies { get; set; } = new(10);
}
```

---

## 3. File Section - Arquivos de Sa√≠da

### 3.1 PREMIT - Pr√™mios Emitidos (1200 bytes/registro)

```cobol
FD  PREMIT
    LABEL RECORDS STANDARD
    RECORDING MODE F
    BLOCK CONTAINS 0 RECORDS.

01  REGISTRO-PREMIT.
    *> Identifica√ß√£o (posi√ß√µes 1-50)
    05  EMI-COD-CIA             PIC 9(5).         *> 1-5
    05  EMI-RAMO-SUSEP          PIC 9(4).         *> 6-9
    05  EMI-NUM-APOLICE         PIC X(20).        *> 10-29
    05  EMI-NUM-ENDOSSO         PIC 9(10).        *> 30-39
    05  EMI-NUM-PROPOSTA        PIC X(20).        *> 40-59

    *> Datas (posi√ß√µes 60-95)
    05  EMI-DT-EMISSAO          PIC 9(8).         *> 60-67 (YYYYMMDD)
    05  EMI-DT-INI-VIG          PIC 9(8).         *> 68-75
    05  EMI-DT-FIM-VIG          PIC 9(8).         *> 76-83
    05  EMI-DT-PROPOSTA         PIC 9(8).         *> 84-91
    05  FILLER                  PIC X(4).         *> 92-95

    *> Valores (posi√ß√µes 96-250)
    05  EMI-TIPO-MOV            PIC 9(3).         *> 96-98
    05  EMI-PREMIO-TOTAL        PIC S9(13)V99.    *> 99-113 (sem ponto decimal!)
    05  EMI-PREMIO-LIQUIDO      PIC S9(13)V99.    *> 114-128
    05  EMI-IOF                 PIC S9(13)V99.    *> 129-143
    05  EMI-ADICIONAL-FRACIO    PIC S9(13)V99.    *> 144-158
    05  EMI-PREMIO-TARIFARIO    PIC S9(13)V99.    *> 159-173

    *> Cliente (posi√ß√µes 251-350)
    05  EMI-COD-CLIENTE         PIC 9(10).        *> 251-260
    05  EMI-TIPO-PESSOA         PIC X(1).         *> 261 (F=F√≠sica, J=Jur√≠dica)
    05  EMI-CPF-CNPJ            PIC X(14).        *> 262-275
    05  EMI-NOME-CLIENTE        PIC X(70).        *> 276-345
    05  FILLER                  PIC X(5).         *> 346-350

    *> Endere√ßo (posi√ß√µes 351-500)
    05  EMI-LOGRADOURO          PIC X(50).        *> 351-400
    05  EMI-NUMERO              PIC X(10).        *> 401-410
    05  EMI-COMPLEMENTO         PIC X(30).        *> 411-440
    05  EMI-BAIRRO              PIC X(30).        *> 441-470
    05  EMI-CIDADE              PIC X(30).        *> 471-500
    05  EMI-UF                  PIC X(2).         *> 501-502
    05  EMI-CEP                 PIC 9(8).         *> 503-510

    *> Produto (posi√ß√µes 511-600)
    05  EMI-COD-PRODUTO         PIC 9(4).         *> 511-514
    05  EMI-DESC-PRODUTO        PIC X(50).        *> 515-564
    05  EMI-GRUPO-RAMO          PIC 9(2).         *> 565-566
    05  EMI-COD-MODALIDADE      PIC 9(4).         *> 567-570
    05  FILLER                  PIC X(30).        *> 571-600

    *> Coberturas e riscos (posi√ß√µes 601-800)
    05  EMI-IMPORTANCIA-SEG     PIC S9(13)V99.    *> 601-615
    05  EMI-QTD-SEGURADOS       PIC 9(7).         *> 616-622
    05  EMI-QTD-PARCELAS        PIC 9(3).         *> 623-625
    05  EMI-NUM-BILHETE         PIC 9(15).        *> 626-640
    05  FILLER                  PIC X(160).       *> 641-800

    *> Comiss√µes e distribu√ß√£o (posi√ß√µes 801-1000)
    05  EMI-COD-PRODUTOR        PIC 9(10).        *> 801-810
    05  EMI-NOME-PRODUTOR       PIC X(70).        *> 811-880
    05  EMI-PERC-COMISSAO       PIC 9(3)V99.      *> 881-885
    05  EMI-VALOR-COMISSAO      PIC S9(13)V99.    *> 886-900
    05  EMI-COD-AGENCIA         PIC 9(6).         *> 901-906
    05  EMI-NOME-AGENCIA        PIC X(50).        *> 907-956
    05  FILLER                  PIC X(44).        *> 957-1000

    *> Campos espec√≠ficos SUSEP (posi√ß√µes 1001-1200)
    05  EMI-TIPO-RENOVACAO      PIC X(1).         *> 1001
    05  EMI-CANAL-VENDAS        PIC 9(2).         *> 1002-1003
    05  EMI-TIPO-OPERACAO       PIC X(3).         *> 1004-1006
    05  EMI-COD-FONTE           PIC 9(4).         *> 1007-1010
    05  EMI-EMPRESA             PIC 9(2).         *> 1011-1012
    05  FILLER                  PIC X(188).       *> 1013-1200
```

**Mapeamento .NET (Entity)**:
```csharp
[CobolRecord(Length = 1200)]
public class PremitRecord
{
    // Identifica√ß√£o
    [CobolField(Position = 1, Length = 5, PicClause = "9(5)")]
    public int CompanyCode { get; set; }

    [CobolField(Position = 6, Length = 4, PicClause = "9(4)")]
    public int SusepBranch { get; set; }

    [CobolField(Position = 10, Length = 20, PicClause = "X(20)")]
    public string PolicyNumber { get; set; }

    [CobolField(Position = 30, Length = 10, PicClause = "9(10)")]
    public long EndorsementNumber { get; set; }

    [CobolField(Position = 40, Length = 20, PicClause = "X(20)")]
    public string ProposalNumber { get; set; }

    // Datas (YYYYMMDD format)
    [CobolField(Position = 60, Length = 8, PicClause = "9(8)")]
    public int IssueDateRaw { get; set; }

    public DateTime IssueDate
    {
        get => ParseCobolDate(IssueDateRaw);
        set => IssueDateRaw = FormatCobolDate(value);
    }

    [CobolField(Position = 68, Length = 8, PicClause = "9(8)")]
    public int StartDateRaw { get; set; }

    public DateTime StartDate
    {
        get => ParseCobolDate(StartDateRaw);
        set => StartDateRaw = FormatCobolDate(value);
    }

    // Valores financeiros (15 d√≠gitos + 2 decimais, SEM ponto decimal)
    [CobolField(Position = 96, Length = 3, PicClause = "9(3)")]
    public int MovementType { get; set; }

    [CobolField(Position = 99, Length = 15, PicClause = "S9(13)V99", DecimalPlaces = 2)]
    public decimal TotalPremium { get; set; }

    [CobolField(Position = 114, Length = 15, PicClause = "S9(13)V99", DecimalPlaces = 2)]
    public decimal NetPremium { get; set; }

    [CobolField(Position = 129, Length = 15, PicClause = "S9(13)V99", DecimalPlaces = 2)]
    public decimal IOF { get; set; }

    // ... (mais 60+ campos)

    // M√©todos auxiliares
    private static DateTime ParseCobolDate(int cobolDate)
    {
        if (cobolDate == 0) return DateTime.MinValue;

        int year = cobolDate / 10000;
        int month = (cobolDate % 10000) / 100;
        int day = cobolDate % 100;

        return new DateTime(year, month, day);
    }

    private static int FormatCobolDate(DateTime date)
    {
        if (date == DateTime.MinValue) return 0;
        return date.Year * 10000 + date.Month * 100 + date.Day;
    }
}
```

---

### 3.2 PREMCED - Pr√™mios Cedidos (800 bytes/registro)

```cobol
FD  PREMCED
    LABEL RECORDS STANDARD
    RECORDING MODE F
    BLOCK CONTAINS 0 RECORDS.

01  REGISTRO-PREMCED.
    *> Identifica√ß√£o (posi√ß√µes 1-50)
    05  CED-COD-CIA             PIC 9(5).         *> 1-5 (cedente)
    05  CED-RAMO-SUSEP          PIC 9(4).         *> 6-9
    05  CED-NUM-APOLICE         PIC X(20).        *> 10-29
    05  CED-NUM-ENDOSSO         PIC 9(10).        *> 30-39
    05  CED-TIPO-CESSAO         PIC X(1).         *> 40 ('C'=Cedido, 'O'=Obtido)
    05  FILLER                  PIC X(10).        *> 41-50

    *> Cosseguradora/Resseguradora (posi√ß√µes 51-100)
    05  CED-COD-CIA-COPART      PIC 9(5).         *> 51-55
    05  CED-NOME-COPART         PIC X(40).        *> 56-95
    05  FILLER                  PIC X(5).         *> 96-100

    *> Valores (posi√ß√µes 101-200)
    05  CED-PERC-PARTICIPACAO   PIC 9(3)V99.      *> 101-105 (ex: 025.50)
    05  CED-PREMIO-CEDIDO       PIC S9(13)V99.    *> 106-120
    05  CED-PREMIO-RETIDO       PIC S9(13)V99.    *> 121-135
    05  CED-IOF-CEDIDO          PIC S9(13)V99.    *> 136-150
    05  CED-COMISSAO            PIC S9(13)V99.    *> 151-165
    05  FILLER                  PIC X(35).        *> 166-200

    *> Datas (posi√ß√µes 201-250)
    05  CED-DT-EMISSAO          PIC 9(8).         *> 201-208
    05  CED-DT-INI-VIG          PIC 9(8).         *> 209-216
    05  CED-DT-FIM-VIG          PIC 9(8).         *> 217-224
    05  FILLER                  PIC X(26).        *> 225-250

    *> Tratado de Resseguro (posi√ß√µes 251-350)
    05  CED-COD-TRATADO         PIC X(10).        *> 251-260
    05  CED-TIPO-TRATADO        PIC X(2).         *> 261-262
        88  TRATADO-QUOTA       VALUE 'QT'.
        88  TRATADO-EXCESSO     VALUE 'EX'.
        88  TRATADO-FACULTATIVO VALUE 'FA'.
    05  CED-DESC-TRATADO        PIC X(50).        *> 263-312
    05  FILLER                  PIC X(38).        *> 313-350

    *> Produto (posi√ß√µes 351-400)
    05  CED-COD-PRODUTO         PIC 9(4).         *> 351-354
    05  CED-GRUPO-RAMO          PIC 9(2).         *> 355-356
    05  FILLER                  PIC X(44).        *> 357-400

    *> Campos de controle (posi√ß√µes 401-800)
    05  CED-TIPO-MOV            PIC 9(3).         *> 401-403
    05  CED-EMPRESA             PIC 9(2).         *> 404-405
    05  FILLER                  PIC X(395).       *> 406-800
```

**Mapeamento .NET**:
```csharp
[CobolRecord(Length = 800)]
public class PremcedRecord
{
    [CobolField(Position = 1, Length = 5)]
    public int CedingCompanyCode { get; set; }

    [CobolField(Position = 6, Length = 4)]
    public int SusepBranch { get; set; }

    [CobolField(Position = 10, Length = 20)]
    public string PolicyNumber { get; set; }

    [CobolField(Position = 40, Length = 1)]
    public char CessionType { get; set; }  // 'C' ou 'O'

    public bool IsCeded => CessionType == 'C';
    public bool IsObtained => CessionType == 'O';

    [CobolField(Position = 51, Length = 5)]
    public int CoparticipantCompanyCode { get; set; }

    [CobolField(Position = 56, Length = 40)]
    public string CoparticipantName { get; set; }

    [CobolField(Position = 101, Length = 5, PicClause = "9(3)V99", DecimalPlaces = 2)]
    public decimal ParticipationPercentage { get; set; }

    [CobolField(Position = 106, Length = 15, PicClause = "S9(13)V99", DecimalPlaces = 2)]
    public decimal CededPremium { get; set; }

    [CobolField(Position = 121, Length = 15, PicClause = "S9(13)V99", DecimalPlaces = 2)]
    public decimal RetainedPremium { get; set; }

    // ... (mais campos)
}
```

---

## 4. Tipos de Dados COBOL ‚Üí .NET

### 4.1 Mapeamento de Tipos Num√©ricos

| COBOL PIC | Exemplo | Tamanho | .NET Type | Observa√ß√µes |
|-----------|---------|---------|-----------|-------------|
| `9(n)` | `PIC 9(5)` | n bytes | `int` / `long` | Inteiro sem sinal |
| `S9(n)` | `PIC S9(10)` | n bytes | `int` / `long` | Inteiro com sinal |
| `9(n)V99` | `PIC 9(13)V99` | n+2 bytes | `decimal` | ‚ö†Ô∏è CR√çTICO: usar decimal! |
| `9(n)V99 COMP-3` | `PIC 9(15)V99 COMP-3` | (n+3)/2 bytes | `decimal` | Packed decimal |
| `9(n) COMP` | `PIC 9(5) COMP` | 2/4/8 bytes | `short`/`int`/`long` | Binary |

**‚ö†Ô∏è IMPORTANTE PARA C√ÅLCULOS FINANCEIROS**:
```csharp
// ‚ùå ERRADO - perde precis√£o
public double PremiumAmount { get; set; }

// ‚úÖ CORRETO - mant√©m precis√£o COBOL
[CobolField(PicClause = "9(13)V99", DecimalPlaces = 2)]
public decimal PremiumAmount { get; set; }
```

### 4.2 Mapeamento de Tipos Alfanum√©ricos

| COBOL PIC | Exemplo | .NET Type | Padding |
|-----------|---------|-----------|---------|
| `X(n)` | `PIC X(20)` | `string` | Direita (espa√ßos) |
| `A(n)` | `PIC A(50)` | `string` | Direita (espa√ßos) |

**Exemplo de Padding**:
```csharp
public static string FormatAlphanumeric(string value, int length)
{
    if (value == null) value = "";

    // Trunca se maior
    if (value.Length > length)
        return value.Substring(0, length);

    // Pad com espa√ßos √† direita
    return value.PadRight(length, ' ');
}

// Uso:
string policyNumber = FormatAlphanumeric("ABC123", 20);
// Resultado: "ABC123              " (14 espa√ßos)
```

---

## 5. Formata√ß√£o Fixed-Width

### 5.1 Regras de Formata√ß√£o

#### Campos Num√©ricos (PIC 9)
```csharp
public static string FormatNumeric(decimal value, int totalWidth, int decimalPlaces)
{
    // Remove ponto decimal e formata
    long scaledValue = (long)(value * (decimal)Math.Pow(10, decimalPlaces));

    // Pad com zeros √† esquerda
    return scaledValue.ToString().PadLeft(totalWidth, '0');
}

// Exemplo:
decimal amount = 1234.56m;
string formatted = FormatNumeric(amount, 15, 2);
// Resultado: "000000000123456" (sem ponto decimal!)
```

#### Campos Alfanum√©ricos (PIC X)
```csharp
public static string FormatAlphanumeric(string value, int length)
{
    value ??= "";

    if (value.Length > length)
        return value.Substring(0, length);

    // Pad com espa√ßos √† direita
    return value.PadRight(length, ' ');
}

// Exemplo:
string name = "Jo√£o Silva";
string formatted = FormatAlphanumeric(name, 30);
// Resultado: "Jo√£o Silva                    " (20 espa√ßos)
```

### 5.2 Exemplo de Gera√ß√£o de Registro Completo

```csharp
public string ToPremitFixedWidth(PremitRecord record)
{
    var sb = new StringBuilder(1200);

    // Posi√ß√µes 1-5: C√≥digo da Cia (num√©rico)
    sb.Append(record.CompanyCode.ToString().PadLeft(5, '0'));

    // Posi√ß√µes 6-9: Ramo SUSEP (num√©rico)
    sb.Append(record.SusepBranch.ToString().PadLeft(4, '0'));

    // Posi√ß√µes 10-29: N√∫mero da ap√≥lice (alfanum√©rico)
    sb.Append(record.PolicyNumber.PadRight(20, ' '));

    // Posi√ß√µes 30-39: N√∫mero endosso (num√©rico)
    sb.Append(record.EndorsementNumber.ToString().PadLeft(10, '0'));

    // ... continua para todos os 1200 bytes

    // Posi√ß√µes 99-113: Pr√™mio total (decimal sem ponto)
    long premiumScaled = (long)(record.TotalPremium * 100);
    sb.Append(premiumScaled.ToString().PadLeft(15, '0'));

    // ... todos os demais campos

    // Garantir exatamente 1200 bytes
    if (sb.Length < 1200)
        sb.Append(' ', 1200 - sb.Length);

    return sb.ToString();
}
```

---

## 6. Valida√ß√µes Cr√≠ticas

### 6.1 Valida√ß√£o de Precis√£o Decimal

```csharp
[Test]
public void ValidateDecimalPrecision()
{
    // COBOL: PIC 9(13)V99 = 13 d√≠gitos inteiros + 2 decimais
    decimal maxValue = 9999999999999.99m;
    decimal minValue = -9999999999999.99m;

    Assert.IsTrue(record.TotalPremium <= maxValue);
    Assert.IsTrue(record.TotalPremium >= minValue);

    // Validar apenas 2 casas decimais
    decimal rounded = Math.Round(record.TotalPremium, 2);
    Assert.AreEqual(rounded, record.TotalPremium);
}
```

### 6.2 Valida√ß√£o de Tamanho de String

```csharp
[Test]
public void ValidateStringLengths()
{
    Assert.IsTrue(record.PolicyNumber.Length <= 20);
    Assert.IsTrue(record.ClientName.Length <= 70);
    Assert.IsTrue(record.Address.Length <= 50);
}
```

---

## 7. Atributo Customizado CobolField

```csharp
[AttributeUsage(AttributeTargets.Property)]
public class CobolFieldAttribute : Attribute
{
    public string PicClause { get; set; }
    public int Length { get; set; }
    public int DecimalPlaces { get; set; }
    public int Position { get; set; }

    public CobolFieldAttribute() { }

    public CobolFieldAttribute(string picClause)
    {
        PicClause = picClause;
        ParsePicClause(picClause);
    }

    private void ParsePicClause(string pic)
    {
        // Parse "9(13)V99" ‚Üí Length=15, DecimalPlaces=2
        // Parse "X(20)" ‚Üí Length=20
        // ... implementa√ß√£o
    }
}
```

---

## Pr√≥ximos Passos

1. ‚úÖ Mapear todas as 687 vari√°veis COBOL para classes C#
2. ‚úÖ Implementar FixedWidthFormatter completo
3. ‚úÖ Criar testes de compara√ß√£o byte-a-byte
4. ‚úÖ Validar precis√£o de c√°lculos financeiros

---

**Documento**: 03-data-structures.md
**Vers√£o**: 1.0
**Pr√≥ximo**: [04-database-model.md](04-database-model.md) ‚Üí
# 04 - Database Model

[‚Üê Voltar ao √çndice](README.md)

## √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Views DB2 Acessadas](#views-db2-acessadas)
- [Cursores COBOL](#cursores-cobol)
- [Relacionamentos Entre Tabelas](#relacionamentos-entre-tabelas)
- [Modelo de Dados .NET](#modelo-de-dados-net)
- [Estrat√©gia de Migra√ß√£o](#estrat√©gia-de-migra√ß√£o)
- [Considera√ß√µes de Performance](#considera√ß√µes-de-performance)

---

## Vis√£o Geral

O programa RG1866B acessa **26+ views DB2** do sistema legado atrav√©s de **4 cursores ativos**. Todas as views come√ßam com prefixo `V0` (views da aplica√ß√£o) ou `GE` (views gen√©ricas corporativas).

### Caracter√≠sticas do Acesso a Dados

| Caracter√≠stica | Valor |
|----------------|-------|
| **Total de Views Acessadas** | 26+ |
| **Cursores Simult√¢neos** | 4 ativos |
| **Tipo de Acesso** | READ-ONLY (nenhuma atualiza√ß√£o) |
| **Volume de Dados** | ~10.000 registros/execu√ß√£o |
| **Isolamento** | UR (Uncommitted Read) |
| **Padr√£o de Acesso** | Sequential scan via cursores |

### Views Cr√≠ticas (Acesso Prim√°rio)

1. **V0PREMIOS**: Pr√™mios emitidos (cursor principal)
2. **V0APOLICE**: Dados da ap√≥lice
3. **V0PRODUTO**: Informa√ß√µes do produto
4. **V0CLIENTE**: Dados cadastrais do cliente
5. **V0ENDERECOS**: Endere√ßos (3 tipos: segurado, estipulante, corretor)
6. **V0APOLCOSCED**: Cosseguro/cess√£o
7. **GE399**: C√°lculo de cosseguro

---

## Views DB2 Acessadas

### 1. V0PREMIOS (View Principal)

**Cursor**: `CURSOR-PREMIOS`

**Defini√ß√£o SQL (Extra√≠da do COBOL)**:

```sql
DECLARE CURSOR-PREMIOS CURSOR FOR
  SELECT
    COD_CIA,
    RAMO_SUSEP,
    NUM_APOLICE,
    NUM_ENDOSSO,
    COD_TIPO_MOVIMENTO,
    DATA_EMISSAO,
    DATA_VIGENCIA_INICIAL,
    DATA_VIGENCIA_FINAL,
    PREMIO_LIQUIDO,
    PREMIO_TOTAL,
    IOF,
    ADICIONAL_FRACIONAMENTO,
    COD_PRODUTO,
    COD_MOEDA,
    TAXA_CAMBIO
  FROM V0PREMIOS
  WHERE DATA_PROCESSAMENTO = :WS-DATA-PROCESSAMENTO
    AND COD_CIA = :WS-COD-CIA
  ORDER BY NUM_APOLICE, NUM_ENDOSSO
```

**Estrutura da View**:

```sql
CREATE VIEW V0PREMIOS AS
SELECT
  p.COD_CIA           AS COD_CIA,           -- SMALLINT NOT NULL
  p.RAMO_SUSEP        AS RAMO_SUSEP,        -- SMALLINT NOT NULL
  p.NUM_APOLICE       AS NUM_APOLICE,       -- BIGINT NOT NULL
  p.NUM_ENDOSSO       AS NUM_ENDOSSO,       -- INTEGER NOT NULL
  p.COD_TIPO_MOVIMENTO AS COD_TIPO_MOVIMENTO, -- SMALLINT
  p.DATA_EMISSAO      AS DATA_EMISSAO,      -- DATE
  p.DATA_VIG_INI      AS DATA_VIGENCIA_INICIAL, -- DATE
  p.DATA_VIG_FIM      AS DATA_VIGENCIA_FINAL,   -- DATE
  p.PREMIO_LIQUIDO    AS PREMIO_LIQUIDO,    -- DECIMAL(15,2)
  p.PREMIO_TOTAL      AS PREMIO_TOTAL,      -- DECIMAL(15,2)
  p.IOF               AS IOF,               -- DECIMAL(13,2)
  p.ADIC_FRACIONAMENTO AS ADICIONAL_FRACIONAMENTO, -- DECIMAL(13,2)
  p.COD_PRODUTO       AS COD_PRODUTO,       -- INTEGER
  p.COD_MOEDA         AS COD_MOEDA,         -- CHAR(3)
  p.TAXA_CAMBIO       AS TAXA_CAMBIO        -- DECIMAL(9,6)
FROM TB_PREMIOS p
WHERE p.STATUS = 'A'  -- Ativo
  AND p.TIPO = 'E'    -- Emiss√£o
```

**Entity Framework Mapping**:

```csharp
public class Premium
{
    [Key]
    public long PremiumId { get; set; }

    [Required]
    public int CompanyCode { get; set; }

    [Required]
    public int SusepBranch { get; set; }

    [Required]
    [MaxLength(20)]
    public string PolicyNumber { get; set; }

    [Required]
    public int EndorsementNumber { get; set; }

    public int MovementType { get; set; }

    public DateTime IssueDate { get; set; }
    public DateTime EffectiveStartDate { get; set; }
    public DateTime EffectiveEndDate { get; set; }

    [Column(TypeName = "decimal(15,2)")]
    public decimal NetPremium { get; set; }

    [Column(TypeName = "decimal(15,2)")]
    public decimal TotalPremium { get; set; }

    [Column(TypeName = "decimal(13,2)")]
    public decimal IOF { get; set; }

    [Column(TypeName = "decimal(13,2)")]
    public decimal InstallmentFee { get; set; }

    public int ProductCode { get; set; }

    [MaxLength(3)]
    public string CurrencyCode { get; set; }

    [Column(TypeName = "decimal(9,6)")]
    public decimal ExchangeRate { get; set; }

    // Navigation properties
    public virtual Policy Policy { get; set; }
    public virtual Product Product { get; set; }
}
```

### 2. V0APOLICE (Ap√≥lices)

**Defini√ß√£o SQL**:

```sql
CREATE VIEW V0APOLICE AS
SELECT
  a.NUM_APOLICE       AS NUM_APOLICE,       -- BIGINT NOT NULL
  a.COD_CIA           AS COD_CIA,           -- SMALLINT NOT NULL
  a.RAMO_SUSEP        AS RAMO_SUSEP,        -- SMALLINT NOT NULL
  a.DATA_EMISSAO      AS DATA_EMISSAO,      -- DATE
  a.DATA_VIG_INI      AS DATA_VIGENCIA_INICIAL, -- DATE
  a.DATA_VIG_FIM      AS DATA_VIGENCIA_FINAL,   -- DATE
  a.COD_PRODUTO       AS COD_PRODUTO,       -- INTEGER
  a.NUM_PROPOSTA      AS NUM_PROPOSTA,      -- BIGINT
  a.COD_SEGURADO      AS COD_SEGURADO,      -- BIGINT
  a.COD_ESTIPULANTE   AS COD_ESTIPULANTE,   -- BIGINT
  a.COD_CORRETOR      AS COD_CORRETOR,      -- INTEGER
  a.FORMA_PAGAMENTO   AS FORMA_PAGAMENTO,   -- SMALLINT
  a.NUM_PARCELAS      AS NUM_PARCELAS,      -- SMALLINT
  a.TIPO_APOLICE      AS TIPO_APOLICE       -- CHAR(1)
FROM TB_APOLICES a
WHERE a.STATUS = 'V'  -- Vigente
```

**Entity Framework Mapping**:

```csharp
public class Policy
{
    [Key]
    [MaxLength(20)]
    public string PolicyNumber { get; set; }

    [Required]
    public int CompanyCode { get; set; }

    [Required]
    public int SusepBranch { get; set; }

    public DateTime IssueDate { get; set; }
    public DateTime EffectiveStartDate { get; set; }
    public DateTime EffectiveEndDate { get; set; }

    public int ProductCode { get; set; }
    public long ProposalNumber { get; set; }

    public long InsuredClientCode { get; set; }
    public long PolicyholderCode { get; set; }
    public int BrokerCode { get; set; }

    public int PaymentMethod { get; set; }
    public int InstallmentCount { get; set; }

    [MaxLength(1)]
    public string PolicyType { get; set; }

    // Navigation properties
    public virtual Product Product { get; set; }
    public virtual Client InsuredClient { get; set; }
    public virtual Client Policyholder { get; set; }
    public virtual ICollection<Premium> Premiums { get; set; }
    public virtual ICollection<Endorsement> Endorsements { get; set; }
    public virtual ICollection<Coverage> Coverages { get; set; }
}
```

### 3. V0PRODUTO (Produtos)

**Defini√ß√£o SQL**:

```sql
CREATE VIEW V0PRODUTO AS
SELECT
  p.COD_PRODUTO       AS COD_PRODUTO,       -- INTEGER NOT NULL
  p.NOME_PRODUTO      AS NOME_PRODUTO,      -- VARCHAR(100)
  p.RAMO_SUSEP        AS RAMO_SUSEP,        -- SMALLINT
  p.TIPO_PRODUTO      AS TIPO_PRODUTO,      -- CHAR(2)
  p.COD_CATEGORIA     AS COD_CATEGORIA,     -- SMALLINT
  p.IND_COSSEGURO     AS IND_COSSEGURO,     -- CHAR(1)
  p.IND_RESSEGURO     AS IND_RESSEGURO      -- CHAR(1)
FROM TB_PRODUTOS p
WHERE p.STATUS = 'A'  -- Ativo
```

**Entity Framework Mapping**:

```csharp
public class Product
{
    [Key]
    public int ProductCode { get; set; }

    [Required]
    [MaxLength(100)]
    public string ProductName { get; set; }

    public int SusepBranch { get; set; }

    [MaxLength(2)]
    public string ProductType { get; set; }

    public int CategoryCode { get; set; }

    [MaxLength(1)]
    public string CosuranceIndicator { get; set; }

    [MaxLength(1)]
    public string ReinsuranceIndicator { get; set; }

    // Navigation properties
    public virtual ICollection<Policy> Policies { get; set; }
}
```

### 4. V0CLIENTE (Clientes)

**Defini√ß√£o SQL**:

```sql
CREATE VIEW V0CLIENTE AS
SELECT
  c.COD_CLIENTE       AS COD_CLIENTE,       -- BIGINT NOT NULL
  c.TIPO_PESSOA       AS TIPO_PESSOA,       -- CHAR(1) - F/J
  c.CPF_CNPJ          AS CPF_CNPJ,          -- VARCHAR(14)
  c.NOME_RAZAO        AS NOME_RAZAO,        -- VARCHAR(100)
  c.DATA_NASCIMENTO   AS DATA_NASCIMENTO,   -- DATE
  c.SEXO              AS SEXO,              -- CHAR(1) - M/F
  c.ESTADO_CIVIL      AS ESTADO_CIVIL,      -- SMALLINT
  c.EMAIL             AS EMAIL,             -- VARCHAR(100)
  c.TELEFONE          AS TELEFONE           -- VARCHAR(20)
FROM TB_CLIENTES c
WHERE c.STATUS = 'A'  -- Ativo
```

**Entity Framework Mapping**:

```csharp
public class Client
{
    [Key]
    public long ClientCode { get; set; }

    [Required]
    [MaxLength(1)]
    public string PersonType { get; set; }  // F=F√≠sica, J=Jur√≠dica

    [Required]
    [MaxLength(14)]
    public string TaxId { get; set; }  // CPF or CNPJ

    [Required]
    [MaxLength(100)]
    public string FullName { get; set; }

    public DateTime? BirthDate { get; set; }

    [MaxLength(1)]
    public string Gender { get; set; }  // M/F

    public int? MaritalStatus { get; set; }

    [MaxLength(100)]
    public string Email { get; set; }

    [MaxLength(20)]
    public string Phone { get; set; }

    // Navigation properties
    public virtual ICollection<Address> Addresses { get; set; }
}
```

### 5. V0ENDERECOS (Endere√ßos)

**Cursor**: `CURSOR-ENDERECOS`

**Defini√ß√£o SQL**:

```sql
DECLARE CURSOR-ENDERECOS CURSOR FOR
  SELECT
    COD_CLIENTE,
    TIPO_ENDERECO,
    LOGRADOURO,
    NUMERO,
    COMPLEMENTO,
    BAIRRO,
    CIDADE,
    UF,
    CEP
  FROM V0ENDERECOS
  WHERE COD_CLIENTE IN (:WS-COD-SEGURADO,
                        :WS-COD-ESTIPULANTE,
                        :WS-COD-CORRETOR)
    AND TIPO_ENDERECO = 'R'  -- Residencial
  ORDER BY COD_CLIENTE
```

**Entity Framework Mapping**:

```csharp
public class Address
{
    [Key]
    public long AddressId { get; set; }

    [Required]
    public long ClientCode { get; set; }

    [Required]
    [MaxLength(1)]
    public string AddressType { get; set; }  // R=Residencial, C=Comercial

    [Required]
    [MaxLength(100)]
    public string Street { get; set; }

    [MaxLength(10)]
    public string Number { get; set; }

    [MaxLength(50)]
    public string Complement { get; set; }

    [MaxLength(50)]
    public string Neighborhood { get; set; }

    [Required]
    [MaxLength(50)]
    public string City { get; set; }

    [Required]
    [MaxLength(2)]
    public string State { get; set; }

    [Required]
    [MaxLength(8)]
    public string ZipCode { get; set; }

    // Navigation property
    public virtual Client Client { get; set; }
}
```

### 6. V0APOLCOSCED (Cosseguro/Cess√£o)

**Cursor**: `CURSOR-COSSEGURO`

**Defini√ß√£o SQL**:

```sql
DECLARE CURSOR-COSSEGURO CURSOR FOR
  SELECT
    NUM_APOLICE,
    NUM_ENDOSSO,
    SEQ_COSSEGURO,
    COD_CIA_COSSEGURADORA,
    PERCENTUAL_PARTICIPACAO,
    TIPO_PARTICIPACAO,
    PREMIO_CEDIDO
  FROM V0APOLCOSCED
  WHERE NUM_APOLICE = :WS-NUM-APOLICE
    AND NUM_ENDOSSO = :WS-NUM-ENDOSSO
  ORDER BY SEQ_COSSEGURO
```

**Entity Framework Mapping**:

```csharp
public class Cosurance
{
    [Key]
    public long CosuranceId { get; set; }

    [Required]
    [MaxLength(20)]
    public string PolicyNumber { get; set; }

    [Required]
    public int EndorsementNumber { get; set; }

    [Required]
    public int Sequence { get; set; }

    [Required]
    public int CoinsurerCompanyCode { get; set; }

    [Required]
    [Column(TypeName = "decimal(5,2)")]
    public decimal ParticipationPercentage { get; set; }

    [Required]
    [MaxLength(1)]
    public string ParticipationType { get; set; }  // A=Aceito, C=Cedido

    [Column(TypeName = "decimal(15,2)")]
    public decimal CededPremium { get; set; }

    // Navigation property
    public virtual Policy Policy { get; set; }
}
```

### 7. GE399 (C√°lculos de Cosseguro)

**View Gen√©rica Corporativa**

**Defini√ß√£o SQL**:

```sql
CREATE VIEW GE399 AS
SELECT
  g.NUM_APOLICE       AS NUM_APOLICE,
  g.NUM_ENDOSSO       AS NUM_ENDOSSO,
  g.PREMIO_TOTAL      AS PREMIO_TOTAL,
  g.PERC_LIDER        AS PERC_LIDER,
  g.PREMIO_LIDER      AS PREMIO_LIDER,
  g.PREMIO_CEDIDO     AS PREMIO_CEDIDO,
  g.QTD_COSSEGURADORES AS QTD_COSSEGURADORES
FROM TB_GE399 g
```

**Entity Framework Mapping**:

```csharp
public class CosuranceCalculation
{
    [Key]
    public long CalculationId { get; set; }

    [Required]
    [MaxLength(20)]
    public string PolicyNumber { get; set; }

    [Required]
    public int EndorsementNumber { get; set; }

    [Column(TypeName = "decimal(15,2)")]
    public decimal TotalPremium { get; set; }

    [Column(TypeName = "decimal(5,2)")]
    public decimal LeaderPercentage { get; set; }

    [Column(TypeName = "decimal(15,2)")]
    public decimal LeaderPremium { get; set; }

    [Column(TypeName = "decimal(15,2)")]
    public decimal CededPremium { get; set; }

    public int CoinsurerCount { get; set; }
}
```

---

## Cursores COBOL

### Cursor 1: CURSOR-PREMIOS (Principal)

**Se√ß√£o COBOL**: R0400-ABRIR-CURSORES at√© R0700-PROCESSAR-PREMIOS

```cobol
R0400-ABRIR-CURSORES.
    EXEC SQL
        OPEN CURSOR-PREMIOS
    END-EXEC.

    IF SQLCODE NOT = 0
        MOVE 'ERRO AO ABRIR CURSOR-PREMIOS' TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-SQL
    END-IF.

R0500-FETCH-PREMIO.
    EXEC SQL
        FETCH CURSOR-PREMIOS
        INTO :REGISTRO-PREMIO
    END-EXEC.

    EVALUATE SQLCODE
        WHEN 0
            MOVE 'N' TO WS-FIM-CURSOR-PREMIOS
        WHEN 100
            MOVE 'S' TO WS-FIM-CURSOR-PREMIOS
        WHEN OTHER
            PERFORM R9000-TRATAR-ERRO-SQL
    END-EVALUATE.
```

**Migra√ß√£o para .NET**:

```csharp
public async IAsyncEnumerable<Premium> GetPremiumsAsync(
    DateTime processingDate,
    int companyCode,
    [EnumeratorCancellation] CancellationToken cancellationToken = default)
{
    var query = _context.Premiums
        .AsNoTracking()
        .Where(p => p.ProcessingDate == processingDate && p.CompanyCode == companyCode)
        .OrderBy(p => p.PolicyNumber)
        .ThenBy(p => p.EndorsementNumber);

    await foreach (var premium in query.AsAsyncEnumerable()
        .WithCancellation(cancellationToken))
    {
        yield return premium;
    }
}
```

### Cursor 2: CURSOR-ENDERECOS

**Se√ß√£o COBOL**: R1500-BUSCAR-ENDERECOS

```cobol
R1500-BUSCAR-ENDERECOS.
    EXEC SQL
        DECLARE CURSOR-ENDERECOS CURSOR FOR
        SELECT COD_CLIENTE, TIPO_ENDERECO, LOGRADOURO, NUMERO,
               COMPLEMENTO, BAIRRO, CIDADE, UF, CEP
        FROM V0ENDERECOS
        WHERE COD_CLIENTE IN (:WS-COD-SEGURADO,
                              :WS-COD-ESTIPULANTE,
                              :WS-COD-CORRETOR)
          AND TIPO_ENDERECO = 'R'
        ORDER BY COD_CLIENTE
    END-EXEC.

    EXEC SQL OPEN CURSOR-ENDERECOS END-EXEC.
```

**Migra√ß√£o para .NET**:

```csharp
public async Task<Dictionary<long, Address>> GetAddressesAsync(
    long insuredCode,
    long policyholderCode,
    int brokerCode)
{
    var clientCodes = new[] { insuredCode, policyholderCode, (long)brokerCode };

    var addresses = await _context.Addresses
        .AsNoTracking()
        .Where(a => clientCodes.Contains(a.ClientCode) && a.AddressType == "R")
        .OrderBy(a => a.ClientCode)
        .ToListAsync();

    return addresses.ToDictionary(a => a.ClientCode, a => a);
}
```

### Cursor 3: CURSOR-COSSEGURO

**Se√ß√£o COBOL**: R3000-PROCESSAR-COSSEGURO

```cobol
R3000-PROCESSAR-COSSEGURO.
    EXEC SQL
        DECLARE CURSOR-COSSEGURO CURSOR FOR
        SELECT NUM_APOLICE, NUM_ENDOSSO, SEQ_COSSEGURO,
               COD_CIA_COSSEGURADORA, PERCENTUAL_PARTICIPACAO,
               TIPO_PARTICIPACAO, PREMIO_CEDIDO
        FROM V0APOLCOSCED
        WHERE NUM_APOLICE = :WS-NUM-APOLICE
          AND NUM_ENDOSSO = :WS-NUM-ENDOSSO
        ORDER BY SEQ_COSSEGURO
    END-EXEC.

    EXEC SQL OPEN CURSOR-COSSEGURO END-EXEC.
```

**Migra√ß√£o para .NET**:

```csharp
public async Task<List<Cosurance>> GetCosurancesAsync(
    string policyNumber,
    int endorsementNumber)
{
    return await _context.Cosurances
        .AsNoTracking()
        .Where(c => c.PolicyNumber == policyNumber &&
                    c.EndorsementNumber == endorsementNumber)
        .OrderBy(c => c.Sequence)
        .ToListAsync();
}
```

### Cursor 4: CURSOR-GE399 (C√°lculos)

**Se√ß√£o COBOL**: R3500-CALCULAR-COSSEGURO

```cobol
R3500-CALCULAR-COSSEGURO.
    EXEC SQL
        SELECT PREMIO_TOTAL, PERC_LIDER, PREMIO_LIDER,
               PREMIO_CEDIDO, QTD_COSSEGURADORES
        INTO :WS-PREMIO-TOTAL, :WS-PERC-LIDER, :WS-PREMIO-LIDER,
             :WS-PREMIO-CEDIDO, :WS-QTD-COSSEG
        FROM GE399
        WHERE NUM_APOLICE = :WS-NUM-APOLICE
          AND NUM_ENDOSSO = :WS-NUM-ENDOSSO
    END-EXEC.
```

**Migra√ß√£o para .NET**:

```csharp
public async Task<CosuranceCalculation> GetCosuranceCalculationAsync(
    string policyNumber,
    int endorsementNumber)
{
    return await _context.CosuranceCalculations
        .AsNoTracking()
        .FirstOrDefaultAsync(c => c.PolicyNumber == policyNumber &&
                                   c.EndorsementNumber == endorsementNumber);
}
```

---

## Relacionamentos Entre Tabelas

### Diagrama Entidade-Relacionamento (ER)

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    V0PREMIOS    ‚îÇ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  (Premium)      ‚îÇ   ‚îÇ
‚îÇ                 ‚îÇ   ‚îÇ N:1
‚îÇ - COD_CIA       ‚îÇ   ‚îÇ
‚îÇ - NUM_APOLICE   ‚îÇ‚óÑ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ - NUM_ENDOSSO   ‚îÇ   ‚îÇ        ‚îÇ
‚îÇ - PREMIO_TOTAL  ‚îÇ   ‚îÇ        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ        ‚îÇ
         ‚îÇ            ‚îÇ        ‚îÇ
         ‚îÇ N:1        ‚îÇ        ‚îÇ
         ‚ñº            ‚îÇ        ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   V0APOLICE     ‚îÇ   ‚îÇ   ‚îÇ   V0PRODUTO    ‚îÇ
‚îÇ   (Policy)      ‚îÇ   ‚îÇ   ‚îÇ   (Product)    ‚îÇ
‚îÇ                 ‚îÇ   ‚îÇ   ‚îÇ                ‚îÇ
‚îÇ - NUM_APOLICE   ‚îÇ   ‚îÇ   ‚îÇ - COD_PRODUTO  ‚îÇ
‚îÇ - COD_PRODUTO   ‚îÇ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ - NOME_PRODUTO ‚îÇ
‚îÇ - COD_SEGURADO  ‚îÇ        ‚îÇ - RAMO_SUSEP   ‚îÇ
‚îÇ - COD_ESTIPUL.  ‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ   ‚îÇ    ‚îÇ
     ‚îÇ   ‚îÇ    ‚îÇ N:1
     ‚îÇ   ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ   ‚îÇ                  ‚îÇ
     ‚îÇ   ‚îÇ N:1              ‚îÇ
     ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
     ‚îÇ            ‚îÇ         ‚îÇ
     ‚îÇ N:1        ‚ñº         ‚ñº
     ‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ     ‚îÇ    V0CLIENTE        ‚îÇ
     ‚îÇ     ‚îÇ    (Client)         ‚îÇ
     ‚îÇ     ‚îÇ                     ‚îÇ
     ‚îÇ     ‚îÇ - COD_CLIENTE       ‚îÇ
     ‚îÇ     ‚îÇ - CPF_CNPJ          ‚îÇ
     ‚îÇ     ‚îÇ - NOME_RAZAO        ‚îÇ
     ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ            ‚îÇ
     ‚îÇ            ‚îÇ 1:N
     ‚îÇ            ‚ñº
     ‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ     ‚îÇ   V0ENDERECOS       ‚îÇ
     ‚îÇ     ‚îÇ   (Address)         ‚îÇ
     ‚îÇ     ‚îÇ                     ‚îÇ
     ‚îÇ     ‚îÇ - COD_CLIENTE       ‚îÇ
     ‚îÇ     ‚îÇ - TIPO_ENDERECO     ‚îÇ
     ‚îÇ     ‚îÇ - LOGRADOURO        ‚îÇ
     ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îÇ 1:N
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  V0APOLCOSCED       ‚îÇ   1:1   ‚îÇ      GE399          ‚îÇ
‚îÇ  (Cosurance)        ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  (Calculation)      ‚îÇ
‚îÇ                     ‚îÇ         ‚îÇ                     ‚îÇ
‚îÇ - NUM_APOLICE       ‚îÇ         ‚îÇ - NUM_APOLICE       ‚îÇ
‚îÇ - NUM_ENDOSSO       ‚îÇ         ‚îÇ - PREMIO_TOTAL      ‚îÇ
‚îÇ - PERC_PARTICIPACAO ‚îÇ         ‚îÇ - PREMIO_LIDER      ‚îÇ
‚îÇ - PREMIO_CEDIDO     ‚îÇ         ‚îÇ - QTD_COSSEGURADORES‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Relacionamentos em Entity Framework

```csharp
// PremiumReportingDbContext.cs
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    // Premium -> Policy (N:1)
    modelBuilder.Entity<Premium>()
        .HasOne(p => p.Policy)
        .WithMany(pol => pol.Premiums)
        .HasForeignKey(p => new { p.PolicyNumber, p.CompanyCode })
        .OnDelete(DeleteBehavior.Restrict);

    // Premium -> Product (N:1)
    modelBuilder.Entity<Premium>()
        .HasOne(p => p.Product)
        .WithMany()
        .HasForeignKey(p => p.ProductCode)
        .OnDelete(DeleteBehavior.Restrict);

    // Policy -> Product (N:1)
    modelBuilder.Entity<Policy>()
        .HasOne(p => p.Product)
        .WithMany(prod => prod.Policies)
        .HasForeignKey(p => p.ProductCode)
        .OnDelete(DeleteBehavior.Restrict);

    // Policy -> Client (N:1, multiple)
    modelBuilder.Entity<Policy>()
        .HasOne(p => p.InsuredClient)
        .WithMany()
        .HasForeignKey(p => p.InsuredClientCode)
        .OnDelete(DeleteBehavior.Restrict);

    modelBuilder.Entity<Policy>()
        .HasOne(p => p.Policyholder)
        .WithMany()
        .HasForeignKey(p => p.PolicyholderCode)
        .OnDelete(DeleteBehavior.Restrict);

    // Client -> Address (1:N)
    modelBuilder.Entity<Address>()
        .HasOne(a => a.Client)
        .WithMany(c => c.Addresses)
        .HasForeignKey(a => a.ClientCode)
        .OnDelete(DeleteBehavior.Cascade);

    // Policy -> Cosurance (1:N)
    modelBuilder.Entity<Cosurance>()
        .HasOne(c => c.Policy)
        .WithMany()
        .HasForeignKey(c => new { c.PolicyNumber, c.CompanyCode })
        .OnDelete(DeleteBehavior.Cascade);

    // Indexes for performance
    modelBuilder.Entity<Premium>()
        .HasIndex(p => new { p.ProcessingDate, p.CompanyCode })
        .HasDatabaseName("IX_Premium_ProcessingDate_CompanyCode");

    modelBuilder.Entity<Premium>()
        .HasIndex(p => new { p.PolicyNumber, p.EndorsementNumber })
        .HasDatabaseName("IX_Premium_Policy_Endorsement");

    modelBuilder.Entity<Address>()
        .HasIndex(a => new { a.ClientCode, a.AddressType })
        .HasDatabaseName("IX_Address_Client_Type");
}
```

---

## Modelo de Dados .NET

### DbContext Principal

```csharp
public class PremiumReportingDbContext : DbContext
{
    public PremiumReportingDbContext(DbContextOptions<PremiumReportingDbContext> options)
        : base(options)
    {
    }

    // DbSets (tabelas)
    public DbSet<Premium> Premiums { get; set; }
    public DbSet<Policy> Policies { get; set; }
    public DbSet<Product> Products { get; set; }
    public DbSet<Client> Clients { get; set; }
    public DbSet<Address> Addresses { get; set; }
    public DbSet<Endorsement> Endorsements { get; set; }
    public DbSet<Coverage> Coverages { get; set; }
    public DbSet<Cosurance> Cosurances { get; set; }
    public DbSet<CosuranceCalculation> CosuranceCalculations { get; set; }
    public DbSet<BatchJob> BatchJobs { get; set; }
    public DbSet<BatchJobExecution> BatchJobExecutions { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        base.OnModelCreating(modelBuilder);

        // Aplicar todas as configura√ß√µes
        modelBuilder.ApplyConfigurationsFromAssembly(typeof(PremiumReportingDbContext).Assembly);
    }
}
```

### Configura√ß√µes por Entidade

**Exemplo: PremiumConfiguration.cs**

```csharp
public class PremiumConfiguration : IEntityTypeConfiguration<Premium>
{
    public void Configure(EntityTypeBuilder<Premium> builder)
    {
        builder.ToTable("Premiums");

        builder.HasKey(p => p.PremiumId);

        builder.Property(p => p.CompanyCode)
            .IsRequired();

        builder.Property(p => p.PolicyNumber)
            .IsRequired()
            .HasMaxLength(20);

        builder.Property(p => p.TotalPremium)
            .HasColumnType("decimal(15,2)")
            .IsRequired();

        builder.Property(p => p.NetPremium)
            .HasColumnType("decimal(15,2)")
            .IsRequired();

        // Indexes
        builder.HasIndex(p => new { p.ProcessingDate, p.CompanyCode })
            .HasDatabaseName("IX_Premium_ProcessingDate_CompanyCode");

        builder.HasIndex(p => new { p.PolicyNumber, p.EndorsementNumber })
            .HasDatabaseName("IX_Premium_Policy_Endorsement");

        // Relationships configurados em OnModelCreating
    }
}
```

---

## Estrat√©gia de Migra√ß√£o

### Fase 1: Mapeamento de Views para Tabelas

| View DB2 | Tabela .NET | Estrat√©gia |
|----------|-------------|------------|
| V0PREMIOS | Premiums | Mapeamento 1:1 + campos auditoria |
| V0APOLICE | Policies | Mapeamento 1:1 + relacionamentos |
| V0PRODUTO | Products | Carga inicial + sincroniza√ß√£o |
| V0CLIENTE | Clients | Carga inicial + sincroniza√ß√£o |
| V0ENDERECOS | Addresses | Mapeamento 1:1 |
| V0APOLCOSCED | Cosurances | Mapeamento 1:1 |
| GE399 | CosuranceCalculations | Migra√ß√£o de l√≥gica calculada |

### Fase 2: Carga Inicial de Dados

**Script de Migra√ß√£o SQLite**:

```sql
-- 1. Criar estrutura
CREATE TABLE Premiums (
    PremiumId INTEGER PRIMARY KEY AUTOINCREMENT,
    CompanyCode INTEGER NOT NULL,
    SusepBranch INTEGER NOT NULL,
    PolicyNumber TEXT(20) NOT NULL,
    EndorsementNumber INTEGER NOT NULL,
    MovementType INTEGER,
    IssueDate TEXT NOT NULL,
    EffectiveStartDate TEXT NOT NULL,
    EffectiveEndDate TEXT NOT NULL,
    NetPremium REAL NOT NULL,
    TotalPremium REAL NOT NULL,
    IOF REAL,
    InstallmentFee REAL,
    ProductCode INTEGER NOT NULL,
    CurrencyCode TEXT(3),
    ExchangeRate REAL,
    ProcessingDate TEXT NOT NULL,
    CreatedAt TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX IX_Premium_ProcessingDate_CompanyCode
ON Premiums(ProcessingDate, CompanyCode);

CREATE INDEX IX_Premium_Policy_Endorsement
ON Premiums(PolicyNumber, EndorsementNumber);

-- 2. Popular com dados de teste
INSERT INTO Premiums (CompanyCode, SusepBranch, PolicyNumber, EndorsementNumber, ...)
SELECT ... FROM V0PREMIOS_EXPORT;
```

### Fase 3: Sincroniza√ß√£o Incremental

**Estrat√©gia**:

1. **Export di√°rio de views DB2** para arquivos CSV
2. **ETL Job** carrega CSVs para SQLite/SQL Server
3. **Valida√ß√£o** de integridade referencial
4. **Reconcilia√ß√£o** com arquivos PREMIT.TXT/PREMCED.TXT

**C# ETL Service**:

```csharp
public class DataSyncService
{
    public async Task SyncPremiumsAsync(string csvFilePath)
    {
        using var reader = new StreamReader(csvFilePath);
        using var csv = new CsvReader(reader, CultureInfo.InvariantCulture);

        var records = csv.GetRecords<PremiumCsvRecord>();

        var premiums = records.Select(r => new Premium
        {
            CompanyCode = r.COD_CIA,
            PolicyNumber = r.NUM_APOLICE.ToString(),
            EndorsementNumber = r.NUM_ENDOSSO,
            TotalPremium = r.PREMIO_TOTAL,
            // ... outros campos
        });

        _context.Premiums.AddRange(premiums);
        await _context.SaveChangesAsync();
    }
}
```

---

## Considera√ß√µes de Performance

### √çndices Recomendados

```sql
-- Premiums: busca por data de processamento (query principal)
CREATE INDEX IX_Premium_ProcessingDate_CompanyCode
ON Premiums(ProcessingDate, CompanyCode);

-- Premiums: busca por ap√≥lice/endosso
CREATE INDEX IX_Premium_Policy_Endorsement
ON Premiums(PolicyNumber, EndorsementNumber);

-- Policies: busca por cliente
CREATE INDEX IX_Policy_InsuredClient
ON Policies(InsuredClientCode);

-- Addresses: busca por cliente e tipo
CREATE INDEX IX_Address_Client_Type
ON Addresses(ClientCode, AddressType);

-- Cosurances: busca por ap√≥lice
CREATE INDEX IX_Cosurance_Policy
ON Cosurances(PolicyNumber, EndorsementNumber);
```

### Otimiza√ß√µes de Query

**1. AsNoTracking para Read-Only**:

```csharp
// ‚úÖ Correto: leitura sem tracking
var premiums = await _context.Premiums
    .AsNoTracking()
    .Where(p => p.ProcessingDate == date)
    .ToListAsync();

// ‚ùå Evitar: tracking desnecess√°rio
var premiums = await _context.Premiums
    .Where(p => p.ProcessingDate == date)
    .ToListAsync();
```

**2. Proje√ß√µes com Select**:

```csharp
// ‚úÖ Correto: buscar apenas campos necess√°rios
var summaries = await _context.Premiums
    .Where(p => p.ProcessingDate == date)
    .Select(p => new PremiumSummary
    {
        PolicyNumber = p.PolicyNumber,
        TotalPremium = p.TotalPremium
    })
    .ToListAsync();
```

**3. Include com ThenInclude para Joins**:

```csharp
// ‚úÖ Correto: carregamento eager de relacionamentos
var policies = await _context.Policies
    .Include(p => p.Product)
    .Include(p => p.InsuredClient)
        .ThenInclude(c => c.Addresses)
    .Where(p => p.PolicyNumber == policyNumber)
    .FirstOrDefaultAsync();
```

### Estimativas de Volume

| Tabela | Registros/M√™s | Tamanho/Registro | Crescimento/Ano |
|--------|---------------|------------------|-----------------|
| Premiums | 10.000 | 250 bytes | 2.5 MB |
| Policies | 2.000 | 300 bytes | 600 KB |
| Clients | 5.000 | 200 bytes | 1 MB |
| Addresses | 15.000 | 150 bytes | 2.25 MB |
| Cosurances | 1.000 | 100 bytes | 100 KB |

**Total estimado**: ~6.5 MB/ano em SQLite (desenvolvimento), compact√°vel com indexa√ß√£o.

---

## Refer√™ncias

- **Especifica√ß√£o Completa**: `specs/001-vamos-migrar-sistema/data-model.md`
- **Estruturas COBOL**: `docs/legacy-system/03-data-structures.md`
- **Entity Framework Core**: https://learn.microsoft.com/ef/core/
- **COBOL DB2 SQL**: IBM DB2 for z/OS SQL Reference

---

**Documento criado em**: 2025-10-27
**√öltima atualiza√ß√£o**: 2025-10-27
**Vers√£o**: 1.0
# 05 - Business Logic

[‚Üê Voltar ao √çndice](README.md)

## √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Estrutura do Programa](#estrutura-do-programa)
- [Se√ß√µes COBOL (R0000-R9999)](#se√ß√µes-cobol-r0000-r9999)
- [Regras de Neg√≥cio por Tipo de Movimento](#regras-de-neg√≥cio-por-tipo-de-movimento)
- [C√°lculos de Pr√™mio](#c√°lculos-de-pr√™mio)
- [Processamento de Cosseguro](#processamento-de-cosseguro)
- [Valida√ß√µes por Ramo SUSEP](#valida√ß√µes-por-ramo-susep)
- [Migra√ß√£o para .NET](#migra√ß√£o-para-net)

---

## Vis√£o Geral

O programa RG1866B cont√©m **63 se√ß√µes** (paragraphs) organizadas em grupos funcionais numerados de R0000 a R9999. Cada se√ß√£o implementa uma parte espec√≠fica da l√≥gica de neg√≥cio para gera√ß√£o de relat√≥rios SUSEP Circular 360.

### M√©tricas de L√≥gica de Neg√≥cio

| M√©trica | Valor |
|---------|-------|
| **Total de Se√ß√µes** | 63 |
| **Linhas de C√≥digo** | 5.046 |
| **Regras de Neg√≥cio** | 147+ |
| **Tipos de Movimento** | 6 (101-106) |
| **Ramos SUSEP** | 20+ |
| **C√°lculos Financeiros** | 38 f√≥rmulas |
| **Valida√ß√µes** | 52 checks |

### Fluxo de Processamento Principal

```text
R0000-INICIO
    ‚Üì
R0100-INICIALIZACAO
    ‚Üì
R0200-ABRIR-ARQUIVOS
    ‚Üì
R0300-LER-PARAMETROS
    ‚Üì
R0400-ABRIR-CURSORES
    ‚Üì
R0500-PROCESSAR-LOTE ‚Üê Loop Principal
    ‚Üì
    R0600-PROCESSAR-PREMIO
        ‚Üì
        R0700-BUSCAR-APOLICE
        ‚Üì
        R0800-BUSCAR-PRODUTO
        ‚Üì
        R0900-BUSCAR-CLIENTES
        ‚Üì
        R1000-CALCULAR-PREMIO
        ‚Üì
        R3000-PROCESSAR-COSSEGURO (se aplic√°vel)
        ‚Üì
        R4000-FORMATAR-PREMIT
        ‚Üì
        R5000-ESCREVER-REGISTRO
    ‚Üì (at√© fim do cursor)
    ‚Üì
R8000-FECHAR-CURSORES
    ‚Üì
R8100-FECHAR-ARQUIVOS
    ‚Üì
R8200-GERAR-TOTALIZADORES
    ‚Üì
R9999-FIM
```

---

## Estrutura do Programa

### Divis√µes COBOL

```cobol
IDENTIFICATION DIVISION.
PROGRAM-ID. RG1866B.
*----------------------------------------------------------------
* PROGRAMA: RG1866B - RELATORIO PREMIOS EMITIDOS SUSEP CIRC 360
* AUTOR: TIME DE DESENVOLVIMENTO CAIXA SEGURADORA
* DATA CRIACAO: 2014-03-15
* ULTIMA ALTERACAO: 2022-09-30
*----------------------------------------------------------------

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
SPECIAL-NAMES.
    DECIMAL-POINT IS COMMA.

DATA DIVISION.
WORKING-STORAGE SECTION.
    *> 687 vari√°veis de trabalho

PROCEDURE DIVISION.
    *> 63 se√ß√µes de l√≥gica de neg√≥cio
```

---

## Se√ß√µes COBOL (R0000-R9999)

### Grupo R0000-R0999: Inicializa√ß√£o e Setup

#### R0000-INICIO

**Prop√≥sito**: Ponto de entrada do programa

```cobol
R0000-INICIO.
    PERFORM R0100-INICIALIZACAO.
    PERFORM R0200-ABRIR-ARQUIVOS.
    PERFORM R0300-LER-PARAMETROS.
    PERFORM R0400-ABRIR-CURSORES.
    PERFORM R0500-PROCESSAR-LOTE.
    PERFORM R8000-FECHAR-CURSORES.
    PERFORM R8100-FECHAR-ARQUIVOS.
    PERFORM R8200-GERAR-TOTALIZADORES.
    STOP RUN.
```

**Migra√ß√£o .NET**:

```csharp
public class PremiumReportService : IPremiumReportService
{
    public async Task<ReportResult> GenerateReportAsync(ReportParameters parameters)
    {
        // R0100: Inicializa√ß√£o
        await InitializeAsync(parameters);

        // R0200-R0300: Abrir conex√µes e ler par√¢metros
        await using var connection = await OpenConnectionAsync();
        var config = await LoadConfigurationAsync(parameters);

        // R0400: Abrir cursores (streams)
        await using var premiumStream = GetPremiumStreamAsync(config);

        // R0500: Processar lote
        var result = await ProcessBatchAsync(premiumStream, config);

        // R8200: Gerar totalizadores
        await GenerateSummaryAsync(result);

        return result;
    }
}
```

#### R0100-INICIALIZACAO

**Prop√≥sito**: Inicializar vari√°veis de trabalho

```cobol
R0100-INICIALIZACAO.
    MOVE ZEROS TO WS-TOTAL-REGISTROS
                   WS-TOTAL-PREMIO-LIQUIDO
                   WS-TOTAL-PREMIO-TOTAL
                   WS-TOTAL-IOF
                   WS-CONTADOR-ERROS.

    MOVE SPACES TO WS-MENSAGEM-ERRO
                    WS-NUMERO-APOLICE-ANTERIOR.

    MOVE 'N' TO WS-FIM-CURSOR-PREMIOS
                 WS-FIM-CURSOR-ENDERECOS
                 WS-FIM-CURSOR-COSSEGURO.

    ACCEPT WS-DATA-PROCESSAMENTO FROM DATE YYYYMMDD.
    MOVE FUNCTION CURRENT-DATE TO WS-TIMESTAMP.
```

**Migra√ß√£o .NET**:

```csharp
private void Initialize(ReportParameters parameters)
{
    _totalRecords = 0;
    _totalNetPremium = 0m;
    _totalGrossPremium = 0m;
    _totalIOF = 0m;
    _errorCount = 0;

    _processingDate = parameters.ProcessingDate;
    _timestamp = DateTime.Now;

    _logger.LogInformation("Initialized report generation at {Timestamp}", _timestamp);
}
```

#### R0200-ABRIR-ARQUIVOS

**Prop√≥sito**: Abrir arquivos de sa√≠da PREMIT.TXT e PREMCED.TXT

```cobol
R0200-ABRIR-ARQUIVOS.
    OPEN OUTPUT ARQUIVO-PREMIT.
    IF WS-FILE-STATUS NOT = '00'
        MOVE 'ERRO AO ABRIR ARQUIVO-PREMIT' TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-ARQUIVO
    END-IF.

    OPEN OUTPUT ARQUIVO-PREMCED.
    IF WS-FILE-STATUS NOT = '00'
        MOVE 'ERRO AO ABRIR ARQUIVO-PREMCED' TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-ARQUIVO
    END-IF.
```

**Migra√ß√£o .NET**:

```csharp
private async Task<(StreamWriter premit, StreamWriter premced)> OpenFilesAsync(
    ReportParameters parameters)
{
    var premitPath = Path.Combine(parameters.OutputPath, "PREMIT.TXT");
    var premcedPath = Path.Combine(parameters.OutputPath, "PREMCED.TXT");

    try
    {
        var premitWriter = new StreamWriter(premitPath, append: false, Encoding.ASCII);
        var premcedWriter = new StreamWriter(premcedPath, append: false, Encoding.ASCII);

        _logger.LogInformation("Opened output files: {PremitPath}, {PremcedPath}",
            premitPath, premcedPath);

        return (premitWriter, premcedWriter);
    }
    catch (IOException ex)
    {
        _logger.LogError(ex, "Failed to open output files");
        throw new ReportGenerationException("Erro ao abrir arquivos de sa√≠da", ex);
    }
}
```

#### R0300-LER-PARAMETROS

**Prop√≥sito**: Ler par√¢metros de execu√ß√£o (data, companhia, etc.)

```cobol
R0300-LER-PARAMETROS.
    ACCEPT WS-DATA-PROCESSAMENTO FROM SYSIN.
    ACCEPT WS-COD-CIA FROM SYSIN.

    IF WS-DATA-PROCESSAMENTO = ZEROS OR SPACES
        MOVE FUNCTION CURRENT-DATE(1:8) TO WS-DATA-PROCESSAMENTO
    END-IF.

    IF WS-COD-CIA = ZEROS OR SPACES
        MOVE 1 TO WS-COD-CIA  *> Default company code
    END-IF.
```

**Migra√ß√£o .NET**:

```csharp
public class ReportParameters
{
    public DateTime ProcessingDate { get; set; }
    public int CompanyCode { get; set; }
    public string OutputPath { get; set; }

    public static ReportParameters FromConfiguration(IConfiguration config)
    {
        return new ReportParameters
        {
            ProcessingDate = config.GetValue<DateTime?>("ProcessingDate")
                ?? DateTime.Today,
            CompanyCode = config.GetValue<int?>("CompanyCode") ?? 1,
            OutputPath = config.GetValue<string>("OutputPath")
                ?? "/tmp/reports"
        };
    }
}
```

### Grupo R0500-R0999: Processamento Principal

#### R0500-PROCESSAR-LOTE

**Prop√≥sito**: Loop principal de processamento de pr√™mios

```cobol
R0500-PROCESSAR-LOTE.
    PERFORM R0600-FETCH-PREMIO

    PERFORM UNTIL WS-FIM-CURSOR-PREMIOS = 'S'
        ADD 1 TO WS-TOTAL-REGISTROS

        PERFORM R0700-BUSCAR-APOLICE
        PERFORM R0800-BUSCAR-PRODUTO
        PERFORM R0900-BUSCAR-CLIENTES
        PERFORM R1000-CALCULAR-PREMIO

        IF WS-PRODUTO-TEM-COSSEGURO = 'S'
            PERFORM R3000-PROCESSAR-COSSEGURO
        END-IF

        PERFORM R4000-FORMATAR-PREMIT
        PERFORM R5000-ESCREVER-REGISTRO

        PERFORM R0600-FETCH-PREMIO
    END-PERFORM.
```

**Migra√ß√£o .NET**:

```csharp
private async Task<ReportResult> ProcessBatchAsync(
    IAsyncEnumerable<Premium> premiumStream,
    ReportConfiguration config)
{
    var result = new ReportResult();

    await foreach (var premium in premiumStream)
    {
        result.TotalRecords++;

        // Buscar dados relacionados
        var policy = await _policyRepository.GetByNumberAsync(premium.PolicyNumber);
        var product = await _productRepository.GetByCodeAsync(premium.ProductCode);
        var clients = await _clientRepository.GetByPolicyAsync(premium.PolicyNumber);

        // Calcular pr√™mio
        var calculation = await CalculatePremiumAsync(premium, policy, product);

        // Processar cosseguro se aplic√°vel
        if (product.CosuranceIndicator == "S")
        {
            await ProcessCosuranceAsync(premium, policy, calculation);
        }

        // Formatar e escrever registros
        var premitRecord = FormatPremitRecord(premium, policy, calculation);
        await WritePremitRecordAsync(premitRecord);

        // Atualizar totalizadores
        result.TotalNetPremium += calculation.NetPremium;
        result.TotalGrossPremium += calculation.GrossPremium;
        result.TotalIOF += calculation.IOF;
    }

    return result;
}
```

---

## Regras de Neg√≥cio por Tipo de Movimento

### Tipos de Movimento (COD_TIPO_MOVIMENTO)

| C√≥digo | Descri√ß√£o | Impacto no Pr√™mio | Se√ß√£o COBOL |
|--------|-----------|-------------------|-------------|
| **101** | Emiss√£o | +Pr√™mio Integral | R1100 |
| **102** | Endosso Aumento | +Pr√™mio Adicional | R1200 |
| **103** | Endosso Redu√ß√£o | -Pr√™mio Devolvido | R1300 |
| **104** | Cancelamento | -Pr√™mio Integral | R1400 |
| **105** | Renova√ß√£o | +Pr√™mio Nova Vig√™ncia | R1500 |
| **106** | Substitui√ß√£o | ¬±Diferen√ßa Pr√™mio | R1600 |

### R1100: Emiss√£o (Tipo 101)

**Regra**: Pr√™mio integral da ap√≥lice nova

```cobol
R1100-PROCESSAR-EMISSAO.
    MOVE REGISTRO-PREMIO-LIQUIDO TO WS-PREMIO-CALCULADO.
    MOVE REGISTRO-PREMIO-TOTAL TO WS-PREMIO-EMITIDO.
    MOVE REGISTRO-IOF TO WS-IOF-CALCULADO.

    *> Calcular adicional de fracionamento
    IF APOLICE-NUM-PARCELAS > 1
        COMPUTE WS-ADICIONAL-FRAC =
            REGISTRO-PREMIO-LIQUIDO * 0.0538  *> 5.38% taxa padr√£o
        ADD WS-ADICIONAL-FRAC TO WS-PREMIO-EMITIDO
    END-IF.

    *> Validar vig√™ncia
    IF APOLICE-DATA-VIG-INI > WS-DATA-PROCESSAMENTO
        MOVE 'W' TO WS-STATUS-VALIDACAO  *> Warning: vig√™ncia futura
    END-IF.
```

**Migra√ß√£o .NET**:

```csharp
public class EmissionCalculationService
{
    private const decimal DEFAULT_INSTALLMENT_FEE_RATE = 0.0538m; // 5.38%

    public PremiumCalculation CalculateEmission(
        Premium premium,
        Policy policy)
    {
        var calculation = new PremiumCalculation
        {
            NetPremium = premium.NetPremium,
            GrossPremium = premium.TotalPremium,
            IOF = premium.IOF
        };

        // Adicional de fracionamento
        if (policy.InstallmentCount > 1)
        {
            calculation.InstallmentFee =
                premium.NetPremium * DEFAULT_INSTALLMENT_FEE_RATE;
            calculation.GrossPremium += calculation.InstallmentFee;
        }

        // Valida√ß√µes
        if (policy.EffectiveStartDate > _processingDate)
        {
            calculation.Warnings.Add("Vig√™ncia futura");
        }

        return calculation;
    }
}
```

### R1200: Endosso Aumento (Tipo 102)

**Regra**: Calcular pr√™mio proporcional ao per√≠odo remanescente

```cobol
R1200-PROCESSAR-ENDOSSO-AUMENTO.
    *> Calcular dias remanescentes de vig√™ncia
    COMPUTE WS-DIAS-VIGENCIA =
        FUNCTION INTEGER-OF-DATE(APOLICE-DATA-VIG-FIM) -
        FUNCTION INTEGER-OF-DATE(WS-DATA-PROCESSAMENTO).

    *> Dias totais da ap√≥lice
    COMPUTE WS-DIAS-TOTAIS =
        FUNCTION INTEGER-OF-DATE(APOLICE-DATA-VIG-FIM) -
        FUNCTION INTEGER-OF-DATE(APOLICE-DATA-VIG-INI).

    *> Pr√™mio proporcional (pro-rata die)
    COMPUTE WS-PREMIO-CALCULADO =
        REGISTRO-PREMIO-LIQUIDO *
        (WS-DIAS-VIGENCIA / WS-DIAS-TOTAIS).

    *> IOF proporcional
    COMPUTE WS-IOF-CALCULADO =
        REGISTRO-IOF *
        (WS-DIAS-VIGENCIA / WS-DIAS-TOTAIS).
```

**Migra√ß√£o .NET**:

```csharp
public PremiumCalculation CalculateEndorsementIncrease(
    Premium premium,
    Policy policy,
    DateTime processingDate)
{
    // Calcular dias remanescentes
    var remainingDays = (policy.EffectiveEndDate - processingDate).Days;
    var totalDays = (policy.EffectiveEndDate - policy.EffectiveStartDate).Days;

    // Validar per√≠odo
    if (remainingDays <= 0)
    {
        throw new BusinessRuleException(
            "Endosso n√£o permitido: vig√™ncia j√° encerrada");
    }

    // Pro-rata die (proporcional aos dias)
    var proportionFactor = (decimal)remainingDays / totalDays;

    return new PremiumCalculation
    {
        NetPremium = premium.NetPremium * proportionFactor,
        IOF = premium.IOF * proportionFactor,
        GrossPremium = (premium.NetPremium + premium.IOF) * proportionFactor,
        ProportionFactor = proportionFactor
    };
}
```

### R1300: Endosso Redu√ß√£o (Tipo 103)

**Regra**: Calcular devolu√ß√£o de pr√™mio (negativo)

```cobol
R1300-PROCESSAR-ENDOSSO-REDUCAO.
    *> Mesmo c√°lculo de R1200, mas com sinal negativo
    PERFORM R1200-PROCESSAR-ENDOSSO-AUMENTO.

    MULTIPLY WS-PREMIO-CALCULADO BY -1.
    MULTIPLY WS-IOF-CALCULADO BY -1.
    MULTIPLY WS-PREMIO-EMITIDO BY -1.
```

**Migra√ß√£o .NET**:

```csharp
public PremiumCalculation CalculateEndorsementDecrease(
    Premium premium,
    Policy policy,
    DateTime processingDate)
{
    // Mesmo c√°lculo de aumento, mas com valores negativos
    var increase = CalculateEndorsementIncrease(premium, policy, processingDate);

    return new PremiumCalculation
    {
        NetPremium = -increase.NetPremium,
        IOF = -increase.IOF,
        GrossPremium = -increase.GrossPremium,
        ProportionFactor = increase.ProportionFactor
    };
}
```

### R1400: Cancelamento (Tipo 104)

**Regra**: Devolver pr√™mio integral (negativo), validar car√™ncia

```cobol
R1400-PROCESSAR-CANCELAMENTO.
    *> Verificar car√™ncia de 7 dias
    COMPUTE WS-DIAS-DESDE-EMISSAO =
        FUNCTION INTEGER-OF-DATE(WS-DATA-PROCESSAMENTO) -
        FUNCTION INTEGER-OF-DATE(APOLICE-DATA-EMISSAO).

    IF WS-DIAS-DESDE-EMISSAO < 7
        *> Devolu√ß√£o integral (direito de arrependimento)
        COMPUTE WS-PREMIO-CALCULADO =
            REGISTRO-PREMIO-TOTAL * -1
    ELSE
        *> Devolu√ß√£o proporcional (descontar taxa administrativa 10%)
        COMPUTE WS-PREMIO-CALCULADO =
            REGISTRO-PREMIO-TOTAL * -0.90
    END-IF.
```

**Migra√ß√£o .NET**:

```csharp
public PremiumCalculation CalculateCancellation(
    Premium premium,
    Policy policy,
    DateTime processingDate)
{
    var daysSinceIssue = (processingDate - policy.IssueDate).Days;

    decimal refundAmount;

    if (daysSinceIssue < 7)
    {
        // Direito de arrependimento: devolu√ß√£o integral
        refundAmount = premium.TotalPremium;
        _logger.LogInformation(
            "Full refund applied (regret period): Policy {PolicyNumber}",
            policy.PolicyNumber);
    }
    else
    {
        // Devolu√ß√£o com desconto de taxa administrativa (10%)
        const decimal ADMIN_FEE_RATE = 0.10m;
        refundAmount = premium.TotalPremium * (1 - ADMIN_FEE_RATE);
        _logger.LogInformation(
            "Partial refund applied (admin fee {FeeRate}%): Policy {PolicyNumber}",
            ADMIN_FEE_RATE * 100, policy.PolicyNumber);
    }

    return new PremiumCalculation
    {
        NetPremium = -refundAmount,
        GrossPremium = -refundAmount,
        IOF = 0m, // IOF n√£o √© devolvido
        RefundReason = daysSinceIssue < 7 ? "Regret" : "Cancellation"
    };
}
```

---

## C√°lculos de Pr√™mio

### R1000-CALCULAR-PREMIO (Se√ß√£o Mestre)

```cobol
R1000-CALCULAR-PREMIO.
    EVALUATE COD-TIPO-MOVIMENTO
        WHEN 101  PERFORM R1100-PROCESSAR-EMISSAO
        WHEN 102  PERFORM R1200-PROCESSAR-ENDOSSO-AUMENTO
        WHEN 103  PERFORM R1300-PROCESSAR-ENDOSSO-REDUCAO
        WHEN 104  PERFORM R1400-PROCESSAR-CANCELAMENTO
        WHEN 105  PERFORM R1500-PROCESSAR-RENOVACAO
        WHEN 106  PERFORM R1600-PROCESSAR-SUBSTITUICAO
        WHEN OTHER
            MOVE 'TIPO DE MOVIMENTO INVALIDO' TO WS-MENSAGEM-ERRO
            PERFORM R9000-TRATAR-ERRO-VALIDACAO
    END-EVALUATE.

    *> Aplicar convers√£o de moeda se necess√°rio
    IF COD-MOEDA NOT = 'BRL'
        PERFORM R1700-CONVERTER-MOEDA
    END-IF.

    *> Validar limites
    PERFORM R1800-VALIDAR-LIMITES.
```

**Migra√ß√£o .NET**:

```csharp
public async Task<PremiumCalculation> CalculatePremiumAsync(
    Premium premium,
    Policy policy,
    Product product)
{
    PremiumCalculation calculation = premium.MovementType switch
    {
        101 => CalculateEmission(premium, policy),
        102 => CalculateEndorsementIncrease(premium, policy, _processingDate),
        103 => CalculateEndorsementDecrease(premium, policy, _processingDate),
        104 => CalculateCancellation(premium, policy, _processingDate),
        105 => CalculateRenewal(premium, policy),
        106 => CalculateReplacement(premium, policy),
        _ => throw new BusinessRuleException(
            $"Tipo de movimento inv√°lido: {premium.MovementType}")
    };

    // Convers√£o de moeda
    if (premium.CurrencyCode != "BRL")
    {
        calculation = await ConvertCurrencyAsync(calculation, premium.ExchangeRate);
    }

    // Valida√ß√µes de limites
    ValidateLimits(calculation, product);

    return calculation;
}
```

### R1700-CONVERTER-MOEDA

**Regra**: Convers√£o para BRL usando taxa de c√¢mbio

```cobol
R1700-CONVERTER-MOEDA.
    IF WS-TAXA-CAMBIO = ZEROS
        MOVE 'TAXA DE CAMBIO NAO INFORMADA' TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-VALIDACAO
    END-IF.

    COMPUTE WS-PREMIO-CALCULADO =
        WS-PREMIO-CALCULADO * WS-TAXA-CAMBIO.

    COMPUTE WS-PREMIO-EMITIDO =
        WS-PREMIO-EMITIDO * WS-TAXA-CAMBIO.

    COMPUTE WS-IOF-CALCULADO =
        WS-IOF-CALCULADO * WS-TAXA-CAMBIO.
```

**Migra√ß√£o .NET**:

```csharp
private async Task<PremiumCalculation> ConvertCurrencyAsync(
    PremiumCalculation calculation,
    decimal exchangeRate)
{
    if (exchangeRate <= 0)
    {
        throw new BusinessRuleException("Taxa de c√¢mbio inv√°lida");
    }

    return new PremiumCalculation
    {
        NetPremium = calculation.NetPremium * exchangeRate,
        GrossPremium = calculation.GrossPremium * exchangeRate,
        IOF = calculation.IOF * exchangeRate,
        ExchangeRate = exchangeRate,
        OriginalCurrency = calculation.OriginalCurrency ?? "USD"
    };
}
```

### R1800-VALIDAR-LIMITES

**Regra**: Validar valores contra limites do produto

```cobol
R1800-VALIDAR-LIMITES.
    *> Limite m√≠nimo de pr√™mio
    IF WS-PREMIO-CALCULADO < PRODUTO-PREMIO-MINIMO
        MOVE 'E' TO WS-STATUS-VALIDACAO  *> Error
        MOVE 'PREMIO ABAIXO DO MINIMO' TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-VALIDACAO
    END-IF.

    *> Limite m√°ximo de pr√™mio
    IF WS-PREMIO-CALCULADO > PRODUTO-PREMIO-MAXIMO
        MOVE 'W' TO WS-STATUS-VALIDACAO  *> Warning
        MOVE 'PREMIO ACIMA DO MAXIMO' TO WS-MENSAGEM-ERRO
        PERFORM R9100-TRATAR-WARNING
    END-IF.
```

**Migra√ß√£o .NET**:

```csharp
private void ValidateLimits(PremiumCalculation calculation, Product product)
{
    // Limite m√≠nimo
    if (calculation.NetPremium < product.MinimumPremium)
    {
        throw new BusinessRuleException(
            $"Pr√™mio R$ {calculation.NetPremium:N2} abaixo do m√≠nimo " +
            $"R$ {product.MinimumPremium:N2}");
    }

    // Limite m√°ximo (warning, n√£o erro)
    if (calculation.NetPremium > product.MaximumPremium)
    {
        _logger.LogWarning(
            "Pr√™mio R$ {NetPremium:N2} acima do m√°ximo R$ {MaxPremium:N2} " +
            "para produto {ProductCode}",
            calculation.NetPremium, product.MaximumPremium, product.ProductCode);

        calculation.Warnings.Add(
            $"Pr√™mio acima do m√°ximo: R$ {product.MaximumPremium:N2}");
    }
}
```

---

## Processamento de Cosseguro

### R3000-PROCESSAR-COSSEGURO (Se√ß√£o Mestre)

```cobol
R3000-PROCESSAR-COSSEGURO.
    *> Buscar dados de cosseguro/cess√£o
    PERFORM R3100-ABRIR-CURSOR-COSSEGURO.
    PERFORM R3200-FETCH-COSSEGURO.

    MOVE ZEROS TO WS-PREMIO-LIDER
                   WS-PREMIO-CEDIDO
                   WS-QTD-COSSEGURADORES.

    PERFORM UNTIL WS-FIM-CURSOR-COSSEGURO = 'S'
        ADD 1 TO WS-QTD-COSSEGURADORES

        PERFORM R3500-CALCULAR-PARTICIPACAO
        PERFORM R3600-GERAR-REGISTRO-PREMCED

        PERFORM R3200-FETCH-COSSEGURO
    END-PERFORM.

    PERFORM R3900-FECHAR-CURSOR-COSSEGURO.

    *> Validar soma de participa√ß√µes = 100%
    PERFORM R3800-VALIDAR-PARTICIPACOES.
```

**Migra√ß√£o .NET**:

```csharp
private async Task ProcessCosuranceAsync(
    Premium premium,
    Policy policy,
    PremiumCalculation calculation)
{
    // Buscar participa√ß√µes de cosseguro
    var cosurances = await _cosuranceRepository.GetCosurancesAsync(
        policy.PolicyNumber,
        premium.EndorsementNumber);

    if (!cosurances.Any())
    {
        _logger.LogWarning(
            "Produto marcado com cosseguro mas sem participa√ß√µes: {PolicyNumber}",
            policy.PolicyNumber);
        return;
    }

    decimal totalLeaderPremium = 0m;
    decimal totalCededPremium = 0m;

    foreach (var cosurance in cosurances)
    {
        var participation = CalculateParticipation(
            calculation,
            cosurance);

        await GeneratePremcedRecordAsync(
            premium,
            policy,
            cosurance,
            participation);

        if (cosurance.ParticipationType == "L") // L√≠der
        {
            totalLeaderPremium += participation.PremiumAmount;
        }
        else // Cedido
        {
            totalCededPremium += participation.PremiumAmount;
        }
    }

    // Validar soma de participa√ß√µes
    ValidateParticipations(cosurances, calculation.GrossPremium);
}
```

### R3500-CALCULAR-PARTICIPACAO

**Regra**: Calcular pr√™mio por percentual de participa√ß√£o

```cobol
R3500-CALCULAR-PARTICIPACAO.
    COMPUTE WS-PREMIO-PARTICIPACAO =
        WS-PREMIO-EMITIDO *
        (COSSEGURO-PERCENTUAL / 100).

    IF COSSEGURO-TIPO = 'A'  *> Aceito (l√≠der)
        ADD WS-PREMIO-PARTICIPACAO TO WS-PREMIO-LIDER
    ELSE  *> Cedido
        ADD WS-PREMIO-PARTICIPACAO TO WS-PREMIO-CEDIDO
    END-IF.
```

**Migra√ß√£o .NET**:

```csharp
private CosuranceParticipation CalculateParticipation(
    PremiumCalculation calculation,
    Cosurance cosurance)
{
    var premiumAmount = calculation.GrossPremium *
        (cosurance.ParticipationPercentage / 100m);

    return new CosuranceParticipation
    {
        CoinsurerCompanyCode = cosurance.CoinsurerCompanyCode,
        ParticipationPercentage = cosurance.ParticipationPercentage,
        PremiumAmount = premiumAmount,
        ParticipationType = cosurance.ParticipationType
    };
}
```

### R3800-VALIDAR-PARTICIPACOES

**Regra**: Soma de percentuais deve ser 100%

```cobol
R3800-VALIDAR-PARTICIPACOES.
    MOVE ZEROS TO WS-SOMA-PARTICIPACOES.

    *> Somar todos os percentuais
    EXEC SQL
        SELECT SUM(PERCENTUAL_PARTICIPACAO)
        INTO :WS-SOMA-PARTICIPACOES
        FROM V0APOLCOSCED
        WHERE NUM_APOLICE = :WS-NUM-APOLICE
          AND NUM_ENDOSSO = :WS-NUM-ENDOSSO
    END-EXEC.

    IF WS-SOMA-PARTICIPACOES NOT = 100
        MOVE 'SOMA DE PARTICIPACOES DIFERENTE DE 100%'
            TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-VALIDACAO
    END-IF.
```

**Migra√ß√£o .NET**:

```csharp
private void ValidateParticipations(
    List<Cosurance> cosurances,
    decimal totalPremium)
{
    var totalPercentage = cosurances.Sum(c => c.ParticipationPercentage);

    // Toler√¢ncia de 0.01% para arredondamento
    const decimal TOLERANCE = 0.01m;

    if (Math.Abs(totalPercentage - 100m) > TOLERANCE)
    {
        throw new BusinessRuleException(
            $"Soma de participa√ß√µes ({totalPercentage:N2}%) diferente de 100%");
    }

    // Validar soma de pr√™mios (reconcilia√ß√£o)
    var totalCalculatedPremium = cosurances
        .Sum(c => totalPremium * (c.ParticipationPercentage / 100m));

    if (Math.Abs(totalCalculatedPremium - totalPremium) > 0.01m)
    {
        _logger.LogWarning(
            "Diferen√ßa na soma de pr√™mios de cosseguro: " +
            "Esperado={Expected:N2}, Calculado={Calculated:N2}",
            totalPremium, totalCalculatedPremium);
    }
}
```

---

## Valida√ß√µes por Ramo SUSEP

### R2000-VALIDAR-RAMO-SUSEP

**Regra**: Valida√ß√µes espec√≠ficas por ramo SUSEP

```cobol
R2000-VALIDAR-RAMO-SUSEP.
    EVALUATE PRODUTO-RAMO-SUSEP
        WHEN 0531  *> Vida Individual
            PERFORM R2100-VALIDAR-VIDA
        WHEN 0532  *> Vida em Grupo
            PERFORM R2200-VALIDAR-VIDA-GRUPO
        WHEN 0553  *> Acidentes Pessoais
            PERFORM R2300-VALIDAR-ACIDENTES
        WHEN 0571  *> Previd√™ncia Privada
            PERFORM R2400-VALIDAR-PREVIDENCIA
        WHEN OTHER
            PERFORM R2900-VALIDAR-RAMO-GENERICO
    END-EVALUATE.
```

**Migra√ß√£o .NET**:

```csharp
private void ValidateBySusepBranch(
    Premium premium,
    Policy policy,
    Product product,
    PremiumCalculation calculation)
{
    switch (product.SusepBranch)
    {
        case 531: // Vida Individual
            ValidateLifeInsurance(premium, policy, calculation);
            break;

        case 532: // Vida em Grupo
            ValidateGroupLifeInsurance(premium, policy, calculation);
            break;

        case 553: // Acidentes Pessoais
            ValidatePersonalAccidents(premium, policy, calculation);
            break;

        case 571: // Previd√™ncia Privada
            ValidatePensionPlan(premium, policy, calculation);
            break;

        default:
            ValidateGenericBranch(premium, policy, calculation);
            break;
    }
}
```

### R2100-VALIDAR-VIDA (Ramo 0531)

**Regras**:
- Cliente deve ter idade entre 18 e 70 anos
- Vig√™ncia m√°xima de 1 ano
- Exigir documenta√ß√£o m√©dica acima de R$ 100.000

```cobol
R2100-VALIDAR-VIDA.
    *> Validar idade do segurado
    COMPUTE WS-IDADE-SEGURADO =
        FUNCTION INTEGER-OF-DATE(WS-DATA-PROCESSAMENTO) -
        FUNCTION INTEGER-OF-DATE(CLIENTE-DATA-NASCIMENTO).

    DIVIDE WS-IDADE-SEGURADO BY 365 GIVING WS-IDADE-ANOS.

    IF WS-IDADE-ANOS < 18 OR WS-IDADE-ANOS > 70
        MOVE 'IDADE FORA DO LIMITE PERMITIDO' TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-VALIDACAO
    END-IF.

    *> Validar vig√™ncia m√°xima
    COMPUTE WS-DIAS-VIGENCIA =
        FUNCTION INTEGER-OF-DATE(APOLICE-DATA-VIG-FIM) -
        FUNCTION INTEGER-OF-DATE(APOLICE-DATA-VIG-INI).

    IF WS-DIAS-VIGENCIA > 365
        MOVE 'VIGENCIA SUPERIOR A 1 ANO' TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-VALIDACAO
    END-IF.
```

**Migra√ß√£o .NET**:

```csharp
private void ValidateLifeInsurance(
    Premium premium,
    Policy policy,
    PremiumCalculation calculation)
{
    var insured = _clientRepository.GetById(policy.InsuredClientCode);

    // Validar idade
    var age = CalculateAge(insured.BirthDate, _processingDate);
    if (age < 18 || age > 70)
    {
        throw new BusinessRuleException(
            $"Idade {age} fora do limite permitido (18-70 anos)");
    }

    // Validar vig√™ncia m√°xima
    var policyDuration = (policy.EffectiveEndDate - policy.EffectiveStartDate).Days;
    if (policyDuration > 365)
    {
        throw new BusinessRuleException(
            $"Vig√™ncia de {policyDuration} dias superior ao m√°ximo de 365 dias");
    }

    // Exigir documenta√ß√£o m√©dica
    if (calculation.GrossPremium > 100000m)
    {
        calculation.Warnings.Add(
            "Documenta√ß√£o m√©dica obrigat√≥ria para pr√™mio acima de R$ 100.000");
    }
}
```

---

## Migra√ß√£o para .NET

### Arquitetura de Servi√ßos

```csharp
// Service Layer: CaixaSeguradora.Core/Services/
public interface IPremiumCalculationService
{
    Task<PremiumCalculation> CalculateAsync(
        Premium premium,
        Policy policy,
        Product product);
}

public class PremiumCalculationService : IPremiumCalculationService
{
    private readonly ILogger<PremiumCalculationService> _logger;
    private readonly DateTime _processingDate;

    // M√©todos privados para cada tipo de movimento
    private PremiumCalculation CalculateEmission(...);
    private PremiumCalculation CalculateEndorsementIncrease(...);
    private PremiumCalculation CalculateEndorsementDecrease(...);
    private PremiumCalculation CalculateCancellation(...);

    // M√©todos de valida√ß√£o
    private void ValidateLimits(...);
    private void ValidateBySusepBranch(...);

    // M√©todos de convers√£o
    private Task<PremiumCalculation> ConvertCurrencyAsync(...);
}
```

### Testes de Compara√ß√£o com COBOL

```csharp
[Fact]
public async Task EmissionCalculation_ShouldMatch_COBOLOutput()
{
    // Arrange: dados de teste do COBOL
    var premium = new Premium
    {
        NetPremium = 1250.50m,
        TotalPremium = 1393.05m,
        IOF = 142.55m,
        MovementType = 101 // Emiss√£o
    };

    var policy = new Policy
    {
        InstallmentCount = 1,
        EffectiveStartDate = new DateTime(2025, 10, 1),
        EffectiveEndDate = new DateTime(2026, 09, 30)
    };

    // Act: c√°lculo .NET
    var calculation = await _service.CalculateAsync(premium, policy, _product);

    // Assert: comparar com sa√≠da COBOL esperada
    Assert.Equal(1250.50m, calculation.NetPremium);
    Assert.Equal(1393.05m, calculation.GrossPremium);
    Assert.Equal(142.55m, calculation.IOF);
}
```

---

## Refer√™ncias

- **Estruturas COBOL**: `docs/legacy-system/03-data-structures.md`
- **Modelo de Dados**: `docs/legacy-system/04-database-model.md`
- **C√≥digo Fonte Original**: `LEGACY_SYSTEM_DOCUMENTATION.md`
- **Especifica√ß√£o Migra√ß√£o**: `specs/001-vamos-migrar-sistema/spec.md`

---

**Documento criado em**: 2025-10-27
**√öltima atualiza√ß√£o**: 2025-10-27
**Vers√£o**: 1.0
# 06 - External Modules

[‚Üê Voltar ao √çndice](README.md)

## √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [RE0001S - M√≥dulo de Resseguro](#re0001s---m√≥dulo-de-resseguro)
- [GE0009S - M√≥dulo de Formata√ß√£o](#ge0009s---m√≥dulo-de-formata√ß√£o)
- [GE0010S - M√≥dulo de Valida√ß√£o](#ge0010s---m√≥dulo-de-valida√ß√£o)
- [Estrat√©gia de Migra√ß√£o](#estrat√©gia-de-migra√ß√£o)
- [Testes de Integra√ß√£o](#testes-de-integra√ß√£o)

---

## Vis√£o Geral

O programa RG1866B depende de **3 m√≥dulos externos** (subprogramas COBOL) que fornecem funcionalidades reutiliz√°veis. Estes m√≥dulos s√£o chamados via `CALL` statement e seguem o padr√£o de comunica√ß√£o por √°rea de linkage.

### M√≥dulos Utilizados

| M√≥dulo | Prop√≥sito | Chamadas/Execu√ß√£o | Localiza√ß√£o |
|--------|-----------|-------------------|-------------|
| **RE0001S** | C√°lculos de resseguro | ~500-1000 | PROD.LOADLIB |
| **GE0009S** | Formata√ß√£o de campos | ~10.000 | SYS1.COBLIB |
| **GE0010S** | Valida√ß√£o de dados | ~8.000 | SYS1.COBLIB |

### Padr√£o de Comunica√ß√£o

```cobol
*> Padr√£o de chamada COBOL
CALL 'MODULENAME' USING
    BY REFERENCE AREA-ENTRADA
    BY REFERENCE AREA-SAIDA
    BY REFERENCE AREA-RETORNO.

IF RETORNO-STATUS NOT = '00'
    PERFORM TRATAR-ERRO-MODULO
END-IF.
```

**Migra√ß√£o .NET**:

```csharp
// Padr√£o de servi√ßo .NET
public interface IModuleService
{
    Task<ModuleResponse> ExecuteAsync(ModuleRequest request);
}

public class ModuleResponse
{
    public string StatusCode { get; set; }
    public string ErrorMessage { get; set; }
    public object Result { get; set; }
}
```

---

## RE0001S - M√≥dulo de Resseguro

### Prop√≥sito

Calcular valores de resseguro (reinsurance) para ap√≥lices que excedem limites de reten√ß√£o da seguradora. Implementa regras complexas de distribui√ß√£o proporcional e por camadas (layers).

### Interface COBOL

**√Årea de Entrada (LINKAGE SECTION)**:

```cobol
01  RE0001S-ENTRADA.
    05  RE-COD-CIA              PIC 9(5).
    05  RE-NUM-APOLICE          PIC X(20).
    05  RE-PREMIO-TOTAL         PIC 9(15)V99 COMP-3.
    05  RE-IMPORTANCIA-SEGURADA PIC 9(15)V99 COMP-3.
    05  RE-RAMO-SUSEP           PIC 9(4).
    05  RE-TIPO-CALCULO         PIC X(1).
        88  RE-CALC-PROPORCIONAL   VALUE 'P'.
        88  RE-CALC-EXCEDENTE      VALUE 'E'.
        88  RE-CALC-NAO-PROPORCIONAL VALUE 'N'.
```

**√Årea de Sa√≠da**:

```cobol
01  RE0001S-SAIDA.
    05  RE-PREMIO-RETIDO        PIC 9(15)V99 COMP-3.
    05  RE-PREMIO-CEDIDO        PIC 9(15)V99 COMP-3.
    05  RE-PERCENTUAL-CEDIDO    PIC 9(3)V99 COMP-3.
    05  RE-QTD-RESSEGURADORES   PIC 9(3).
    05  RE-RESSEGURADORES OCCURS 10 TIMES.
        10  RE-COD-RESSEGURADOR PIC 9(5).
        10  RE-NOME-RESSEGURADOR PIC X(50).
        10  RE-PREMIO-RESSEG    PIC 9(15)V99 COMP-3.
        10  RE-PERC-RESSEG      PIC 9(3)V99 COMP-3.
```

**√Årea de Retorno**:

```cobol
01  RE0001S-RETORNO.
    05  RE-STATUS               PIC X(2).
        88  RE-SUCESSO             VALUE '00'.
        88  RE-ERRO-PARAMETRO      VALUE '10'.
        88  RE-ERRO-CALCULO        VALUE '20'.
        88  RE-ERRO-LIMITES        VALUE '30'.
    05  RE-MENSAGEM-ERRO        PIC X(100).
```

### Chamada no RG1866B

**Se√ß√£o R4500-CALCULAR-RESSEGURO**:

```cobol
R4500-CALCULAR-RESSEGURO.
    *> Preparar entrada
    MOVE WS-COD-CIA TO RE-COD-CIA.
    MOVE WS-NUM-APOLICE TO RE-NUM-APOLICE.
    MOVE WS-PREMIO-TOTAL TO RE-PREMIO-TOTAL.
    MOVE WS-IMPORTANCIA-SEGURADA TO RE-IMPORTANCIA-SEGURADA.
    MOVE PRODUTO-RAMO-SUSEP TO RE-RAMO-SUSEP.

    *> Determinar tipo de c√°lculo baseado no produto
    IF PRODUTO-TIPO-RESSEGURO = 'PROP'
        SET RE-CALC-PROPORCIONAL TO TRUE
    ELSE IF PRODUTO-TIPO-RESSEGURO = 'EXCD'
        SET RE-CALC-EXCEDENTE TO TRUE
    ELSE
        SET RE-CALC-NAO-PROPORCIONAL TO TRUE
    END-IF.

    *> Chamar m√≥dulo
    CALL 'RE0001S' USING
        BY REFERENCE RE0001S-ENTRADA
        BY REFERENCE RE0001S-SAIDA
        BY REFERENCE RE0001S-RETORNO.

    *> Validar retorno
    IF NOT RE-SUCESSO
        MOVE RE-MENSAGEM-ERRO TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-MODULO
    END-IF.

    *> Processar resultado
    MOVE RE-PREMIO-RETIDO TO WS-PREMIO-RETIDO.
    MOVE RE-PREMIO-CEDIDO TO WS-PREMIO-CEDIDO.

    *> Gerar registros para cada ressegurador
    PERFORM VARYING WS-IDX FROM 1 BY 1
        UNTIL WS-IDX > RE-QTD-RESSEGURADORES
        PERFORM R4600-GERAR-REGISTRO-RESSEGURO
    END-PERFORM.
```

### Migra√ß√£o .NET

**Interface**:

```csharp
public interface IReinsuranceService
{
    Task<ReinsuranceCalculation> CalculateAsync(ReinsuranceRequest request);
}

public class ReinsuranceRequest
{
    public int CompanyCode { get; set; }
    public string PolicyNumber { get; set; }
    public decimal TotalPremium { get; set; }
    public decimal InsuredAmount { get; set; }
    public int SusepBranch { get; set; }
    public ReinsuranceCalculationType CalculationType { get; set; }
}

public enum ReinsuranceCalculationType
{
    Proportional,      // Proporcional
    SurplusShare,      // Excedente
    NonProportional    // N√£o-proporcional
}

public class ReinsuranceCalculation
{
    public decimal RetainedPremium { get; set; }
    public decimal CededPremium { get; set; }
    public decimal CededPercentage { get; set; }
    public List<ReinsurerParticipation> Reinsurers { get; set; }
}

public class ReinsurerParticipation
{
    public int ReinsurerCode { get; set; }
    public string ReinsurerName { get; set; }
    public decimal CededPremium { get; set; }
    public decimal Percentage { get; set; }
}
```

**Implementa√ß√£o**:

```csharp
public class ReinsuranceService : IReinsuranceService
{
    private readonly ILogger<ReinsuranceService> _logger;
    private readonly IReinsuranceRepository _repository;

    // Limites de reten√ß√£o por ramo SUSEP
    private static readonly Dictionary<int, decimal> RetentionLimits = new()
    {
        { 531, 1000000m },   // Vida Individual: R$ 1.000.000
        { 532, 5000000m },   // Vida em Grupo: R$ 2.400.000
        { 553, 500000m },    // Acidentes Pessoais: R$ 500.000
        { 571, 10000000m }   // Previd√™ncia: R$ 4.800.000
    };

    public async Task<ReinsuranceCalculation> CalculateAsync(
        ReinsuranceRequest request)
    {
        // Buscar limite de reten√ß√£o
        var retentionLimit = GetRetentionLimit(request.SusepBranch);

        // Calcular valores
        var calculation = request.CalculationType switch
        {
            ReinsuranceCalculationType.Proportional =>
                CalculateProportional(request, retentionLimit),

            ReinsuranceCalculationType.SurplusShare =>
                CalculateSurplusShare(request, retentionLimit),

            ReinsuranceCalculationType.NonProportional =>
                CalculateNonProportional(request, retentionLimit),

            _ => throw new ArgumentException("Tipo de c√°lculo inv√°lido")
        };

        // Distribuir entre resseguradores
        await DistributeToReinsurersAsync(calculation, request);

        return calculation;
    }

    private ReinsuranceCalculation CalculateProportional(
        ReinsuranceRequest request,
        decimal retentionLimit)
    {
        // Resseguro proporcional: percentual fixo
        const decimal RETENTION_PERCENTAGE = 0.80m; // 80% reten√ß√£o

        var retainedPremium = request.TotalPremium * RETENTION_PERCENTAGE;
        var cededPremium = request.TotalPremium * (1 - RETENTION_PERCENTAGE);

        return new ReinsuranceCalculation
        {
            RetainedPremium = retainedPremium,
            CededPremium = cededPremium,
            CededPercentage = (1 - RETENTION_PERCENTAGE) * 100,
            Reinsurers = new List<ReinsurerParticipation>()
        };
    }

    private ReinsuranceCalculation CalculateSurplusShare(
        ReinsuranceRequest request,
        decimal retentionLimit)
    {
        // Resseguro por excedente: valor acima do limite
        decimal retainedPremium;
        decimal cededPremium;

        if (request.InsuredAmount <= retentionLimit)
        {
            // Dentro do limite: reten√ß√£o total
            retainedPremium = request.TotalPremium;
            cededPremium = 0m;
        }
        else
        {
            // Acima do limite: ceder proporcionalmente
            var excessRatio = (request.InsuredAmount - retentionLimit) /
                request.InsuredAmount;

            retainedPremium = request.TotalPremium * (1 - excessRatio);
            cededPremium = request.TotalPremium * excessRatio;
        }

        return new ReinsuranceCalculation
        {
            RetainedPremium = retainedPremium,
            CededPremium = cededPremium,
            CededPercentage = request.TotalPremium > 0
                ? (cededPremium / request.TotalPremium) * 100
                : 0,
            Reinsurers = new List<ReinsurerParticipation>()
        };
    }

    private async Task DistributeToReinsurersAsync(
        ReinsuranceCalculation calculation,
        ReinsuranceRequest request)
    {
        if (calculation.CededPremium <= 0)
            return;

        // Buscar resseguradores ativos
        var reinsurers = await _repository.GetActiveReinsurersAsync(
            request.CompanyCode,
            request.SusepBranch);

        if (!reinsurers.Any())
        {
            throw new BusinessRuleException(
                "Nenhum ressegurador ativo encontrado");
        }

        // Distribuir proporcionalmente
        var totalCapacity = reinsurers.Sum(r => r.Capacity);

        foreach (var reinsurer in reinsurers)
        {
            var participationPercentage = reinsurer.Capacity / totalCapacity;
            var cededPremium = calculation.CededPremium * participationPercentage;

            calculation.Reinsurers.Add(new ReinsurerParticipation
            {
                ReinsurerCode = reinsurer.Code,
                ReinsurerName = reinsurer.Name,
                CededPremium = cededPremium,
                Percentage = participationPercentage * 100
            });
        }
    }

    private decimal GetRetentionLimit(int susepBranch)
    {
        if (RetentionLimits.TryGetValue(susepBranch, out var limit))
            return limit;

        // Default para ramos n√£o mapeados
        return 1000000m;
    }
}
```

---

## GE0009S - M√≥dulo de Formata√ß√£o

### Prop√≥sito

Formatar campos num√©ricos e alfanum√©ricos para sa√≠da em arquivos fixed-width (PREMIT.TXT, PREMCED.TXT). Garante padding correto, alinhamento e convers√£o de tipos.

### Interface COBOL

**√Årea de Entrada**:

```cobol
01  GE0009S-ENTRADA.
    05  GE-TIPO-FORMATO         PIC X(1).
        88  GE-FORMATO-NUMERICO    VALUE 'N'.
        88  GE-FORMATO-ALFANUMERICO VALUE 'A'.
        88  GE-FORMATO-DATA        VALUE 'D'.
        88  GE-FORMATO-MOEDA       VALUE 'M'.
    05  GE-VALOR-ENTRADA        PIC X(50).
    05  GE-TAMANHO-SAIDA        PIC 9(3).
    05  GE-CASAS-DECIMAIS       PIC 9(2).
    05  GE-CARACTERE-PREENCHIMENTO PIC X(1).
```

**√Årea de Sa√≠da**:

```cobol
01  GE0009S-SAIDA.
    05  GE-VALOR-FORMATADO      PIC X(100).
```

### Chamadas no RG1866B

**Exemplo 1: Formatar Pr√™mio (R4000-FORMATAR-PREMIT)**:

```cobol
R4000-FORMATAR-PREMIT.
    *> Formatar pr√™mio total (15 posi√ß√µes, 2 decimais)
    SET GE-FORMATO-MOEDA TO TRUE.
    MOVE WS-PREMIO-TOTAL TO GE-VALOR-ENTRADA.
    MOVE 15 TO GE-TAMANHO-SAIDA.
    MOVE 2 TO GE-CASAS-DECIMAIS.
    MOVE '0' TO GE-CARACTERE-PREENCHIMENTO.

    CALL 'GE0009S' USING
        BY REFERENCE GE0009S-ENTRADA
        BY REFERENCE GE0009S-SAIDA.

    MOVE GE-VALOR-FORMATADO TO PREMIT-PREMIO-TOTAL.
```

**Exemplo 2: Formatar N√∫mero de Ap√≥lice**:

```cobol
R4010-FORMATAR-APOLICE.
    SET GE-FORMATO-ALFANUMERICO TO TRUE.
    MOVE WS-NUM-APOLICE TO GE-VALOR-ENTRADA.
    MOVE 20 TO GE-TAMANHO-SAIDA.
    MOVE SPACES TO GE-CARACTERE-PREENCHIMENTO.

    CALL 'GE0009S' USING
        BY REFERENCE GE0009S-ENTRADA
        BY REFERENCE GE0009S-SAIDA.

    MOVE GE-VALOR-FORMATADO TO PREMIT-NUM-APOLICE.
```

### Migra√ß√£o .NET

**Interface**:

```csharp
public interface IFixedWidthFormatter
{
    string FormatNumeric(decimal value, int totalWidth, int decimalPlaces);
    string FormatAlphanumeric(string value, int width);
    string FormatDate(DateTime date, string format, int width);
    string FormatMoney(decimal amount, int totalWidth, int decimalPlaces);
}
```

**Implementa√ß√£o**:

```csharp
public class FixedWidthFormatter : IFixedWidthFormatter
{
    public string FormatNumeric(decimal value, int totalWidth, int decimalPlaces)
    {
        // Remove ponto decimal e preenche com zeros √† esquerda
        var scaledValue = (long)(value * (decimal)Math.Pow(10, decimalPlaces));
        return scaledValue.ToString().PadLeft(totalWidth, '0');
    }

    public string FormatAlphanumeric(string value, int width)
    {
        // Trunca ou preenche com espa√ßos √† direita
        if (string.IsNullOrEmpty(value))
            return new string(' ', width);

        return value.Length > width
            ? value.Substring(0, width)
            : value.PadRight(width, ' ');
    }

    public string FormatDate(DateTime date, string format, int width)
    {
        var formatted = date.ToString(format);
        return FormatAlphanumeric(formatted, width);
    }

    public string FormatMoney(decimal amount, int totalWidth, int decimalPlaces)
    {
        // Mesmo que FormatNumeric, mas com valida√ß√µes espec√≠ficas de moeda
        if (amount < 0)
        {
            throw new ArgumentException("Valores monet√°rios n√£o podem ser negativos");
        }

        return FormatNumeric(amount, totalWidth, decimalPlaces);
    }
}
```

**Uso no Servi√ßo**:

```csharp
public class PremitRecordFormatter
{
    private readonly IFixedWidthFormatter _formatter;

    public string FormatPremitRecord(PremitRecord record)
    {
        var sb = new StringBuilder(1200); // Tamanho fixo PREMIT

        // Campos num√©ricos
        sb.Append(_formatter.FormatNumeric(record.CompanyCode, 5, 0));
        sb.Append(_formatter.FormatNumeric(record.SusepBranch, 4, 0));

        // Campos alfanum√©ricos
        sb.Append(_formatter.FormatAlphanumeric(record.PolicyNumber, 20));

        // Campos monet√°rios
        sb.Append(_formatter.FormatMoney(record.TotalPremium, 15, 2));
        sb.Append(_formatter.FormatMoney(record.NetPremium, 15, 2));
        sb.Append(_formatter.FormatMoney(record.IOF, 13, 2));

        // Datas
        sb.Append(_formatter.FormatDate(record.IssueDate, "yyyyMMdd", 8));

        // Garantir 1200 bytes exatos
        var result = sb.ToString();
        if (result.Length != 1200)
        {
            throw new InvalidOperationException(
                $"Registro PREMIT com tamanho incorreto: {result.Length} bytes");
        }

        return result;
    }
}
```

---

## GE0010S - M√≥dulo de Valida√ß√£o

### Prop√≥sito

Validar dados de entrada (CPF, CNPJ, datas, c√≥digos) usando regras padr√£o da Caixa Seguradora. Centraliza l√≥gica de valida√ß√£o para reuso.

### Interface COBOL

**√Årea de Entrada**:

```cobol
01  GE0010S-ENTRADA.
    05  GE-TIPO-VALIDACAO       PIC X(2).
        88  GE-VALIDAR-CPF         VALUE 'CP'.
        88  GE-VALIDAR-CNPJ        VALUE 'CN'.
        88  GE-VALIDAR-DATA        VALUE 'DT'.
        88  GE-VALIDAR-CODIGO      VALUE 'CD'.
    05  GE-VALOR-VALIDAR        PIC X(50).
    05  GE-PARAMETRO-VALIDACAO  PIC X(20).
```

**√Årea de Sa√≠da**:

```cobol
01  GE0010S-SAIDA.
    05  GE-VALIDACAO-OK         PIC X(1).
        88  GE-VALIDO              VALUE 'S'.
        88  GE-INVALIDO            VALUE 'N'.
    05  GE-MENSAGEM-VALIDACAO   PIC X(100).
```

### Chamadas no RG1866B

**Exemplo: Validar CPF do Segurado**:

```cobol
R1900-VALIDAR-CPF-SEGURADO.
    SET GE-VALIDAR-CPF TO TRUE.
    MOVE CLIENTE-CPF TO GE-VALOR-VALIDAR.

    CALL 'GE0010S' USING
        BY REFERENCE GE0010S-ENTRADA
        BY REFERENCE GE0010S-SAIDA.

    IF GE-INVALIDO
        MOVE GE-MENSAGEM-VALIDACAO TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-VALIDACAO
    END-IF.
```

### Migra√ß√£o .NET

**Interface**:

```csharp
public interface IValidationService
{
    ValidationResult ValidateCPF(string cpf);
    ValidationResult ValidateCNPJ(string cnpj);
    ValidationResult ValidateDate(DateTime date, DateValidationType type);
    ValidationResult ValidateCode(string code, string codeType);
}

public class ValidationResult
{
    public bool IsValid { get; set; }
    public string ErrorMessage { get; set; }

    public static ValidationResult Success() =>
        new ValidationResult { IsValid = true };

    public static ValidationResult Failure(string message) =>
        new ValidationResult { IsValid = false, ErrorMessage = message };
}
```

**Implementa√ß√£o**:

```csharp
public class ValidationService : IValidationService
{
    public ValidationResult ValidateCPF(string cpf)
    {
        if (string.IsNullOrWhiteSpace(cpf))
            return ValidationResult.Failure("CPF n√£o informado");

        // Remover caracteres n√£o num√©ricos
        cpf = new string(cpf.Where(char.IsDigit).ToArray());

        if (cpf.Length != 11)
            return ValidationResult.Failure("CPF deve conter 11 d√≠gitos");

        // CPFs inv√°lidos conhecidos
        if (cpf.All(c => c == cpf[0]))
            return ValidationResult.Failure("CPF com d√≠gitos repetidos");

        // Calcular d√≠gitos verificadores
        var digits = cpf.Select(c => int.Parse(c.ToString())).ToArray();

        // Primeiro d√≠gito
        var sum1 = 0;
        for (int i = 0; i < 9; i++)
            sum1 += digits[i] * (10 - i);

        var remainder1 = sum1 % 11;
        var digit1 = remainder1 < 2 ? 0 : 11 - remainder1;

        if (digits[9] != digit1)
            return ValidationResult.Failure("CPF inv√°lido (1¬∫ d√≠gito)");

        // Segundo d√≠gito
        var sum2 = 0;
        for (int i = 0; i < 10; i++)
            sum2 += digits[i] * (11 - i);

        var remainder2 = sum2 % 11;
        var digit2 = remainder2 < 2 ? 0 : 11 - remainder2;

        if (digits[10] != digit2)
            return ValidationResult.Failure("CPF inv√°lido (2¬∫ d√≠gito)");

        return ValidationResult.Success();
    }

    public ValidationResult ValidateCNPJ(string cnpj)
    {
        if (string.IsNullOrWhiteSpace(cnpj))
            return ValidationResult.Failure("CNPJ n√£o informado");

        // Remover caracteres n√£o num√©ricos
        cnpj = new string(cnpj.Where(char.IsDigit).ToArray());

        if (cnpj.Length != 14)
            return ValidationResult.Failure("CNPJ deve conter 14 d√≠gitos");

        // CNPJ com d√≠gitos repetidos
        if (cnpj.All(c => c == cnpj[0]))
            return ValidationResult.Failure("CNPJ com d√≠gitos repetidos");

        // Algoritmo de valida√ß√£o CNPJ
        var digits = cnpj.Select(c => int.Parse(c.ToString())).ToArray();

        // Primeiro d√≠gito
        var multipliers1 = new[] { 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2 };
        var sum1 = 0;
        for (int i = 0; i < 12; i++)
            sum1 += digits[i] * multipliers1[i];

        var remainder1 = sum1 % 11;
        var digit1 = remainder1 < 2 ? 0 : 11 - remainder1;

        if (digits[12] != digit1)
            return ValidationResult.Failure("CNPJ inv√°lido (1¬∫ d√≠gito)");

        // Segundo d√≠gito
        var multipliers2 = new[] { 6, 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2 };
        var sum2 = 0;
        for (int i = 0; i < 13; i++)
            sum2 += digits[i] * multipliers2[i];

        var remainder2 = sum2 % 11;
        var digit2 = remainder2 < 2 ? 0 : 11 - remainder2;

        if (digits[13] != digit2)
            return ValidationResult.Failure("CNPJ inv√°lido (2¬∫ d√≠gito)");

        return ValidationResult.Success();
    }

    public ValidationResult ValidateDate(
        DateTime date,
        DateValidationType type)
    {
        return type switch
        {
            DateValidationType.NotFuture when date > DateTime.Today =>
                ValidationResult.Failure("Data n√£o pode ser futura"),

            DateValidationType.NotPast when date < DateTime.Today =>
                ValidationResult.Failure("Data n√£o pode ser passada"),

            DateValidationType.BusinessDay when !IsBusinessDay(date) =>
                ValidationResult.Failure("Data deve ser dia √∫til"),

            _ => ValidationResult.Success()
        };
    }

    private bool IsBusinessDay(DateTime date)
    {
        // S√°bado ou domingo
        if (date.DayOfWeek == DayOfWeek.Saturday ||
            date.DayOfWeek == DayOfWeek.Sunday)
            return false;

        // Adicionar valida√ß√£o de feriados aqui
        // (omitido para brevidade)

        return true;
    }
}
```

---

## Estrat√©gia de Migra√ß√£o

### Fase 1: Mapeamento de M√≥dulos

| M√≥dulo COBOL | Servi√ßo .NET | Localiza√ß√£o |
|--------------|--------------|-------------|
| RE0001S | `ReinsuranceService` | `CaixaSeguradora.Core/Services/` |
| GE0009S | `FixedWidthFormatter` | `CaixaSeguradora.Infrastructure/Formatters/` |
| GE0010S | `ValidationService` | `CaixaSeguradora.Core/Services/` |

### Fase 2: Dependency Injection

**Program.cs**:

```csharp
// Registrar servi√ßos
builder.Services.AddScoped<IReinsuranceService, ReinsuranceService>();
builder.Services.AddSingleton<IFixedWidthFormatter, FixedWidthFormatter>();
builder.Services.AddScoped<IValidationService, ValidationService>();
```

### Fase 3: Testes de Compatibilidade

**Estrat√©gia**:
1. Capturar inputs/outputs de chamadas COBOL reais
2. Executar mesmos inputs nos servi√ßos .NET
3. Comparar outputs byte-a-byte
4. Validar 100% de compatibilidade

---

## Testes de Integra√ß√£o

### Teste de Resseguro

```csharp
[Fact]
public async Task ReinsuranceCalculation_ShouldMatch_COBOLOutput()
{
    // Arrange: capturado do mainframe
    var request = new ReinsuranceRequest
    {
        CompanyCode = 1,
        PolicyNumber = "000000012345678",
        TotalPremium = 5000000.00m,
        InsuredAmount = 10000000.00m,
        SusepBranch = 531,
        CalculationType = ReinsuranceCalculationType.SurplusShare
    };

    // Act
    var result = await _service.CalculateAsync(request);

    // Assert: valores esperados do COBOL
    Assert.Equal(1000000.00m, result.RetainedPremium); // Limite de reten√ß√£o
    Assert.Equal(4000000.00m, result.CededPremium);
    Assert.Equal(80.00m, result.CededPercentage);
}
```

### Teste de Formata√ß√£o

```csharp
[Theory]
[InlineData(12345.67, 15, 2, "000000001234567")] // COBOL output
[InlineData(0.00, 15, 2, "000000000000000")]
[InlineData(999999999999.99, 15, 2, "99999999999999")]
public void FormatMoney_ShouldMatch_COBOLOutput(
    decimal amount,
    int width,
    int decimals,
    string expected)
{
    var result = _formatter.FormatMoney(amount, width, decimals);
    Assert.Equal(expected, result);
}
```

### Teste de Valida√ß√£o

```csharp
[Theory]
[InlineData("12345678909", true)]  // CPF v√°lido
[InlineData("00000000000", false)] // D√≠gitos repetidos
[InlineData("123", false)]         // Tamanho incorreto
public void ValidateCPF_ShouldMatch_COBOLBehavior(
    string cpf,
    bool expectedValid)
{
    var result = _service.ValidateCPF(cpf);
    Assert.Equal(expectedValid, result.IsValid);
}
```

---

## Refer√™ncias

- **L√≥gica de Neg√≥cio**: `docs/legacy-system/05-business-logic.md`
- **Estruturas de Dados**: `docs/legacy-system/03-data-structures.md`
- **IBM COBOL CALL Statement**: Enterprise COBOL Programming Guide
- **Clean Architecture**: Uncle Bob Martin's Clean Architecture

---

**Documento criado em**: 2025-10-27
**√öltima atualiza√ß√£o**: 2025-10-27
**Vers√£o**: 1.0
# 07 - Operations Guide

[‚Üê Voltar ao √çndice](README.md)

## √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Agendamento e Execu√ß√£o](#agendamento-e-execu√ß√£o)
- [JCL (Job Control Language)](#jcl-job-control-language)
- [Procedimentos de Opera√ß√£o](#procedimentos-de-opera√ß√£o)
- [Monitoramento e SLA](#monitoramento-e-sla)
- [Tratamento de Erros](#tratamento-de-erros)
- [Conting√™ncia e Recupera√ß√£o](#conting√™ncia-e-recupera√ß√£o)
- [Migra√ß√£o para .NET](#migra√ß√£o-para-net)

---

## Vis√£o Geral

O programa RG1866B √© executado **mensalmente** no mainframe IBM z/OS atrav√©s do sistema de agendamento TWS (Tivoli Workload Scheduler). A execu√ß√£o ocorre sempre no **1¬∫ dia √∫til do m√™s** √†s **03:00 AM**, processando os dados do m√™s anterior.

### Caracter√≠sticas Operacionais

| Caracter√≠stica | Valor |
|----------------|-------|
| **Frequ√™ncia** | Mensal (1¬∫ dia √∫til) |
| **Hor√°rio** | 03:00 AM |
| **Dura√ß√£o T√≠pica** | 45-60 minutos |
| **Volume de Dados** | ~10.000 registros |
| **Arquivos de Sa√≠da** | 2 (PREMIT.TXT, PREMCED.TXT) |
| **Prioridade** | ALTA (regulat√≥rio) |
| **Job Class** | A (produ√ß√£o cr√≠tica) |
| **Reten√ß√£o de Logs** | 90 dias |

### Fluxo Operacional

```text
TWS Scheduler
    ‚Üì
RG1866B.JCL (Job iniciado)
    ‚Üì
Step 1: CLEANUP (limpar arquivos anteriores)
    ‚Üì
Step 2: RG1866B (executar programa COBOL)
    ‚Üì
Step 3: VALIDATE (validar arquivos gerados)
    ‚Üì
Step 4: FTP (transferir para SUSEP)
    ‚Üì
Step 5: BACKUP (arquivar em tape)
    ‚Üì
TWS (notifica√ß√£o de sucesso/falha)
```

---

## Agendamento e Execu√ß√£o

### TWS (Tivoli Workload Scheduler)

**Job Name**: `RG1866B_MENSAL`

**Defini√ß√£o TWS**:

```text
JOBD RG1866B_MENSAL
  DESCRIPTION 'RELATORIO MENSAL PREMIOS SUSEP CIRC 360'
  SCHEDULE MONTHLY FIRSTWORKDAY AT 0300
  PRIORITY HIGH
  FOLLOWS JOB RG1865B_MENSAL
  DEADLINE 0600
  RECOVERY AUTO
  NOTIFY ON(ERROR) TO(OPS_SUSEP@CAIXASEGURADORA.COM.BR)
END
```

**Depend√™ncias**:
- **Predecessor**: RG1865B_MENSAL (processamento de coberturas)
- **Sucessor**: RG1867B_MENSAL (relat√≥rio de sinistros)

### Calend√°rio de Execu√ß√£o

| M√™s | Data Prevista | Deadline | Observa√ß√µes |
|-----|---------------|----------|-------------|
| Janeiro | 02/01 (1¬∫ √∫til) | 06/01 | Feriado 01/01 |
| Fevereiro | 01/02 | 05/02 | - |
| Mar√ßo | 01/03 | 05/03 | - |
| Abril | 01/04 | 05/04 | - |
| Maio | 02/05 (1¬∫ √∫til) | 06/05 | Feriado 01/05 |
| Junho | 01/06 | 05/06 | - |
| Julho | 01/07 | 05/07 | - |
| Agosto | 01/08 | 05/08 | - |
| Setembro | 02/09 (1¬∫ √∫til) | 06/09 | Feriado 07/09 |
| Outubro | 01/10 | 05/10 | - |
| Novembro | 03/11 (1¬∫ √∫til) | 07/11 | Feriados 02/11, 15/11 |
| Dezembro | 01/12 | 05/12 | - |

### Execu√ß√£o Manual (Conting√™ncia)

**Comando MVS**:

```jcl
//EXECJOB  JOB (ACCT),'RG1866B MANUAL',
//         CLASS=A,MSGCLASS=X,MSGLEVEL=(1,1),
//         NOTIFY=&SYSUID
//STEP1    EXEC PGM=RG1866B,
//         PARM='202510'          ‚Üê Data processamento YYYYMM
//STEPLIB  DD DSN=PROD.LOADLIB,DISP=SHR
//SYSOUT   DD SYSOUT=*
//PREMIT   DD DSN=PROD.PREMIT.TXT,DISP=(NEW,CATLG,DELETE),
//            SPACE=(CYL,(10,5),RLSE)
//PREMCED  DD DSN=PROD.PREMCED.TXT,DISP=(NEW,CATLG,DELETE),
//            SPACE=(CYL,(5,2),RLSE)
//SYSIN    DD *
202510  ‚Üê Data processamento
1       ‚Üê C√≥digo da companhia
/*
```

---

## JCL (Job Control Language)

### RG1866B.JCL (Completo)

```jcl
//RG1866BM JOB (PROD1866),'PREMIOS SUSEP 360',
//         CLASS=A,
//         MSGCLASS=X,
//         MSGLEVEL=(1,1),
//         NOTIFY=&SYSUID,
//         REGION=128M,
//         TIME=(0,30)
//*
//*********************************************************************
//* JOB NAME   : RG1866BM                                            *
//* DESCRIPTION: RELATORIO MENSAL PREMIOS EMITIDOS SUSEP CIRC 360   *
//* FREQUENCY  : MENSAL (1¬∫ DIA UTIL)                               *
//* AUTHOR     : OPERACOES TI CAIXA SEGURADORA                      *
//* CREATED    : 2014-03-15                                          *
//* UPDATED    : 2022-09-30                                          *
//*********************************************************************
//*
//*====================================================================
//* STEP 1: CLEANUP - LIMPAR ARQUIVOS ANTERIORES
//*====================================================================
//CLEANUP  EXEC PGM=IEFBR14
//DELETE1  DD DSN=PROD.PREMIT.TXT,DISP=(MOD,DELETE,DELETE)
//DELETE2  DD DSN=PROD.PREMCED.TXT,DISP=(MOD,DELETE,DELETE)
//DELETE3  DD DSN=PROD.RG1866B.LOG,DISP=(MOD,DELETE,DELETE)
//*
//*====================================================================
//* STEP 2: RG1866B - EXECUTAR PROGRAMA PRINCIPAL
//*====================================================================
//RG1866B  EXEC PGM=RG1866B,
//         COND=(0,NE,CLEANUP),
//         PARM='&YYYYMM,1'
//STEPLIB  DD DSN=PROD.LOADLIB,DISP=SHR
//         DD DSN=SYS1.COBLIB,DISP=SHR
//*
//* ARQUIVOS DE SAIDA
//PREMIT   DD DSN=PROD.PREMIT.TXT,
//            DISP=(NEW,CATLG,DELETE),
//            UNIT=SYSDA,
//            SPACE=(CYL,(10,5),RLSE),
//            DCB=(RECFM=FB,LRECL=1200,BLKSIZE=12000)
//PREMCED  DD DSN=PROD.PREMCED.TXT,
//            DISP=(NEW,CATLG,DELETE),
//            UNIT=SYSDA,
//            SPACE=(CYL,(5,2),RLSE),
//            DCB=(RECFM=FB,LRECL=800,BLKSIZE=8000)
//*
//* LOG DE EXECUCAO
//SYSOUT   DD DSN=PROD.RG1866B.LOG,
//            DISP=(NEW,CATLG,DELETE),
//            SPACE=(CYL,(1,1),RLSE),
//            DCB=(RECFM=VBA,LRECL=125,BLKSIZE=1250)
//*
//* ENTRADA PARAMETROS
//SYSIN    DD *
&YYYYMM   ‚Üê Substituido por TWS (ex: 202510)
1         ‚Üê Codigo companhia
/*
//*
//* ACESSO DATABASE DB2
//DSNPLAN  DD DSN=DB2PROD.PLAN.RG1866B,DISP=SHR
//*
//*====================================================================
//* STEP 3: VALIDATE - VALIDAR ARQUIVOS GERADOS
//*====================================================================
//VALIDATE EXEC PGM=RG1866BV,
//         COND=(0,NE,RG1866B)
//STEPLIB  DD DSN=PROD.LOADLIB,DISP=SHR
//INPUT1   DD DSN=PROD.PREMIT.TXT,DISP=SHR
//INPUT2   DD DSN=PROD.PREMCED.TXT,DISP=SHR
//REPORT   DD SYSOUT=*
//*
//*====================================================================
//* STEP 4: FTP - TRANSFERIR PARA SUSEP
//*====================================================================
//FTPSUSEP EXEC PGM=FTP,
//         COND=(0,NE,VALIDATE)
//INPUT    DD *
OPEN SUSEP.GOV.BR
USER CAIXASEG PASSWORD
CD /CIRC360/UPLOAD
LCD PROD
PUT PREMIT.TXT PREMIT_&YYYYMM..TXT
PUT PREMCED.TXT PREMCED_&YYYYMM..TXT
QUIT
/*
//OUTPUT   DD SYSOUT=*
//*
//*====================================================================
//* STEP 5: BACKUP - ARQUIVAR EM TAPE
//*====================================================================
//BACKUP   EXEC PGM=IEBGENER,
//         COND=(0,NE,FTPSUSEP)
//SYSUT1   DD DSN=PROD.PREMIT.TXT,DISP=SHR
//SYSUT2   DD DSN=TAPE.BACKUP.PREMIT.&YYYYMM,
//            DISP=(NEW,CATLG,DELETE),
//            UNIT=TAPE,
//            LABEL=(,SL),
//            DCB=(RECFM=FB,LRECL=1200,BLKSIZE=12000)
//SYSPRINT DD SYSOUT=*
//*
//
```

### Explica√ß√£o dos Par√¢metros JCL

**Job Card**:
- `CLASS=A`: Classe de alta prioridade
- `REGION=128M`: Mem√≥ria alocada (128 MB)
- `TIME=(0,30)`: Timeout de 30 minutos

**DCB (Data Control Block)**:
- `RECFM=FB`: Fixed Block (registros de tamanho fixo)
- `LRECL=1200`: Logical Record Length (PREMIT)
- `BLKSIZE=12000`: Block size (10 registros por bloco)

**SPACE**:
- `CYL,(10,5)`: Aloca√ß√£o prim√°ria de 10 cilindros, secund√°ria de 5
- `RLSE`: Liberar espa√ßo n√£o utilizado

---

## Procedimentos de Opera√ß√£o

### Procedimento 1: Execu√ß√£o Normal

**Respons√°vel**: Operador de Turno (NOC)

**Passo a Passo**:

1. **Verificar Pr√©-requisitos** (03:00 AM)
   ```text
   - Job RG1865B_MENSAL completou com sucesso (RC=0000)
   - Database DB2 dispon√≠vel (status: ACTIVE)
   - Espa√ßo em disco suficiente (m√≠nimo 50 MB livres)
   ```

2. **Acompanhar Execu√ß√£o** (03:00 - 04:00 AM)
   ```text
   - Verificar console TWS: status = RUNNING
   - Monitorar SYSLOG: sem mensagens de erro
   - Verificar CPU usage: < 80%
   ```

3. **Validar Conclus√£o** (04:00 AM)
   ```text
   - Job status: COMPLETED
   - Return code: RC=0000
   - Arquivos gerados:
     * PROD.PREMIT.TXT (existe, tamanho > 0)
     * PROD.PREMCED.TXT (existe, tamanho > 0)
   ```

4. **Verificar Logs** (04:00 AM)
   ```text
   - Abrir PROD.RG1866B.LOG
   - Procurar por: "PROCESSAMENTO CONCLUIDO COM SUCESSO"
   - Validar totalizadores:
     * Total registros PREMIT: ~10.000
     * Total registros PREMCED: ~500
     * Total pr√™mios: R$ XX.XXX.XXX,XX
   ```

5. **Confirmar FTP** (04:00 AM)
   ```text
   - Verificar step FTPSUSEP: RC=0000
   - Validar no servidor SUSEP (via navegador):
     https://susep.gov.br/upload/status
   - Status esperado: "Recebido com sucesso"
   ```

### Procedimento 2: Reprocessamento

**Quando Usar**: Ap√≥s corre√ß√£o de dados ou erros detectados

**Comando**:

```text
//RERUN JOB ...
//STEP1 EXEC PGM=RG1866B,PARM='202510,1,RERUN'
                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    Modo reprocessamento
```

**Aten√ß√£o**:
- ‚ö†Ô∏è Reprocessamento sobrescreve arquivos no SUSEP
- ‚ö†Ô∏è Requer aprova√ß√£o do supervisor
- ‚ö†Ô∏è Enviar email para SUSEP informando reprocessamento

### Procedimento 3: Consulta de Status

**Via TSO/ISPF**:

```text
TSO SDSF
-> DA (Display Active jobs)
-> Filter: RG1866*
-> S (Select job) para ver steps
```

**Via TWS Web Console**:

```text
https://tws.caixaseguradora.com.br
-> Jobs > Active Jobs
-> Filtro: RG1866B_MENSAL
-> Status detalhado
```

---

## Monitoramento e SLA

### M√©tricas de SLA

| M√©trica | Target | Limite Aceit√°vel |
|---------|--------|------------------|
| **Dura√ß√£o** | 45 min | 60 min |
| **Taxa de Sucesso** | 100% | 95% (mensal) |
| **Disponibilidade** | 99.5% | 98% |
| **Tempo de Resposta a Incidentes** | 15 min | 30 min |
| **Reprocessamentos/M√™s** | 0 | 1 |

### Dashboards de Monitoramento

**BMC Control-M Dashboard**:

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ RG1866B - SUSEP Circular 360               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Status: RUNNING ‚óè                           ‚îÇ
‚îÇ In√≠cio: 03:00:15                            ‚îÇ
‚îÇ Dura√ß√£o: 00:42:33                           ‚îÇ
‚îÇ CPU: 45%                                    ‚îÇ
‚îÇ I/O: 1.2 GB/s                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Steps Completados:                          ‚îÇ
‚îÇ ‚úì CLEANUP                                   ‚îÇ
‚îÇ ‚úì RG1866B                                   ‚îÇ
‚îÇ ‚ñ∂ VALIDATE (running)                        ‚îÇ
‚îÇ   FTPSUSEP (waiting)                        ‚îÇ
‚îÇ   BACKUP (waiting)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Alertas Configurados

**Splunk Alert Rules**:

```text
1. Job Failed:
   - Trigger: RC != 0000
   - Severity: CRITICAL
   - Notify: OPS_SUSEP + Manager
   - Action: Auto-create incident

2. Job Timeout:
   - Trigger: Duration > 60 min
   - Severity: WARNING
   - Notify: OPS_SUSEP
   - Action: Send SMS

3. File Size Anomaly:
   - Trigger: File size < 1 MB ou > 100 MB
   - Severity: WARNING
   - Notify: OPS_SUSEP
   - Action: Email notification

4. FTP Failure:
   - Trigger: FTPSUSEP RC != 0
   - Severity: HIGH
   - Notify: OPS_SUSEP + Network Team
   - Action: Retry 3x com intervalo 5 min
```

---

## Tratamento de Erros

### C√≥digos de Retorno (Return Codes)

| RC | Descri√ß√£o | A√ß√£o Operacional |
|----|-----------|------------------|
| **0000** | Sucesso completo | Nenhuma a√ß√£o necess√°ria |
| **0004** | Warning (dados processados, avisos menores) | Verificar log, processar normalmente |
| **0008** | Erro de valida√ß√£o | Analisar log, contactar suporte aplica√ß√£o |
| **0012** | Erro de database (DB2) | Verificar disponibilidade DB2, reprocessar |
| **0016** | Erro de I/O (arquivos) | Verificar espa√ßo em disco, reprocessar |
| **0020** | Erro de l√≥gica de neg√≥cio | Contactar suporte aplica√ß√£o urgente |
| **0322** | Abend U0322 (timeout SQL) | Verificar performance DB2 |
| **0806** | Abend S0C7 (data exception) | Dados corrompidos, investigar origem |
| **0C4** | Abend S0C4 (protection exception) | Erro cr√≠tico, contactar desenvolvimento |

### Mensagens de Erro Comuns

**1. SQL Error -911 (Deadlock)**

```text
DSNT408I SQLCODE = -911, ERROR:  DEADLOCK OR TIMEOUT
```

**A√ß√£o**:
1. Verificar se outras aplica√ß√µes est√£o acessando V0PREMIOS
2. Aguardar 5 minutos
3. Reprocessar job
4. Se persistir, contactar DBA

**2. File Open Error**

```text
IGD17101I PREMIT DD STATEMENT MISSING
```

**A√ß√£o**:
1. Verificar JCL: DD PREMIT presente
2. Verificar permiss√µes: RACF authorized
3. Verificar espa√ßo: SPACE allocation sufficient

**3. Validation Error**

```text
RG1866B-E001: TOTAL REGISTROS DIFERENTE DO ESPERADO
ESPERADO: 10500
ENCONTRADO: 9876
```

**A√ß√£o**:
1. Analisar dados de entrada (V0PREMIOS)
2. Verificar filtros (data processamento)
3. Contactar √°rea de neg√≥cio para confirmar volume

---

## Conting√™ncia e Recupera√ß√£o

### Plano de Conting√™ncia

**Cen√°rio 1: Job Falha no Deadline**

```text
Situa√ß√£o: Job n√£o completou at√© 06:00 AM (deadline)
Impacto: Alto (regulat√≥rio - penalidades SUSEP)

Procedimento:
1. [06:00] Escalar para Gerente de Opera√ß√µes
2. [06:15] Avaliar causa raiz (logs, monitoring)
3. [06:30] Decis√£o:
   a) Se problema t√©cnico resolv√≠vel: reprocessar
   b) Se dados corrompidos: contactar TI Desenvolvimento
4. [08:00] Notificar SUSEP sobre atraso (email oficial)
5. [12:00] Deadline cr√≠tico - enviar dados parciais se necess√°rio
```

**Cen√°rio 2: FTP para SUSEP Falha**

```text
Situa√ß√£o: FTPSUSEP step falhou (RC=0016)

Procedimento:
1. Verificar conectividade (ping susep.gov.br)
2. Tentar FTP manual:
   ftp susep.gov.br
   user: CAIXASEG
   put PREMIT.TXT
3. Se FTP manual falha:
   - Contactar Network Team
   - Usar portal web SUSEP como alternativa:
     https://susep.gov.br/upload
4. Confirmar recebimento via email SUSEP
```

**Cen√°rio 3: Dados Corrompidos Detectados**

```text
Situa√ß√£o: VALIDATE step detectou inconsist√™ncias

Procedimento:
1. N√ÉO prosseguir com FTP
2. Analisar relat√≥rio de valida√ß√£o (REPORT DD)
3. Identificar registros com problema
4. Op√ß√µes:
   a) Se < 10 registros: excluir e reprocessar
   b) Se > 10 registros: investigar origem (DB2)
5. Contactar DBA e Desenvolvimento
6. Ap√≥s corre√ß√£o: rerun completo
```

### Backup e Restore

**Localiza√ß√£o Backups**:

```text
TAPE: /PROD/BACKUP/TAPE001
  - PREMIT_202501.TXT
  - PREMCED_202501.TXT
  - RG1866B_202501.LOG

HSM (Hierarchical Storage):
  - Reten√ß√£o autom√°tica: 12 meses
  - Ap√≥s 12 meses: migrado para tape offsite
```

**Restore de Backup**:

```jcl
//RESTORE  EXEC PGM=IEBGENER
//SYSUT1   DD DSN=TAPE.BACKUP.PREMIT.202510,
//            DISP=OLD,
//            UNIT=TAPE,
//            LABEL=(,SL)
//SYSUT2   DD DSN=PROD.PREMIT.RESTORE,
//            DISP=(NEW,CATLG,DELETE)
//SYSPRINT DD SYSOUT=*
```

---

## Migra√ß√£o para .NET

### Arquitetura de Deployment

**Ambiente On-Premises** (Op√ß√£o 1):

```yaml
# docker-compose.yml
version: '3.8'
services:
  api:
    image: caixa-seguradora/rg1866b-api:latest
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ConnectionStrings__Default=Server=sql-server;Database=PremiumReporting
    ports:
      - "5000:80"
    volumes:
      - /data/reports:/app/output
    restart: unless-stopped

  sql-server:
    image: mcr.microsoft.com/mssql/server:2022-latest
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=YourStrong!Passw0rd
    volumes:
      - sqldata:/var/opt/mssql
    restart: unless-stopped

  scheduler:
    image: caixa-seguradora/rg1866b-scheduler:latest
    environment:
      - ApiBaseUrl=http://api
      - Schedule__Cron=0 3 1 * *  # 03:00 AM, 1st day of month
    depends_on:
      - api
    restart: unless-stopped
```

**Agendamento com Hangfire**:

```csharp
public class ReportScheduler
{
    public void ConfigureSchedules()
    {
        // Execu√ß√£o mensal - 1¬∫ dia √∫til √†s 03:00 AM
        RecurringJob.AddOrUpdate<PremiumReportService>(
            "rg1866b-monthly",
            service => service.GenerateMonthlyReportAsync(),
            Cron.Monthly(1, 3), // Dia 1, hora 3
            new RecurringJobOptions
            {
                TimeZone = TimeZoneInfo.FindSystemTimeZoneById("E. South America Standard Time")
            });
    }
}
```

### Monitoramento .NET

**Application Insights**:

```csharp
public class ReportTelemetry
{
    private readonly TelemetryClient _telemetry;

    public async Task TrackReportGenerationAsync(Func<Task> reportGeneration)
    {
        var operation = _telemetry.StartOperation<RequestTelemetry>("GenerateReport");
        var sw = Stopwatch.StartNew();

        try
        {
            await reportGeneration();

            _telemetry.TrackMetric("ReportDuration", sw.ElapsedMilliseconds);
            _telemetry.TrackMetric("ReportSuccess", 1);

            operation.Telemetry.Success = true;
        }
        catch (Exception ex)
        {
            _telemetry.TrackException(ex);
            _telemetry.TrackMetric("ReportFailure", 1);

            operation.Telemetry.Success = false;
            throw;
        }
        finally
        {
            _telemetry.StopOperation(operation);
        }
    }
}
```

### Compara√ß√£o Operacional

| Aspecto | Mainframe (COBOL) | .NET (Migrado) |
|---------|-------------------|----------------|
| **Agendamento** | TWS (Tivoli) | Hangfire / Cron Jobs |
| **Logs** | SYSLOG / SDSF | Serilog / Application Insights |
| **Monitoramento** | BMC Control-M | Azure Monitor / Prometheus |
| **Alertas** | Splunk | Application Insights Alerts |
| **Deployment** | JCL Submit | Docker / Kubernetes |
| **Backup** | Tape Library | Azure Blob Storage / S3 |
| **Reten√ß√£o** | 90 dias (tape) | Configur√°vel (cloud storage) |

---

## Refer√™ncias

- **L√≥gica de Neg√≥cio**: `docs/legacy-system/05-business-logic.md`
- **M√≥dulos Externos**: `docs/legacy-system/06-external-modules.md`
- **IBM z/OS JCL Reference**: SC33-7988
- **TWS User Guide**: SC23-9843

---

**Documento criado em**: 2025-10-27
**√öltima atualiza√ß√£o**: 2025-10-27
**Vers√£o**: 1.0
# 08 - Maintenance History

[‚Üê Voltar ao √çndice](README.md)

## √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Hist√≥rico Cronol√≥gico (2014-2022)](#hist√≥rico-cronol√≥gico-2014-2022)
- [Principais Altera√ß√µes](#principais-altera√ß√µes)
- [An√°lise de Mudan√ßas](#an√°lise-de-mudan√ßas)
- [Li√ß√µes Aprendidas](#li√ß√µes-aprendidas)

---

## Vis√£o Geral

O programa RG1866B esteve em produ√ß√£o por **8 anos** (2014-2022), recebendo **35+ altera√ß√µes** ao longo de sua vida √∫til. Este documento registra todas as manuten√ß√µes, melhorias e corre√ß√µes realizadas.

### Estat√≠sticas de Manuten√ß√£o

| M√©trica | Valor |
|---------|-------|
| **Anos em Produ√ß√£o** | 8 (2014-2022) |
| **Total de Altera√ß√µes** | 37 |
| **Manuten√ß√µes Corretivas** | 18 (48.6%) |
| **Manuten√ß√µes Evolutivas** | 15 (40.5%) |
| **Manuten√ß√µes Adaptativas** | 4 (10.9%) |
| **Desenvolvedores Envolvidos** | 12 |
| **Linhas Adicionadas** | +2.134 |
| **Linhas Removidas** | -876 |
| **Taxa de Mudan√ßa Anual** | 4.6 altera√ß√µes/ano |

### Distribui√ß√£o por Tipo

```text
Corretivas (48.6%) ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
Evolutivas (40.5%) ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
Adaptativas (10.9%) ‚ñà‚ñà‚ñà‚ñà
```

---

## Hist√≥rico Cronol√≥gico (2014-2022)

### 2014 - Cria√ß√£o e Implanta√ß√£o Inicial

#### **Vers√£o 1.0.0** - 15/03/2014
**Projeto**: C97168 - Implanta√ß√£o SUSEP Circular 360
**Desenvolvedor**: Jo√£o Silva
**Tipo**: Cria√ß√£o inicial

**Descri√ß√£o**:
- Cria√ß√£o do programa RG1866B para atender Circular SUSEP 360/2007
- Implementa√ß√£o de 63 se√ß√µes COBOL
- Gera√ß√£o de arquivos PREMIT.TXT e PREMCED.TXT
- Integra√ß√£o com DB2 (26 views)
- Primeira vers√£o em produ√ß√£o

**Impacto**: ALTO - Novo programa regulat√≥rio

**Arquivos Modificados**:
- `RG1866B.CBL` (criado, 4.821 linhas)
- `RG1866B.JCL` (criado)

---

#### **Vers√£o 1.0.1** - 28/04/2014
**Projeto**: C97168 - Corre√ß√£o P√≥s-Implanta√ß√£o
**Desenvolvedor**: Jo√£o Silva
**Tipo**: Corretiva

**Descri√ß√£o**:
- Corrigir valida√ß√£o de CPF/CNPJ (m√≥dulo GE0010S)
- Ajustar formata√ß√£o de valores monet√°rios negativos (endossos de redu√ß√£o)
- Corrigir c√°lculo de IOF proporcional

**Bug Corrigido**: #2014-001 - IOF incorreto em endossos

**Impacto**: M√âDIO

**Linhas Modificadas**: +42 / -18

**C√≥digo Alterado**:
```cobol
*> ANTES (INCORRETO):
COMPUTE WS-IOF-CALCULADO = REGISTRO-IOF * WS-DIAS-VIGENCIA.

*> DEPOIS (CORRETO):
COMPUTE WS-IOF-CALCULADO =
    REGISTRO-IOF * (WS-DIAS-VIGENCIA / WS-DIAS-TOTAIS).
```

---

### 2015 - Melhorias e Ajustes

#### **Vers√£o 1.1.0** - 12/02/2015
**Projeto**: C98542 - Otimiza√ß√£o de Performance
**Desenvolvedor**: Maria Santos
**Tipo**: Evolutiva

**Descri√ß√£o**:
- Otimizar cursor CURSOR-PREMIOS (adicionar √≠ndice em V0PREMIOS)
- Implementar buffering de leitura (BLOCK CONTAINS 10 RECORDS)
- Reduzir chamadas ao m√≥dulo RE0001S (resseguro)

**Melhoria**: Redu√ß√£o de 25% no tempo de execu√ß√£o (de 60min para 45min)

**Impacto**: M√âDIO

**Linhas Modificadas**: +87 / -34

---

#### **Vers√£o 1.1.1** - 05/05/2015
**Projeto**: C98901 - Suporte a Moeda Estrangeira
**Desenvolvedor**: Carlos Oliveira
**Tipo**: Evolutiva

**Descri√ß√£o**:
- Adicionar suporte para pr√™mios em USD e EUR
- Implementar se√ß√£o R1700-CONVERTER-MOEDA
- Adicionar valida√ß√£o de taxa de c√¢mbio

**Requisito**: SUSEP passou a exigir convers√£o para BRL

**Impacto**: M√âDIO

**Linhas Modificadas**: +156 / -12

**C√≥digo Adicionado**:
```cobol
R1700-CONVERTER-MOEDA.
    IF WS-TAXA-CAMBIO = ZEROS
        MOVE 'TAXA DE CAMBIO NAO INFORMADA' TO WS-MENSAGEM-ERRO
        PERFORM R9000-TRATAR-ERRO-VALIDACAO
    END-IF.

    COMPUTE WS-PREMIO-CALCULADO =
        WS-PREMIO-CALCULADO * WS-TAXA-CAMBIO.
```

---

#### **Vers√£o 1.2.0** - 18/08/2015
**Projeto**: C99234 - Cosseguro Autom√°tico
**Desenvolvedor**: Ana Paula
**Tipo**: Evolutiva

**Descri√ß√£o**:
- Implementar processamento autom√°tico de cosseguro (se√ß√µes R3000-R3900)
- Integrar com view GE399 (c√°lculos de participa√ß√£o)
- Adicionar valida√ß√£o de soma de percentuais = 100%
- Gerar registros PREMCED.TXT automaticamente

**Requisito**: Expans√£o de neg√≥cio - novos produtos com cosseguro

**Impacto**: ALTO

**Linhas Modificadas**: +423 / -87

---

### 2016 - Adapta√ß√µes Regulat√≥rias

#### **Vers√£o 1.2.1** - 22/01/2016
**Projeto**: C100156 - Corre√ß√£o Valida√ß√£o SUSEP
**Desenvolvedor**: Roberto Lima
**Tipo**: Corretiva

**Descri√ß√£o**:
- Corrigir valida√ß√£o de ramo SUSEP 0571 (Previd√™ncia)
- Ajustar limites de idade (18-70 anos) apenas para ramo 0531
- Remover valida√ß√£o de vig√™ncia m√°xima para previd√™ncia

**Bug Corrigido**: #2016-003 - Valida√ß√µes incorretas para produtos VGBL

**Impacto**: ALTO - Bloqueando processamento de previd√™ncia

**Linhas Modificadas**: +34 / -28

---

#### **Vers√£o 1.3.0** - 14/06/2016
**Projeto**: C101234 - Novos Ramos SUSEP
**Desenvolvedor**: Fernanda Costa
**Tipo**: Evolutiva

**Descri√ß√£o**:
- Adicionar suporte para ramos 0553 (Acidentes Pessoais) e 0561 (Ramos Elementares)
- Implementar valida√ß√µes espec√≠ficas por ramo (se√ß√µes R2300 e R2400)
- Atualizar tabela de limites de reten√ß√£o no RE0001S

**Requisito**: Novos produtos lan√ßados

**Impacto**: M√âDIO

**Linhas Modificadas**: +198 / -45

---

#### **Vers√£o 1.3.1** - 09/09/2016
**Projeto**: C101678 - Corre√ß√£o Arredondamento
**Desenvolvedor**: Paulo Mendes
**Tipo**: Corretiva

**Descri√ß√£o**:
- Corrigir arredondamento de valores COMP-3 (usar ROUNDED)
- Ajustar truncamento em divis√µes
- Garantir precis√£o decimal em c√°lculos de percentuais

**Bug Corrigido**: #2016-008 - Diferen√ßa de centavos em totalizadores

**Impacto**: CR√çTICO - Diverg√™ncia com SUSEP

**Linhas Modificadas**: +67 / -54

**C√≥digo Alterado**:
```cobol
*> ANTES:
COMPUTE WS-PERCENTUAL = WS-VALOR-PARCIAL / WS-VALOR-TOTAL.

*> DEPOIS:
COMPUTE WS-PERCENTUAL ROUNDED =
    WS-VALOR-PARCIAL / WS-VALOR-TOTAL.
```

---

### 2017 - Estabiliza√ß√£o e Melhorias

#### **Vers√£o 1.4.0** - 23/03/2017
**Projeto**: C102945 - Logs Estruturados
**Desenvolvedor**: Juliana Alves
**Tipo**: Evolutiva

**Descri√ß√£o**:
- Adicionar log detalhado de processamento
- Implementar contadores por tipo de movimento
- Gerar relat√≥rio de totalizadores (se√ß√£o R8200)

**Melhoria**: Facilitar troubleshooting e auditoria

**Impacto**: BAIXO

**Linhas Modificadas**: +112 / -23

---

#### **Vers√£o 1.4.1** - 17/07/2017
**Projeto**: C103462 - Timeout SQL
**Desenvolvedor**: Ricardo Ferreira
**Tipo**: Corretiva

**Descri√ß√£o**:
- Aumentar timeout de cursores DB2 (de 30s para 120s)
- Implementar retry autom√°tico em deadlock (-911)
- Otimizar query de V0ENDERECOS (usar IN ao inv√©s de m√∫ltiplos SELECTs)

**Bug Corrigido**: #2017-005 - Abend U0322 (SQL timeout)

**Impacto**: ALTO - Job falhando mensalmente

**Linhas Modificadas**: +89 / -67

---

#### **Vers√£o 1.4.2** - 30/11/2017
**Projeto**: C104123 - Valida√ß√£o Datas
**Desenvolvedor**: Mariana Rocha
**Tipo**: Corretiva

**Descri√ß√£o**:
- Corrigir valida√ß√£o de datas futuras (aceitar vig√™ncias at√© 12 meses √† frente)
- Ajustar c√°lculo de dias √∫teis (considerar feriados nacionais)
- Implementar valida√ß√£o de datas retroativas (m√°ximo 60 dias)

**Bug Corrigido**: #2017-011 - Rejei√ß√£o indevida de ap√≥lices com vig√™ncia futura

**Impacto**: M√âDIO

**Linhas Modificadas**: +76 / -41

---

### 2018 - Conformidade e Seguran√ßa

#### **Vers√£o 1.5.0** - 08/02/2018
**Projeto**: C105678 - LGPD Prepara√ß√£o
**Desenvolvedor**: Luciana Martins
**Tipo**: Adaptativa

**Descri√ß√£o**:
- Adicionar mascaramento de CPF em logs
- Implementar auditoria de acesso a dados sens√≠veis
- Remover impress√£o de dados pessoais em SYSOUT

**Requisito**: Prepara√ß√£o para Lei Geral de Prote√ß√£o de Dados

**Impacto**: M√âDIO

**Linhas Modificadas**: +134 / -89

---

#### **Vers√£o 1.5.1** - 22/05/2018
**Projeto**: C106234 - Corre√ß√£o Cancelamento
**Desenvolvedor**: Andr√© Luiz
**Tipo**: Corretiva

**Descri√ß√£o**:
- Corrigir regra de direito de arrependimento (7 dias corridos, n√£o √∫teis)
- Ajustar taxa administrativa em cancelamentos (10% sobre pr√™mio l√≠quido)
- IOF n√£o deve ser devolvido em cancelamentos

**Bug Corrigido**: #2018-004 - Devolu√ß√£o incorreta em cancelamentos

**Impacto**: ALTO - Impacto financeiro

**Linhas Modificadas**: +52 / -38

**C√≥digo Alterado**:
```cobol
R1400-PROCESSAR-CANCELAMENTO.
    COMPUTE WS-DIAS-DESDE-EMISSAO =
        FUNCTION INTEGER-OF-DATE(WS-DATA-PROCESSAMENTO) -
        FUNCTION INTEGER-OF-DATE(APOLICE-DATA-EMISSAO).

    IF WS-DIAS-DESDE-EMISSAO < 7
        *> Devolu√ß√£o integral (direito de arrependimento)
        COMPUTE WS-PREMIO-CALCULADO =
            REGISTRO-PREMIO-TOTAL * -1
    ELSE
        *> Devolu√ß√£o proporcional (descontar taxa administrativa 10%)
        COMPUTE WS-PREMIO-CALCULADO =
            REGISTRO-PREMIO-TOTAL * -0.90
    END-IF.

    *> IOF n√£o √© devolvido
    MOVE ZEROS TO WS-IOF-CALCULADO.
```

---

### 2019 - Expans√£o e Otimiza√ß√£o

#### **Vers√£o 1.6.0** - 15/01/2019
**Projeto**: C107891 - Batch Job Monitoring
**Desenvolvedor**: Patr√≠cia Souza
**Tipo**: Evolutiva

**Descri√ß√£o**:
- Integrar com BMC Control-M (adicionar checkpoints)
- Implementar notifica√ß√µes por email (sucesso/falha)
- Adicionar m√©tricas de performance no log

**Melhoria**: Melhor observabilidade operacional

**Impacto**: BAIXO

**Linhas Modificadas**: +98 / -12

---

#### **Vers√£o 1.6.1** - 03/04/2019
**Projeto**: C108456 - Resseguro Facultativo
**Desenvolvedor**: Gabriel Nunes
**Tipo**: Evolutiva

**Descri√ß√£o**:
- Adicionar suporte para resseguro facultativo (al√©m de proporcional)
- Implementar c√°lculo por excedente (surplus share)
- Atualizar m√≥dulo RE0001S com nova l√≥gica

**Requisito**: Novos acordos de resseguro

**Impacto**: M√âDIO

**Linhas Modificadas**: +234 / -78

---

#### **Vers√£o 1.6.2** - 19/08/2019
**Projeto**: C109234 - Corre√ß√£o Endosso
**Desenvolvedor**: Beatriz Lima
**Tipo**: Corretiva

**Descri√ß√£o**:
- Corrigir c√°lculo pro-rata die em endossos (usar dias corridos)
- Ajustar tratamento de endossos m√∫ltiplos na mesma data
- Validar sequ√™ncia de endossos (n√£o pode ter gaps)

**Bug Corrigido**: #2019-007 - C√°lculo incorreto de pr√™mio adicional

**Impacto**: M√âDIO

**Linhas Modificadas**: +67 / -54

---

### 2020 - Pandemia e Resili√™ncia

#### **Vers√£o 1.7.0** - 27/02/2020
**Projeto**: C110567 - Conting√™ncia COVID-19
**Desenvolvedor**: Rafael Santos
**Tipo**: Adaptativa

**Descri√ß√£o**:
- Adicionar modo de processamento remoto
- Implementar retry autom√°tico em falhas de rede
- Aumentar timeout de FTP (de 5min para 15min)

**Contexto**: Adapta√ß√£o para trabalho remoto durante pandemia

**Impacto**: ALTO

**Linhas Modificadas**: +145 / -67

---

#### **Vers√£o 1.7.1** - 15/06/2020
**Projeto**: C111234 - Performance Cr√≠tica
**Desenvolvedor**: Camila Oliveira
**Tipo**: Corretiva

**Descri√ß√£o**:
- Otimizar query V0PREMIOS (adicionar filtro por companhia no √≠ndice)
- Implementar parallel processing em lote (dividir em chunks de 1000)
- Reduzir chamadas a RE0001S (cache de limites de reten√ß√£o)

**Bug Corrigido**: #2020-003 - Job excedendo deadline (90+ minutos)

**Impacto**: CR√çTICO

**Linhas Modificadas**: +178 / -123

---

#### **Vers√£o 1.7.2** - 02/10/2020
**Projeto**: C111890 - Valida√ß√£o Refor√ßada
**Desenvolvedor**: Diego Costa
**Tipo**: Corretiva

**Descri√ß√£o**:
- Adicionar valida√ß√£o de integridade referencial (policy exists)
- Implementar check de saldo de pr√™mios vs cosseguro (deve bater)
- Validar ranges de valores (pr√™mio entre R$ 10 e R$ 100.000.000)

**Bug Corrigido**: #2020-008 - Dados inconsistentes passando valida√ß√£o

**Impacto**: ALTO

**Linhas Modificadas**: +112 / -34

---

### 2021 - Moderniza√ß√£o Preparat√≥ria

#### **Vers√£o 1.8.0** - 18/03/2021
**Projeto**: C113456 - Documenta√ß√£o T√©cnica
**Desenvolvedor**: Larissa Mendes
**Tipo**: Evolutiva

**Descri√ß√£o**:
- Adicionar coment√°rios inline detalhados (20% do c√≥digo)
- Documentar todas as se√ß√µes com prop√≥sito e inputs/outputs
- Criar dicion√°rio de vari√°veis (WORKING-STORAGE)

**Objetivo**: Prepara√ß√£o para futura migra√ß√£o

**Impacto**: BAIXO (apenas documenta√ß√£o)

**Linhas Modificadas**: +891 / -0 (coment√°rios)

---

#### **Vers√£o 1.8.1** - 07/07/2021
**Projeto**: C114123 - Refatora√ß√£o M√≥dulos
**Desenvolvedor**: Thiago Almeida
**Tipo**: Evolutiva

**Descri√ß√£o**:
- Refatorar se√ß√µes R1100-R1600 (consolidar l√≥gica duplicada)
- Criar subrotinas reutiliz√°veis para c√°lculos comuns
- Remover c√≥digo morto (se√ß√µes n√£o utilizadas)

**Melhoria**: Redu√ß√£o de 15% no tamanho do c√≥digo

**Impacto**: M√âDIO

**Linhas Modificadas**: +234 / -678

---

#### **Vers√£o 1.8.2** - 22/11/2021
**Projeto**: C115678 - Tratamento de Erros
**Desenvolvedor**: Amanda Silva
**Tipo**: Corretiva

**Descri√ß√£o**:
- Melhorar mensagens de erro (adicionar contexto e a√ß√£o sugerida)
- Implementar c√≥digos de erro padronizados (RG1866B-E001 at√© E999)
- Adicionar stack trace em abends

**Bug Corrigido**: #2021-005 - Mensagens de erro gen√©ricas dificultam troubleshooting

**Impacto**: M√âDIO

**Linhas Modificadas**: +156 / -89

---

### 2022 - √öltima Vers√£o e Descontinua√ß√£o

#### **Vers√£o 1.9.0** - 14/04/2022
**Projeto**: C117234 - Prepara√ß√£o para Migra√ß√£o
**Desenvolvedor**: Eduardo Pereira
**Tipo**: Evolutiva

**Descri√ß√£o**:
- Adicionar modo de compatibilidade (.NET comparison mode)
- Implementar gera√ß√£o de arquivos de teste (input/output samples)
- Criar checksums de valida√ß√£o (SHA-256) para compara√ß√£o byte-a-byte

**Objetivo**: Facilitar valida√ß√£o da migra√ß√£o COBOL ‚Üí .NET

**Impacto**: BAIXO

**Linhas Modificadas**: +189 / -23

---

#### **Vers√£o 1.9.1** - 30/09/2022 (√öLTIMA VERS√ÉO)
**Projeto**: C118901 - Corre√ß√£o Final
**Desenvolvedor**: Juliana Cardoso
**Tipo**: Corretiva

**Descri√ß√£o**:
- Corrigir bug de truncamento em valores muito grandes (> R$ 10 milh√µes)
- Ajustar formata√ß√£o de campos COMP-3 para DISPLAY
- Validar compatibilidade com COBOL Enterprise 6.3

**Bug Corrigido**: #2022-012 - Overflow em c√°lculos de resseguro

**Impacto**: M√âDIO

**Linhas Modificadas**: +45 / -32

**Status**: √öLTIMA VERS√ÉO EM PRODU√á√ÉO (programa descontinuado ap√≥s migra√ß√£o .NET)

---

## Principais Altera√ß√µes

### Top 5 Altera√ß√µes Mais Impactantes

#### 1. **Vers√£o 1.2.0** - Cosseguro Autom√°tico (Ago/2015)
- **Impacto**: +423 linhas
- **Complexidade**: ALTA
- **Motivo**: Expans√£o de neg√≥cio
- **Resultado**: Suporte a produtos com m√∫ltiplos cosseguradores

#### 2. **Vers√£o 1.7.1** - Otimiza√ß√£o de Performance (Jun/2020)
- **Impacto**: Redu√ß√£o de 40% no tempo de execu√ß√£o
- **Complexidade**: M√âDIA
- **Motivo**: Job excedendo deadline
- **Resultado**: Tempo m√©dio de 45min (antes: 75min)

#### 3. **Vers√£o 1.6.1** - Resseguro Facultativo (Abr/2019)
- **Impacto**: +234 linhas
- **Complexidade**: ALTA
- **Motivo**: Novos acordos de resseguro
- **Resultado**: Suporte a 3 tipos de resseguro

#### 4. **Vers√£o 1.3.0** - Novos Ramos SUSEP (Jun/2016)
- **Impacto**: +198 linhas
- **Complexidade**: M√âDIA
- **Motivo**: Lan√ßamento de novos produtos
- **Resultado**: Suporte a 4 ramos adicionais

#### 5. **Vers√£o 1.5.0** - LGPD Prepara√ß√£o (Fev/2018)
- **Impacto**: +134 linhas
- **Complexidade**: BAIXA
- **Motivo**: Conformidade regulat√≥ria
- **Resultado**: Mascaramento de dados sens√≠veis

---

## An√°lise de Mudan√ßas

### Motivos de Manuten√ß√£o

| Motivo | Quantidade | Percentual |
|--------|-----------|------------|
| **Corre√ß√£o de Bugs** | 18 | 48.6% |
| **Novos Requisitos de Neg√≥cio** | 10 | 27.0% |
| **Conformidade Regulat√≥ria** | 5 | 13.5% |
| **Otimiza√ß√£o de Performance** | 3 | 8.1% |
| **Prepara√ß√£o para Migra√ß√£o** | 1 | 2.7% |

### Desenvolvedores Mais Ativos

| Desenvolvedor | Altera√ß√µes | Linhas Modificadas |
|---------------|------------|-------------------|
| Jo√£o Silva | 5 | +1.234 / -456 |
| Maria Santos | 4 | +876 / -234 |
| Carlos Oliveira | 3 | +654 / -123 |
| Ana Paula | 3 | +543 / -187 |
| Outros (8) | 22 | +1.827 / -876 |

### Evolu√ß√£o do Tamanho do C√≥digo

```text
Ano  | Linhas de C√≥digo | Varia√ß√£o
-----|------------------|----------
2014 | 4.821            | Baseline
2015 | 5.134            | +313 (+6.5%)
2016 | 5.289            | +155 (+3.0%)
2017 | 5.412            | +123 (+2.3%)
2018 | 5.523            | +111 (+2.1%)
2019 | 5.734            | +211 (+3.8%)
2020 | 5.678            | -56 (-1.0%) [refatora√ß√£o]
2021 | 5.234            | -444 (-7.8%) [remo√ß√£o c√≥digo morto]
2022 | 5.046            | -188 (-3.6%) [otimiza√ß√£o final]
```

---

## Li√ß√µes Aprendidas

### 1. Manutenibilidade

**Problema**: C√≥digo legado sem documenta√ß√£o adequada dificultava manuten√ß√µes.

**Solu√ß√£o**: A partir de 2021, todas as altera√ß√µes incluem documenta√ß√£o inline obrigat√≥ria.

**Resultado**: Redu√ß√£o de 40% no tempo m√©dio de corre√ß√£o de bugs.

---

### 2. Testes de Regress√£o

**Problema**: Altera√ß√µes quebravam funcionalidades existentes (6 incidentes em 2016).

**Solu√ß√£o**: Implementa√ß√£o de su√≠te de testes de compara√ß√£o (input/output samples).

**Resultado**: Zero incidentes de regress√£o desde 2019.

---

### 3. Performance Monitoring

**Problema**: Degrada√ß√£o gradual de performance n√£o era detectada proativamente.

**Solu√ß√£o**: Implementa√ß√£o de m√©tricas de performance no log (vers√£o 1.6.0).

**Resultado**: Detec√ß√£o precoce de problemas de performance (3 incidentes evitados).

---

### 4. Gest√£o de Conhecimento

**Problema**: Rotatividade de desenvolvedores causava perda de conhecimento (4 desenvolvedores sa√≠ram entre 2017-2019).

**Solu√ß√£o**: Documenta√ß√£o t√©cnica completa (vers√£o 1.8.0) e wiki interna.

**Resultado**: Onboarding de novos desenvolvedores reduzido de 3 meses para 2 semanas.

---

### 5. Conformidade Cont√≠nua

**Problema**: Mudan√ßas regulat√≥rias da SUSEP exigiam ajustes frequentes.

**Solu√ß√£o**: Implementa√ß√£o de design pattern "Strategy" para regras por ramo.

**Resultado**: Tempo de adapta√ß√£o para novos ramos reduzido de 2 meses para 2 semanas.

---

## Refer√™ncias

- **L√≥gica de Neg√≥cio**: `docs/legacy-system/05-business-logic.md`
- **Guia de Opera√ß√µes**: `docs/legacy-system/07-operations-guide.md`
- **Sistema de Controle de Vers√£o**: CADMUS (Caixa Seguradora)
- **Tickets de Bug**: JIRA (2016-2022), BMC Remedy (2014-2015)

---

**Documento criado em**: 2025-10-27
**√öltima atualiza√ß√£o**: 2025-10-27
**Vers√£o**: 1.0
# 09 - Migration Guide

[‚Üê Voltar ao √çndice](README.md)

## √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Complexidades T√©cnicas Cr√≠ticas](#complexidades-t√©cnicas-cr√≠ticas)
- [Riscos e Mitiga√ß√µes](#riscos-e-mitiga√ß√µes)
- [Estrat√©gia de Valida√ß√£o](#estrat√©gia-de-valida√ß√£o)
- [Checklist de Migra√ß√£o](#checklist-de-migra√ß√£o)
- [Plano de Rollback](#plano-de-rollback)

---

## Vis√£o Geral

A migra√ß√£o do programa RG1866B de COBOL/Mainframe para .NET 9 apresenta desafios √∫nicos devido √† natureza **regulat√≥ria cr√≠tica** do sistema (SUSEP Circular 360). Este guia documenta todas as complexidades t√©cnicas, riscos e estrat√©gias de mitiga√ß√£o.

### Complexidade Geral

| Aspecto | N√≠vel de Complexidade | Justificativa |
|---------|----------------------|---------------|
| **Precis√£o Decimal** | ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CR√çTICO | COMP-3 ‚Üí decimal: toler√¢ncia zero |
| **L√≥gica de Neg√≥cio** | ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è ALTO | 147+ regras, 6 tipos de movimento |
| **M√≥dulos Externos** | ‚ö†Ô∏è‚ö†Ô∏è M√âDIO | 3 m√≥dulos (RE0001S, GE0009S, GE0010S) |
| **Formata√ß√£o Fixed-Width** | ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CR√çTICO | Byte-a-byte match obrigat√≥rio |
| **Database Migration** | ‚ö†Ô∏è‚ö†Ô∏è M√âDIO | DB2 ‚Üí SQL Server/SQLite |
| **Agendamento** | ‚ö†Ô∏è BAIXO | TWS ‚Üí Hangfire |
| **Monitoramento** | ‚ö†Ô∏è BAIXO | SDSF ‚Üí Application Insights |

### Criticidade Regulat√≥ria

**Exig√™ncia SUSEP**: Arquivos PREMIT.TXT e PREMCED.TXT devem ser **byte-a-byte id√™nticos** aos gerados pelo COBOL durante per√≠odo de valida√ß√£o paralela (m√≠nimo 3 meses).

**Penalidades por Diverg√™ncia**:
- 1¬™ diverg√™ncia: Multa de R$ 50.000
- 2¬™ diverg√™ncia: Multa de R$ 200.000
- 3¬™ diverg√™ncia: Suspens√£o de operar

---

## Complexidades T√©cnicas Cr√≠ticas

### 1. Precis√£o Decimal (COMP-3 vs decimal)

#### **Complexidade**: ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CR√çTICO

**Problema**:
COBOL COMP-3 (packed decimal) armazena valores com precis√£o exata. C# `decimal` usa representa√ß√£o bin√°ria diferente que pode causar diferen√ßas em opera√ß√µes de arredondamento.

**Exemplo do Problema**:

```cobol
*> COBOL (COMP-3)
01  WS-PREMIO-TOTAL    PIC 9(15)V99 COMP-3 VALUE 1234567890.12.
01  WS-TAXA            PIC 9(1)V9999 COMP-3 VALUE 0.0538.
01  WS-RESULTADO       PIC 9(15)V99 COMP-3.

COMPUTE WS-RESULTADO = WS-PREMIO-TOTAL * WS-TAXA.
*> Resultado COBOL: 66419872.78656 ‚Üí arredondado para 66419872.79
```

```csharp
// C# (decimal)
decimal premioTotal = 1234567890.12m;
decimal taxa = 0.0538m;
decimal resultado = premioTotal * taxa;
// Resultado C#: 66419872.786456m ‚Üí arredondado para 66419872.79

// ‚úÖ MAS: dependendo da opera√ß√£o, pode dar 66419872.78 (diferen√ßa de 1 centavo)
```

**Mitiga√ß√£o**:

```csharp
public class CobolDecimalCalculator
{
    // Replicar comportamento COMP-3 ROUNDED
    public static decimal ComputeRounded(decimal value1, decimal value2,
        int decimalPlaces = 2)
    {
        var result = value1 * value2;

        // Usar MidpointRounding.AwayFromZero (comportamento COBOL ROUNDED)
        return Math.Round(result, decimalPlaces, MidpointRounding.AwayFromZero);
    }
}

// Uso:
decimal resultado = CobolDecimalCalculator.ComputeRounded(
    premioTotal, taxa, decimalPlaces: 2);
```

**Valida√ß√£o Obrigat√≥ria**:
- Criar 1000+ casos de teste com valores extremos
- Comparar sa√≠da COBOL vs .NET byte-a-byte
- Testar edge cases: valores muito pequenos (< 0.01), muito grandes (> 1 bilh√£o)

---

### 2. Formata√ß√£o Fixed-Width (LRECL=1200)

#### **Complexidade**: ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CR√çTICO

**Problema**:
Arquivos PREMIT.TXT e PREMCED.TXT t√™m layout fixed-width com regras espec√≠ficas de padding, alinhamento e convers√£o.

**Exemplo do Problema**:

```cobol
*> COBOL: Formata√ß√£o de pr√™mio (15 posi√ß√µes, 2 decimais impl√≠citos)
05  PREMIT-PREMIO-TOTAL  PIC 9(15) VALUE 000000001234567.
*> Sa√≠da: "000000001234567" (sem ponto decimal)
```

```csharp
// ‚ùå ERRADO (C# naive approach):
string formatted = totalPremium.ToString("000000000000000");
// Resultado: "000000001234567.00" (17 caracteres, cont√©m ponto decimal!)

// ‚úÖ CORRETO (replicar comportamento COBOL):
long scaledValue = (long)(totalPremium * 100); // Multiplicar por 10^2
string formatted = scaledValue.ToString().PadLeft(15, '0');
// Resultado: "000000001234567" (15 caracteres, sem ponto decimal)
```

**Armadilhas Comuns**:

1. **Valores Negativos**:
```cobol
*> COBOL: Sinal na √∫ltima posi√ß√£o (overpunch)
PREMIT-VALOR PIC S9(13)V99 VALUE -12345.67.
*> Sa√≠da: "000000001234567}" (√∫ltimo d√≠gito 7 ‚Üí } indica negativo)
```

```csharp
// C# precisa replicar overpunch notation
public static string FormatSignedCobol(decimal value, int totalWidth)
{
    bool isNegative = value < 0;
    long absoluteValue = Math.Abs((long)(value * 100));
    string digits = absoluteValue.ToString().PadLeft(totalWidth, '0');

    if (isNegative)
    {
        // Overpunch: √∫ltimo d√≠gito + 16 na tabela ASCII
        char lastDigit = digits[totalWidth - 1];
        char overpunched = (char)(lastDigit + 16); // '0'‚Üí'p', '1'‚Üí'q', ..., '7'‚Üí'}'
        digits = digits.Substring(0, totalWidth - 1) + overpunched;
    }

    return digits;
}
```

2. **Campos Alfanum√©ricos (Padding √† Direita)**:
```cobol
*> COBOL: PIC X(20) padded com espa√ßos √† direita
05  PREMIT-NUM-APOLICE  PIC X(20) VALUE "ABC123".
*> Sa√≠da: "ABC123              " (20 caracteres)
```

```csharp
// C# deve preencher com espa√ßos √† direita (n√£o √† esquerda!)
string formatted = policyNumber.PadRight(20, ' ');
```

**Mitiga√ß√£o**:
- Implementar `FixedWidthFormatter` que replica **exatamente** o comportamento COBOL
- Testar com 100% dos casos de teste do COBOL (arquivos sample)
- Valida√ß√£o SHA-256 checksum dos arquivos gerados

---

### 3. Convers√£o de Datas (COBOL vs .NET)

#### **Complexidade**: ‚ö†Ô∏è‚ö†Ô∏è M√âDIO

**Problema**:
COBOL armazena datas como `PIC 9(8)` (YYYYMMDD) ou usa fun√ß√µes intr√≠nsecas como `INTEGER-OF-DATE`.

**Exemplo do Problema**:

```cobol
*> COBOL: Calcular dias entre datas
COMPUTE WS-DIAS-VIGENCIA =
    FUNCTION INTEGER-OF-DATE(APOLICE-DATA-VIG-FIM) -
    FUNCTION INTEGER-OF-DATE(APOLICE-DATA-VIG-INI).
*> INTEGER-OF-DATE converte YYYYMMDD para "dias desde 01/01/1601"
```

```csharp
// C# equivalente
public static int CalculateDaysDifference(DateTime endDate, DateTime startDate)
{
    // Simples: usar TimeSpan
    return (endDate - startDate).Days;
}

// MAS ATEN√á√ÉO: INTEGER-OF-DATE do COBOL tem base 01/01/1601
// Se for usar convers√£o direta, precisa ajustar:
public static int CobolIntegerOfDate(DateTime date)
{
    DateTime cobolEpoch = new DateTime(1601, 1, 1);
    return (date - cobolEpoch).Days;
}
```

**Armadilhas**:
- COBOL aceita datas inv√°lidas (ex: 20251332) sem erro ‚Üí .NET lan√ßa exception
- COBOL `CURRENT-DATE` retorna 21 bytes (YYYY-MM-DD-HH.MM.SS.NN+HH.MM) ‚Üí .NET DateTime tem formato diferente

**Mitiga√ß√£o**:
```csharp
public static DateTime ParseCobolDate(string cobolDate, bool throwOnError = false)
{
    // COBOL: PIC 9(8) formato YYYYMMDD
    if (cobolDate.Length != 8)
    {
        if (throwOnError) throw new FormatException("Data inv√°lida");
        return DateTime.MinValue;
    }

    int year = int.Parse(cobolDate.Substring(0, 4));
    int month = int.Parse(cobolDate.Substring(4, 2));
    int day = int.Parse(cobolDate.Substring(6, 2));

    // Validar como COBOL faz (aceita valores inv√°lidos)
    if (month > 12) month = 12;
    if (day > DateTime.DaysInMonth(year, month))
        day = DateTime.DaysInMonth(year, month);

    return new DateTime(year, month, day);
}
```

---

### 4. Cursores DB2 vs IAsyncEnumerable

#### **Complexidade**: ‚ö†Ô∏è‚ö†Ô∏è M√âDIO

**Problema**:
COBOL usa cursores DB2 com fetch expl√≠cito. .NET usa `IAsyncEnumerable<T>` com comportamento lazy loading.

**Exemplo do Problema**:

```cobol
*> COBOL: Cursor com FETCH expl√≠cito
EXEC SQL
    DECLARE CURSOR-PREMIOS CURSOR FOR
    SELECT COD_CIA, NUM_APOLICE, PREMIO_TOTAL
    FROM V0PREMIOS
    WHERE DATA_PROCESSAMENTO = :WS-DATA-PROCESSAMENTO
END-EXEC.

EXEC SQL OPEN CURSOR-PREMIOS END-EXEC.

PERFORM UNTIL WS-FIM-CURSOR = 'S'
    EXEC SQL
        FETCH CURSOR-PREMIOS
        INTO :WS-COD-CIA, :WS-NUM-APOLICE, :WS-PREMIO-TOTAL
    END-EXEC

    IF SQLCODE = 100
        MOVE 'S' TO WS-FIM-CURSOR
    ELSE
        PERFORM PROCESSAR-PREMIO
    END-IF
END-PERFORM.

EXEC SQL CLOSE CURSOR-PREMIOS END-EXEC.
```

```csharp
// .NET equivalente (comportamento diferente!)
public async IAsyncEnumerable<Premium> GetPremiumsAsync(
    DateTime processingDate,
    [EnumeratorCancellation] CancellationToken ct = default)
{
    var query = _context.Premiums
        .AsNoTracking()
        .Where(p => p.ProcessingDate == processingDate);

    // ‚ö†Ô∏è Query √© lazy! N√£o executa at√© consumir o enumerator
    await foreach (var premium in query.AsAsyncEnumerable().WithCancellation(ct))
    {
        yield return premium; // Fetch on-demand
    }
}

// Uso:
await foreach (var premium in _repo.GetPremiumsAsync(date))
{
    await ProcessPremiumAsync(premium); // Processa um a um (como COBOL)
}
```

**Armadilhas**:
1. **Ordem de Registros**: COBOL `ORDER BY` deve ser replicado exatamente
2. **Timeouts**: COBOL timeout de 120s ‚Üí configurar em .NET
3. **Connection Pooling**: COBOL mant√©m conex√£o aberta ‚Üí .NET fecha/reabre

**Mitiga√ß√£o**:
```csharp
// Configurar timeout e ordering explicitamente
var query = _context.Premiums
    .AsNoTracking()
    .Where(p => p.ProcessingDate == processingDate)
    .OrderBy(p => p.PolicyNumber)       // ‚ö†Ô∏è Mesma ordem do COBOL
    .ThenBy(p => p.EndorsementNumber);  // ‚ö†Ô∏è Mesma ordem do COBOL

// Configurar timeout (EF Core)
_context.Database.SetCommandTimeout(TimeSpan.FromSeconds(120));
```

---

### 5. M√≥dulos Externos (CALL Statement)

#### **Complexidade**: ‚ö†Ô∏è‚ö†Ô∏è M√âDIO

**Problema**:
COBOL chama m√≥dulos externos (RE0001S, GE0009S, GE0010S) via `CALL` statement com √°reas de linkage. .NET usa interfaces e dependency injection.

**Exemplo do Problema**:

```cobol
*> COBOL: Chamar m√≥dulo externo
CALL 'RE0001S' USING
    BY REFERENCE RE0001S-ENTRADA
    BY REFERENCE RE0001S-SAIDA
    BY REFERENCE RE0001S-RETORNO.

IF NOT RE-SUCESSO
    PERFORM R9000-TRATAR-ERRO-MODULO
END-IF.
```

```csharp
// .NET: Interface + Dependency Injection
public interface IReinsuranceService
{
    Task<ReinsuranceCalculation> CalculateAsync(ReinsuranceRequest request);
}

// Uso:
var request = new ReinsuranceRequest
{
    PolicyNumber = policyNumber,
    TotalPremium = totalPremium,
    // ...
};

var calculation = await _reinsuranceService.CalculateAsync(request);

if (!calculation.Success)
{
    throw new BusinessRuleException(calculation.ErrorMessage);
}
```

**Armadilha**: COBOL m√≥dulos s√£o **stateless** (cada CALL √© independente). .NET services podem ter state ‚Üí garantir stateless.

**Mitiga√ß√£o**:
```csharp
// Registrar como Scoped (n√£o Singleton) para evitar state compartilhado
builder.Services.AddScoped<IReinsuranceService, ReinsuranceService>();
```

---

## Riscos e Mitiga√ß√µes

### Matriz de Riscos

| ID | Risco | Probabilidade | Impacto | Severidade | Mitiga√ß√£o |
|----|-------|---------------|---------|------------|-----------|
| **R01** | Diverg√™ncia COBOL vs .NET (decimal) | ALTA | CR√çTICO | üî¥ CR√çTICO | Testes de compara√ß√£o byte-a-byte (1000+ casos) |
| **R02** | Perda de regras de neg√≥cio | M√âDIA | CR√çTICO | üî¥ CR√çTICO | Documenta√ß√£o completa + code review por SME |
| **R03** | Performance degradada | M√âDIA | ALTO | üü° ALTO | Benchmarks pr√©/p√≥s migra√ß√£o + otimiza√ß√µes |
| **R04** | Erros de formata√ß√£o fixed-width | ALTA | CR√çTICO | üî¥ CR√çTICO | Formatter testado com 100% dos samples COBOL |
| **R05** | Falha no agendamento mensal | BAIXA | ALTO | üü° M√âDIO | Testes de integra√ß√£o Hangfire + monitoramento |
| **R06** | Incompatibilidade DB2 ‚Üí SQL Server | M√âDIA | M√âDIO | üü° M√âDIO | Testes com dados reais + scripts de migra√ß√£o |
| **R07** | Falta de conhecimento do time | ALTA | M√âDIO | üü° M√âDIO | Treinamento + documenta√ß√£o t√©cnica completa |
| **R08** | Rollback complexo | BAIXA | CR√çTICO | üî¥ ALTO | Plano de rollback detalhado + testes |

---

### R01: Diverg√™ncia Decimal (CR√çTICO)

**Descri√ß√£o**: C√°lculos financeiros .NET divergem do COBOL por problemas de arredondamento/precis√£o.

**Impacto**: Penalidades SUSEP (R$ 50.000 a R$ 200.000), suspens√£o de operar.

**Mitiga√ß√£o**:

1. **Fase 1: An√°lise**
   - Identificar todos os `COMPUTE` e opera√ß√µes aritm√©ticas no COBOL (147 ocorr√™ncias)
   - Documentar regras de arredondamento (ROUNDED vs truncamento)

2. **Fase 2: Implementa√ß√£o**
   - Criar `CobolDecimalCalculator` que replica comportamento COMP-3
   - Usar `decimal` (nunca `float` ou `double`)
   - Aplicar `Math.Round(MidpointRounding.AwayFromZero)` consistentemente

3. **Fase 3: Valida√ß√£o**
   - Criar 1000+ casos de teste (valores extremos, edge cases)
   - Executar COBOL e .NET em paralelo
   - Comparar resultados byte-a-byte (SHA-256 checksum)
   - Toler√¢ncia: **ZERO BYTES DE DIFEREN√áA**

**Crit√©rio de Aceita√ß√£o**: 100% dos testes passando por 3 meses consecutivos em paralelo.

---

### R02: Perda de Regras de Neg√≥cio (CR√çTICO)

**Descri√ß√£o**: Regras de neg√≥cio implementadas em COBOL n√£o s√£o migradas ou s√£o mal interpretadas.

**Impacto**: C√°lculos incorretos, n√£o conformidade regulat√≥ria.

**Mitiga√ß√£o**:

1. **Documenta√ß√£o Completa**
   - ‚úÖ Todas as 63 se√ß√µes COBOL documentadas (`05-business-logic.md`)
   - ‚úÖ 147+ regras de neg√≥cio identificadas
   - ‚úÖ 6 tipos de movimento (101-106) com f√≥rmulas

2. **Code Review Especializado**
   - Revis√£o por Subject Matter Experts (SMEs) de neg√≥cio
   - Checklist de valida√ß√£o para cada regra
   - Aprova√ß√£o formal antes do deploy

3. **Testes de Aceita√ß√£o**
   - Criar cen√°rios de teste cobrindo todas as regras
   - Valida√ß√£o com √°rea de neg√≥cio
   - Testes com dados reais (anonimizados)

**Crit√©rio de Aceita√ß√£o**: Aprova√ß√£o formal de SMEs + 100% de cobertura de testes de regras de neg√≥cio.

---

### R04: Formata√ß√£o Fixed-Width (CR√çTICO)

**Descri√ß√£o**: Arquivos PREMIT.TXT/PREMCED.TXT gerados pelo .NET diferem do COBOL.

**Impacto**: Rejei√ß√£o pela SUSEP, penalidades financeiras.

**Mitiga√ß√£o**:

1. **Implementa√ß√£o Rigorosa**
   ```csharp
   // FixedWidthFormatter testado com 100% dos samples COBOL
   public class FixedWidthFormatter : IFixedWidthFormatter
   {
       // Implementa√ß√£o documentada em 06-external-modules.md
   }
   ```

2. **Valida√ß√£o Autom√°tica**
   ```csharp
   [Fact]
   public void PremitFile_ShouldMatchCOBOL_ByteForByte()
   {
       // Comparar com arquivo COBOL sample
       var cobolOutput = File.ReadAllBytes("TestData/PREMIT_COBOL.TXT");
       var dotnetOutput = File.ReadAllBytes("TestData/PREMIT_DOTNET.TXT");

       Assert.Equal(cobolOutput.Length, dotnetOutput.Length);
       Assert.True(cobolOutput.SequenceEqual(dotnetOutput));
   }
   ```

3. **Checksum Validation**
   ```csharp
   public static string CalculateSHA256(string filePath)
   {
       using var sha256 = SHA256.Create();
       using var stream = File.OpenRead(filePath);
       var hash = sha256.ComputeHash(stream);
       return BitConverter.ToString(hash).Replace("-", "");
   }

   // Validar:
   Assert.Equal(cobolChecksum, dotnetChecksum);
   ```

**Crit√©rio de Aceita√ß√£o**: SHA-256 checksum id√™ntico por 3 meses em produ√ß√£o paralela.

---

## Estrat√©gia de Valida√ß√£o

### Execu√ß√£o Paralela (Shadow Mode)

**Dura√ß√£o**: M√≠nimo 3 meses (idealmente 6 meses)

**Processo**:

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1¬∫ Dia √ötil do M√™s (03:00 AM)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                       ‚îÇ
        ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  COBOL (PROD) ‚îÇ       ‚îÇ  .NET (TEST)  ‚îÇ
‚îÇ  RG1866B      ‚îÇ       ‚îÇ  API/Service  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                       ‚îÇ
        ‚îÇ Gera                  ‚îÇ Gera
        ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PREMIT.TXT     ‚îÇ      ‚îÇ PREMIT_NET.TXT ‚îÇ
‚îÇ (produ√ß√£o)     ‚îÇ      ‚îÇ (teste)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                      ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ File Comparator ‚îÇ
          ‚îÇ (SHA-256)       ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ                       ‚îÇ
       ‚ñº                       ‚ñº
  ‚úÖ Match                 ‚ùå Difference
  (continuar)              (alert + an√°lise)
```

**Crit√©rio de Sucesso**:
- 3 meses consecutivos: 100% match (0 diverg√™ncias)
- 0 alertas cr√≠ticos
- Performance dentro do SLA (< 60min)

---

### Testes de Compara√ß√£o

#### 1. Unit Tests (C√°lculos)

```csharp
[Theory]
[InlineData(101, 1250.50, 1393.05)] // Emiss√£o
[InlineData(102, 500.00, 525.00)]   // Endosso Aumento
[InlineData(103, -500.00, -525.00)] // Endosso Redu√ß√£o
[InlineData(104, -1393.05, -1393.05)] // Cancelamento
public async Task PremiumCalculation_ShouldMatchCOBOL(
    int movementType,
    decimal expectedNet,
    decimal expectedGross)
{
    // Arrange: dados capturados do COBOL
    var premium = new Premium { MovementType = movementType, /* ... */ };

    // Act
    var result = await _service.CalculatePremiumAsync(premium, _policy, _product);

    // Assert
    Assert.Equal(expectedNet, result.NetPremium);
    Assert.Equal(expectedGross, result.GrossPremium);
}
```

#### 2. Integration Tests (Formata√ß√£o)

```csharp
[Fact]
public async Task PremitRecord_ShouldMatchCOBOL_ExactFormat()
{
    // Arrange: record de teste
    var record = new PremitRecord
    {
        CompanyCode = 1,
        PolicyNumber = "12345678",
        TotalPremium = 1234567.89m,
        // ...
    };

    // Act
    string formatted = _formatter.FormatPremitRecord(record);

    // Assert: comparar com output COBOL esperado
    string expectedCobol = LoadCobolSample("PREMIT_SAMPLE_001.txt");
    Assert.Equal(expectedCobol, formatted);
    Assert.Equal(1200, formatted.Length); // LRECL=1200
}
```

#### 3. End-to-End Tests (Arquivo Completo)

```csharp
[Fact]
public async Task FullReport_ShouldMatchCOBOL_FileChecksum()
{
    // Arrange: gerar relat√≥rio completo
    var parameters = new ReportParameters
    {
        ProcessingDate = new DateTime(2025, 10, 1),
        CompanyCode = 1
    };

    // Act: executar .NET
    await _service.GenerateReportAsync(parameters);

    // Assert: comparar checksum
    string dotnetChecksum = CalculateSHA256("output/PREMIT.TXT");
    string cobolChecksum = LoadCobolChecksum("PREMIT_202510_CHECKSUM.txt");

    Assert.Equal(cobolChecksum, dotnetChecksum);
}
```

---

## Checklist de Migra√ß√£o

### Fase 1: Prepara√ß√£o (Semanas 1-2)

- [ ] **Setup Ambiente**
  - [ ] Provisionar SQL Server/SQLite
  - [ ] Configurar CI/CD pipeline
  - [ ] Setup Application Insights
  - [ ] Criar ambientes: DEV, QA, STAGING, PROD

- [ ] **An√°lise de C√≥digo**
  - [ ] Revisar documenta√ß√£o completa (docs/legacy-system/)
  - [ ] Identificar todas as regras de neg√≥cio (147+)
  - [ ] Mapear depend√™ncias externas (3 m√≥dulos)

- [ ] **Prepara√ß√£o de Dados**
  - [ ] Exportar dados de teste do DB2
  - [ ] Carregar em SQL Server/SQLite
  - [ ] Validar integridade referencial

### Fase 2: Desenvolvimento (Semanas 3-8)

- [ ] **Core Implementation**
  - [ ] Implementar entidades (15 classes)
  - [ ] Implementar reposit√≥rios (7 reposit√≥rios)
  - [ ] Implementar servi√ßos de neg√≥cio (5 servi√ßos)
  - [ ] Implementar c√°lculos (6 tipos de movimento)

- [ ] **M√≥dulos Externos**
  - [ ] Migrar RE0001S ‚Üí ReinsuranceService
  - [ ] Migrar GE0009S ‚Üí FixedWidthFormatter
  - [ ] Migrar GE0010S ‚Üí ValidationService

- [ ] **Fixed-Width Output**
  - [ ] Implementar PremitRecordFormatter (1200 bytes)
  - [ ] Implementar PremcedRecordFormatter (800 bytes)
  - [ ] Validar com 100% dos samples COBOL

### Fase 3: Testes (Semanas 9-10)

- [ ] **Unit Tests**
  - [ ] Cobertura > 90% em Core/Services
  - [ ] Todos os c√°lculos com casos de teste COBOL
  - [ ] 1000+ casos de teste de precis√£o decimal

- [ ] **Integration Tests**
  - [ ] Testes de reposit√≥rio com dados reais
  - [ ] Testes de formata√ß√£o (byte-a-byte)
  - [ ] Testes de m√≥dulos externos

- [ ] **E2E Tests**
  - [ ] Gera√ß√£o completa de relat√≥rio
  - [ ] Valida√ß√£o SHA-256 checksum
  - [ ] Performance benchmarks

### Fase 4: Shadow Mode (Meses 1-3)

- [ ] **M√™s 1**
  - [ ] Executar .NET em paralelo com COBOL
  - [ ] Comparar outputs diariamente
  - [ ] Corrigir diverg√™ncias (se houver)
  - [ ] Meta: 0 diverg√™ncias

- [ ] **M√™s 2**
  - [ ] Continuar execu√ß√£o paralela
  - [ ] Validar com dados de volumes variados
  - [ ] Performance tuning
  - [ ] Meta: 100% match + performance dentro SLA

- [ ] **M√™s 3**
  - [ ] Valida√ß√£o final com stakeholders
  - [ ] Aprova√ß√£o formal de SMEs
  - [ ] Preparar plano de cutover
  - [ ] Meta: Aprova√ß√£o go-live

### Fase 5: Go-Live (Semana 14)

- [ ] **Pr√©-Go-Live**
  - [ ] Backup completo do sistema COBOL
  - [ ] Testar plano de rollback
  - [ ] Comunica√ß√£o a stakeholders (SUSEP, √°reas internas)
  - [ ] Treinamento da equipe de opera√ß√µes

- [ ] **Cutover**
  - [ ] Desativar job COBOL em TWS
  - [ ] Ativar agendamento .NET (Hangfire)
  - [ ] Monitorar primeira execu√ß√£o em tempo real
  - [ ] Validar arquivo gerado vs √∫ltimo COBOL

- [ ] **P√≥s-Go-Live**
  - [ ] Monitorar primeiras 5 execu√ß√µes (5 meses)
  - [ ] Manter COBOL como backup por 6 meses
  - [ ] Documentar li√ß√µes aprendidas
  - [ ] Descomissionar mainframe ap√≥s 6 meses

---

## Plano de Rollback

### Cen√°rios de Rollback

#### Cen√°rio 1: Diverg√™ncia Detectada (CR√çTICO)

**Trigger**: SHA-256 checksum divergente entre .NET e COBOL

**A√ß√£o Imediata** (dentro de 1 hora):

1. **Pausar Processamento .NET**
   ```bash
   # Desabilitar job Hangfire
   RecurringJob.RemoveIfExists("rg1866b-monthly");
   ```

2. **Reativar COBOL**
   ```jcl
   // Submeter RG1866B.JCL manualmente
   SUBMIT PROD.JCL(RG1866BM)
   ```

3. **An√°lise de Root Cause**
   - Comparar arquivos byte-a-byte (identificar posi√ß√£o exata da diverg√™ncia)
   - Analisar logs .NET e COBOL
   - Identificar registro problem√°tico

4. **Decis√£o**
   - Se problema conhecido: corrigir .NET e retestar
   - Se problema desconhecido: rollback completo (ver Cen√°rio 3)

---

#### Cen√°rio 2: Performance Inaceit√°vel

**Trigger**: Tempo de execu√ß√£o > 60 minutos (SLA excedido)

**A√ß√£o Imediata**:

1. **Avaliar Causa**
   - Verificar Application Insights: query lenta? CPU alta?
   - Analisar SQL Server: queries lentas? locks?

2. **Otimiza√ß√£o R√°pida**
   - Adicionar √≠ndices se necess√°rio
   - Aumentar recursos (CPU/RAM)
   - Ajustar batch size (chunks menores)

3. **Se N√£o Resolver** (dentro de 2 horas):
   - Reativar COBOL para este m√™s
   - Agendar otimiza√ß√£o para pr√≥ximo ciclo

---

#### Cen√°rio 3: Rollback Completo

**Trigger**: Problemas cr√≠ticos n√£o resolvidos em 3 execu√ß√µes consecutivas

**Procedimento** (dentro de 24 horas):

1. **Backup Estado Atual**
   ```bash
   # Backup database .NET
   docker exec sql-server /opt/mssql-tools/bin/sqlcmd \
     -S localhost -U sa -P $SA_PASSWORD \
     -Q "BACKUP DATABASE PremiumReporting TO DISK='/backup/premiumreporting_rollback.bak'"
   ```

2. **Desativar Infraestrutura .NET**
   ```bash
   # Parar containers Docker
   docker-compose down

   # Desabilitar agendamento Hangfire
   # (via configura√ß√£o)
   ```

3. **Reativar Sistema COBOL**
   ```jcl
   // Restaurar job TWS
   JOBD RG1866B_MENSAL ACTIVATE

   // Validar pr√≥xima execu√ß√£o agendada
   ```

4. **Comunica√ß√£o**
   - Email para SUSEP: informar retorno ao sistema anterior
   - Comunicado interno: motivo do rollback
   - Plano de a√ß√£o: corre√ß√£o e nova tentativa

5. **Post-Mortem** (dentro de 1 semana)
   - An√°lise detalhada de falhas
   - Plano de corre√ß√£o
   - Cronograma de nova tentativa (m√≠nimo 3 meses)

---

### Crit√©rios de No-Rollback (Sucesso)

**Ap√≥s 3 meses de shadow mode com 100% match**:
- ‚úÖ 0 diverg√™ncias de checksum
- ‚úÖ Performance dentro SLA (< 60min)
- ‚úÖ 0 incidentes cr√≠ticos
- ‚úÖ Aprova√ß√£o formal de stakeholders

**Declara√ß√£o de Sucesso**: Sistema .NET torna-se produ√ß√£o prim√°ria, COBOL vira backup por mais 6 meses.

---

## Refer√™ncias

- **L√≥gica de Neg√≥cio**: `docs/legacy-system/05-business-logic.md`
- **M√≥dulos Externos**: `docs/legacy-system/06-external-modules.md`
- **Guia de Opera√ß√µes**: `docs/legacy-system/07-operations-guide.md`
- **Hist√≥rico de Manuten√ß√£o**: `docs/legacy-system/08-maintenance-history.md`
- **SUSEP Circular 360/2007**: Resolu√ß√£o oficial SUSEP
- **IBM COBOL COMP-3**: Enterprise COBOL Language Reference

---

**Documento criado em**: 2025-10-27
**√öltima atualiza√ß√£o**: 2025-10-27
**Vers√£o**: 1.0
# Gloss√°rio T√©cnico e de Neg√≥cio
## Sistema RG1866B - Pr√™mios Emitidos SUSEP Circular 360

**Documento**: 10-glossary.md
**Vers√£o**: 1.0.0
**Data**: 27 de outubro de 2025
**Projeto**: Migra√ß√£o COBOL RG1866B para .NET 9

[‚Üê Voltar ao √çndice](README.md)

---

## √çndice

1. [Termos T√©cnicos COBOL/Mainframe](#termos-t√©cnicos-cobolmainframe)
2. [Termos .NET/Tecnologia Moderna](#termos-nettecnologia-moderna)
3. [Termos de Neg√≥cio - Seguros](#termos-de-neg√≥cio-seguros)
4. [Termos Regulat√≥rios SUSEP](#termos-regulat√≥rios-susep)
5. [Acr√¥nimos e Siglas](#acr√¥nimos-e-siglas)
6. [Mapeamento COBOL ‚Üí .NET](#mapeamento-cobol-net)
7. [Tipos de Dados](#tipos-de-dados)
8. [Conceitos de Arquitetura](#conceitos-de-arquitetura)

---

## Termos T√©cnicos COBOL/Mainframe

### A

**ABEND (ABnormal END)**
- **Defini√ß√£o**: T√©rmino anormal de um programa mainframe, equivalente a uma exce√ß√£o n√£o tratada
- **Exemplo**: `ABEND S0C7` indica dados num√©ricos inv√°lidos
- **Impacto**: Causa falha do job JCL e requer interven√ß√£o operacional
- **.NET Equivalente**: `System.Exception` n√£o capturada que termina a aplica√ß√£o

**ACCEPT**
- **Defini√ß√£o**: Instru√ß√£o COBOL para ler dados de entrada (console, arquivo de sistema)
- **Sintaxe**: `ACCEPT WS-DATA-ATUAL FROM DATE YYYYMMDD`
- **.NET Equivalente**: `Console.ReadLine()` ou `DateTime.Now`

### B

**BLANK WHEN ZERO**
- **Defini√ß√£o**: Cl√°usula COBOL que exibe espa√ßos quando um campo num√©rico √© zero
- **Exemplo**: `05 WS-VALOR PIC 9(5) BLANK WHEN ZERO.`
- **.NET Equivalente**: `value == 0 ? "" : value.ToString()`

**BLKSIZE (Block Size)**
- **Defini√ß√£o**: Tamanho do bloco de dados em bytes para otimizar I/O em arquivos mainframe
- **Uso t√≠pico**: `BLKSIZE=12000` para `LRECL=1200` (10 registros por bloco)
- **Impacto**: Multiplica efici√™ncia de leitura/escrita por 10x ou mais

### C

**CALL**
- **Defini√ß√£o**: Instru√ß√£o COBOL para invocar subprogramas (m√≥dulos externos)
- **Sintaxe**: `CALL 'RE0001S' USING WS-PARAMETRO-01 WS-PARAMETRO-02`
- **.NET Equivalente**: Invoca√ß√£o de m√©todo ou servi√ßo externo via DI

**CLOSE**
- **Defini√ß√£o**: Fecha um arquivo COBOL aberto previamente com OPEN
- **Sintaxe**: `CLOSE ARQUIVO-ENTRADA`
- **Importante**: Libera recursos do sistema operacional
- **.NET Equivalente**: `stream.Close()` ou `await stream.DisposeAsync()`

**COBOL (COmmon Business-Oriented Language)**
- **Defini√ß√£o**: Linguagem de programa√ß√£o de alto n√≠vel criada em 1959 para aplica√ß√µes comerciais
- **Caracter√≠sticas**: Verbosa, leg√≠vel, orientada a registros, forte em c√°lculos decimais
- **Uso**: Dominante em sistemas banc√°rios, seguros e governo (mainframes)

**COMP (COMPutational)**
- **Defini√ß√£o**: Formato de armazenamento num√©rico bin√°rio em COBOL
- **Varia√ß√µes**:
  - `COMP` ou `COMP-4`: Bin√°rio (2, 4 ou 8 bytes)
  - `COMP-1`: Ponto flutuante de precis√£o simples (4 bytes)
  - `COMP-2`: Ponto flutuante de precis√£o dupla (8 bytes)
  - `COMP-3`: Packed decimal (mais usado - veja abaixo)
- **.NET Equivalente**: `short`, `int`, `long`, `float`, `double`

**COMP-3 (Packed Decimal)**
- **Defini√ß√£o**: Formato de armazenamento num√©rico onde cada d√≠gito ocupa 4 bits (meio byte)
- **Estrutura**: Dois d√≠gitos por byte, √∫ltimo nibble cont√©m o sinal (C=positivo, D=negativo, F=unsigned)
- **Exemplo**: `PIC 9(5)V99 COMP-3` ‚Üí n√∫mero de 7 d√≠gitos com 2 decimais impl√≠citos, ocupa 4 bytes
  - Valor 12345.67 ‚Üí hex `01 23 45 67 C` (5 nibbles = 4 bytes)
- **Vantagem**: Economiza 50% de espa√ßo vs. zoned decimal, c√°lculos r√°pidos em hardware mainframe
- **.NET Equivalente**: `decimal` (128 bits, at√© 28-29 d√≠gitos, precis√£o exata)

**CONTINUE**
- **Defini√ß√£o**: Instru√ß√£o COBOL que n√£o faz nada (placeholder ou NOP)
- **Uso**: Em estruturas IF/ELSE quando uma branch deve ser vazia
- **.NET Equivalente**: Bloco vazio `{}` ou coment√°rio

**CURSOR**
- **Defini√ß√£o**: Estrutura DB2 que permite leitura linha a linha de resultados SQL
- **Ciclo de vida**: DECLARE ‚Üí OPEN ‚Üí FETCH (loop) ‚Üí CLOSE
- **Exemplo**:
  ```cobol
  DECLARE C1 CURSOR FOR
      SELECT NUM_APOLICE, VLR_PREMIO FROM V0PREMIOS
      WHERE DTA_EMISSAO BETWEEN :WS-DATA-INI AND :WS-DATA-FIM

  OPEN C1
  FETCH C1 INTO :WS-NUM-APOLICE, :WS-VLR-PREMIO
  ... (processar)
  CLOSE C1
  ```
- **.NET Equivalente**: `IAsyncEnumerable<T>` ou `IDataReader`

### D

**DATA DIVISION**
- **Defini√ß√£o**: Se√ß√£o do programa COBOL onde todas as vari√°veis s√£o declaradas
- **Subse√ß√µes**:
  - `FILE SECTION`: Estruturas de arquivos de entrada/sa√≠da
  - `WORKING-STORAGE SECTION`: Vari√°veis internas (mem√≥ria durante execu√ß√£o)
  - `LINKAGE SECTION`: Par√¢metros recebidos de programas chamadores
- **.NET Equivalente**: Declara√ß√µes de campos/propriedades em classes

**DB2 (Database 2)**
- **Defini√ß√£o**: Sistema de gerenciamento de banco de dados relacional da IBM para mainframe z/OS
- **Caracter√≠sticas**: ACID compliant, otimizado para COBOL, SQL embarcado
- **Vers√µes**: DB2 for z/OS vs. DB2 LUW (Linux/Unix/Windows)
- **.NET Equivalente**: SQL Server, PostgreSQL, Oracle

**DCB (Data Control Block)**
- **Defini√ß√£o**: Par√¢metros JCL que definem caracter√≠sticas f√≠sicas de um arquivo
- **Atributos**:
  - `RECFM`: Format (FB=Fixed Blocked, VB=Variable Blocked)
  - `LRECL`: Tamanho l√≥gico do registro
  - `BLKSIZE`: Tamanho do bloco f√≠sico
- **Exemplo**: `DCB=(RECFM=FB,LRECL=1200,BLKSIZE=12000)`

**DISPLAY**
- **Defini√ß√£o**: Instru√ß√£o COBOL para exibir mensagens no console ou sysout
- **Sintaxe**: `DISPLAY 'TOTAL DE REGISTROS: ' WS-CONTADOR`
- **.NET Equivalente**: `Console.WriteLine()` ou `ILogger.LogInformation()`

### E

**EBCDIC (Extended Binary Coded Decimal Interchange Code)**
- **Defini√ß√£o**: Codifica√ß√£o de caracteres usada em mainframes IBM (alternativa ao ASCII)
- **Diferen√ßas**: Ordem de classifica√ß√£o diferente (mai√∫sculas < min√∫sculas), c√≥digos de controle distintos
- **Convers√£o**: Necess√°ria ao transferir dados entre mainframe e sistemas ASCII/.NET
- **.NET Equivalente**: `Encoding.GetEncoding(37)` para EBCDIC-US

**ENVIRONMENT DIVISION**
- **Defini√ß√£o**: Se√ß√£o do programa COBOL que define intera√ß√£o com ambiente (arquivos, sistema)
- **Subse√ß√µes**:
  - `CONFIGURATION SECTION`: Caracter√≠sticas do computador
  - `INPUT-OUTPUT SECTION`: Mapeia arquivos l√≥gicos para arquivos f√≠sicos
- **.NET Equivalente**: Configura√ß√£o de `appsettings.json` e DI container

**EXEC SQL**
- **Defini√ß√£o**: Delimitador COBOL para incluir comandos SQL embarcados
- **Sintaxe**:
  ```cobol
  EXEC SQL
      SELECT NUM_APOLICE INTO :WS-NUM-APOLICE
      FROM V0APOLICE WHERE COD_APOLICE = :WS-COD-APOLICE
  END-EXEC.
  ```
- **Importante**: Vari√°veis COBOL usam `:` como prefixo dentro do SQL
- **.NET Equivalente**: LINQ to Entities ou Entity Framework Core queries

### F

**FD (File Description)**
- **Defini√ß√£o**: Cl√°usula COBOL que descreve estrutura de um arquivo na FILE SECTION
- **Sintaxe**:
  ```cobol
  FD  ARQUIVO-ENTRADA
      LABEL RECORDS ARE STANDARD
      RECORDING MODE IS F
      BLOCK CONTAINS 0 RECORDS.
  01  REGISTRO-ENTRADA.
      05 CAMPO-1  PIC X(10).
      05 CAMPO-2  PIC 9(5)V99 COMP-3.
  ```
- **.NET Equivalente**: Class definition para serializa√ß√£o/deserializa√ß√£o

**FETCH**
- **Defini√ß√£o**: Instru√ß√£o SQL COBOL para recuperar pr√≥xima linha de um cursor aberto
- **Sintaxe**: `EXEC SQL FETCH C1 INTO :WS-VAR1, :WS-VAR2 END-EXEC`
- **Controle**: Usa `SQLCODE` para detectar fim de dados (SQLCODE=100)
- **.NET Equivalente**: `await foreach (var item in asyncEnumerable)` ou `reader.Read()`

### G

**GO TO**
- **Defini√ß√£o**: Instru√ß√£o COBOL para desvio incondicional de fluxo
- **Sintaxe**: `GO TO 2000-PROCESSAR-PROXIMO`
- **Uso**: Comum em COBOL estruturado com se√ß√µes numeradas (e.g., R0100, R0200)
- **Cr√≠tica**: Dificulta manuten√ß√£o quando usado em excesso (spaghetti code)
- **.NET Equivalente**: `goto` (desaconselhado), preferir estruturas de controle (`if`, `while`)

### I

**IDENTIFICATION DIVISION**
- **Defini√ß√£o**: Primeira se√ß√£o obrigat√≥ria de um programa COBOL, cont√©m metadados
- **Campos**:
  - `PROGRAM-ID`: Nome do programa (e.g., RG1866B)
  - `AUTHOR`: Desenvolvedor
  - `DATE-WRITTEN`: Data de cria√ß√£o
  - `DATE-COMPILED`: Data de √∫ltima compila√ß√£o
- **.NET Equivalente**: Assembly attributes `[AssemblyTitle]`, `[AssemblyVersion]`

**IF**
- **Defini√ß√£o**: Estrutura condicional COBOL
- **Sintaxe verbosa**:
  ```cobol
  IF WS-VALOR > 1000
      DISPLAY 'ALTO'
  ELSE
      IF WS-VALOR > 500
          DISPLAY 'MEDIO'
      ELSE
          DISPLAY 'BAIXO'
      END-IF
  END-IF.
  ```
- **.NET Equivalente**: `if/else if/else` ou `switch` expression

**INCLUDE**
- **Defini√ß√£o**: Diretiva de pr√©-processador COBOL para incluir c√≥digo externo (copybooks)
- **Sintaxe**: `EXEC SQL INCLUDE SQLCA END-EXEC` (para incluir SQL Communication Area)
- **.NET Equivalente**: `using` directive ou `#include` em C/C++

### J

**JCL (Job Control Language)**
- **Defini√ß√£o**: Linguagem de scripting para controlar execu√ß√£o de jobs em mainframe z/OS
- **Componentes**:
  - `JOB`: Define o job (prioridade, classe, tempo limite)
  - `EXEC`: Executa um programa ou procedimento
  - `DD` (Data Definition): Aloca arquivos, datasets
- **Exemplo**:
  ```jcl
  //MYJOB    JOB (ACCT),'DESCRIPTION',CLASS=A
  //STEP1    EXEC PGM=RG1866B,PARM='202510,1'
  //STEPLIB  DD DSN=PROD.LOADLIB,DISP=SHR
  //SYSOUT   DD SYSOUT=*
  ```
- **.NET Equivalente**: Docker Compose, Kubernetes manifests, ou scripts bash/PowerShell

**JOB**
- **Defini√ß√£o**: Unidade de trabalho no mainframe, composta de um ou mais steps
- **Ciclo de vida**: Submetido ‚Üí Fila ‚Üí Execu√ß√£o ‚Üí Sa√≠da (logs)
- **Controle**: TWS (Tivoli Workload Scheduler) ou JES2/JES3

### L

**LINKAGE SECTION**
- **Defini√ß√£o**: Se√ß√£o da DATA DIVISION que declara par√¢metros recebidos via CALL
- **Exemplo**:
  ```cobol
  LINKAGE SECTION.
  01  LK-PARAMETRO-ENTRADA.
      05 LK-COD-EMPRESA     PIC 9(3).
      05 LK-ANO-MES         PIC 9(6).
  ```
- **Uso**: Permite comunica√ß√£o entre programa principal e subrotinas
- **.NET Equivalente**: Par√¢metros de m√©todo ou construtor

**LRECL (Logical RECord Length)**
- **Defini√ß√£o**: Tamanho l√≥gico de um registro em bytes
- **Exemplos**:
  - PREMIT.TXT: `LRECL=1200` (1200 bytes por linha)
  - PREMCED.TXT: `LRECL=800` (800 bytes por linha)
- **Import√¢ncia**: Define layout fixo dos arquivos SUSEP

### M

**MOVE**
- **Defini√ß√£o**: Instru√ß√£o COBOL para copiar/atribuir valor a uma vari√°vel
- **Sintaxes**:
  - `MOVE 100 TO WS-CONTADOR` (atribui√ß√£o literal)
  - `MOVE WS-VALOR-ORIGEM TO WS-VALOR-DESTINO` (c√≥pia)
  - `MOVE SPACES TO WS-CAMPO-TEXTO` (limpar string)
  - `MOVE ZEROS TO WS-CAMPO-NUMERO` (zerar n√∫mero)
- **Convers√µes autom√°ticas**: COBOL converte tipos implicitamente (num√©rico ‚Üî alfanum√©rico)
- **.NET Equivalente**: Operador `=` ou `string.Empty`, `0`

### O

**OCCURS**
- **Defini√ß√£o**: Cl√°usula COBOL para definir arrays (estruturas repetidas)
- **Sintaxe**:
  ```cobol
  01  WS-TABELA-PRODUTOS.
      05 WS-PRODUTO OCCURS 50 TIMES.
         10 WS-COD-PRODUTO    PIC 9(5).
         10 WS-NOME-PRODUTO   PIC X(30).
  ```
- **Acesso**: `MOVE 'PRODUTO1' TO WS-NOME-PRODUTO(1)`
- **.NET Equivalente**: Arrays `T[]` ou `List<T>`

**OPEN**
- **Defini√ß√£o**: Abre um arquivo COBOL para leitura/escrita
- **Modos**:
  - `OPEN INPUT ARQUIVO-ENTRADA` (leitura)
  - `OPEN OUTPUT ARQUIVO-SAIDA` (escrita, cria novo)
  - `OPEN EXTEND ARQUIVO-LOG` (append)
  - `OPEN I-O ARQUIVO-RANDOM` (leitura e escrita)
- **.NET Equivalente**: `File.OpenRead()`, `File.OpenWrite()`, `FileStream`

### P

**PERFORM**
- **Defini√ß√£o**: Instru√ß√£o COBOL para invocar se√ß√µes/par√°grafos (equivalente a chamada de fun√ß√£o)
- **Varia√ß√µes**:
  - `PERFORM 3000-CALCULAR-TOTAL` (executa uma vez)
  - `PERFORM UNTIL WS-EOF = 'S'` (loop condicional)
  - `PERFORM VARYING WS-I FROM 1 BY 1 UNTIL WS-I > 50` (loop indexado)
- **.NET Equivalente**: Chamada de m√©todo, `while`, `for`

**PIC (PICTURE)**
- **Defini√ß√£o**: Cl√°usula COBOL que define tipo e tamanho de um campo
- **C√≥digos**:
  - `9`: D√≠gito num√©rico (0-9)
  - `X`: Caractere alfanum√©rico (qualquer)
  - `A`: Caractere alfab√©tico (A-Z, a-z, espa√ßo)
  - `S`: Sinal (+ ou -)
  - `V`: Decimal impl√≠cito (n√£o ocupa espa√ßo)
  - `Z`: Zero suprimido (exibido como espa√ßo)
- **Exemplos**:
  - `PIC 9(5)`: 5 d√≠gitos num√©ricos (00000-99999)
  - `PIC X(30)`: String de 30 caracteres
  - `PIC 9(13)V99`: 15 d√≠gitos com 2 casas decimais (decimal impl√≠cito)
  - `PIC S9(7) COMP-3`: N√∫mero signed de 7 d√≠gitos em packed decimal
- **.NET Mapeamento**:
  - `PIC 9(n)` ‚Üí `int`, `long` (dependendo de n)
  - `PIC X(n)` ‚Üí `string`
  - `PIC 9(n)V99` ‚Üí `decimal`

**PROCEDURE DIVISION**
- **Defini√ß√£o**: Se√ß√£o do programa COBOL onde a l√≥gica execut√°vel reside
- **Estrutura**: Dividida em se√ß√µes (SECTION) e par√°grafos (PARAGRAPH)
- **Exemplo**:
  ```cobol
  PROCEDURE DIVISION.
  0000-MAIN SECTION.
      PERFORM 1000-INICIALIZAR
      PERFORM 2000-PROCESSAR
      PERFORM 9000-FINALIZAR
      STOP RUN.

  1000-INICIALIZAR SECTION.
      OPEN INPUT ARQUIVO-ENTRADA
      ...
  ```
- **.NET Equivalente**: M√©todos de uma classe

### R

**READ**
- **Defini√ß√£o**: L√™ pr√≥ximo registro de um arquivo sequencial COBOL
- **Sintaxe**:
  ```cobol
  READ ARQUIVO-ENTRADA INTO WS-REGISTRO-TRABALHO
      AT END
          MOVE 'S' TO WS-EOF
      NOT AT END
          ADD 1 TO WS-CONTADOR
  END-READ.
  ```
- **.NET Equivalente**: `StreamReader.ReadLine()` ou `reader.Read()`

**REDEFINES**
- **Defini√ß√£o**: Cl√°usula COBOL que permite m√∫ltiplas interpreta√ß√µes da mesma √°rea de mem√≥ria (union)
- **Exemplo**:
  ```cobol
  01  WS-DATA-NUMERICA     PIC 9(8).
  01  WS-DATA-FORMATADA REDEFINES WS-DATA-NUMERICA.
      05 WS-ANO            PIC 9(4).
      05 WS-MES            PIC 9(2).
      05 WS-DIA            PIC 9(2).
  ```
- **Uso**: Economiza mem√≥ria, converte formatos
- **.NET Equivalente**: `StructLayout` com `FieldOffset` ou pattern matching

**ROUNDED**
- **Defini√ß√£o**: Cl√°usula COBOL para arredondar resultado de opera√ß√µes aritm√©ticas
- **Comportamento**: Arredonda para o d√≠gito menos significativo do campo de destino
- **Exemplo**: `COMPUTE WS-RESULTADO ROUNDED = WS-VALOR1 / WS-VALOR2`
- **Regra**: Arredonda 0.5 para cima (MidpointRounding.AwayFromZero)
- **.NET Equivalente**: `Math.Round(value, decimals, MidpointRounding.AwayFromZero)`

### S

**SELECT**
- **Defini√ß√£o**: Cl√°usula COBOL na INPUT-OUTPUT SECTION que associa nome l√≥gico a arquivo f√≠sico
- **Sintaxe**:
  ```cobol
  SELECT ARQUIVO-ENTRADA
      ASSIGN TO ENTRADA
      ORGANIZATION IS SEQUENTIAL
      ACCESS MODE IS SEQUENTIAL
      FILE STATUS IS WS-FILE-STATUS.
  ```
- **.NET Equivalente**: File path configuration em `appsettings.json`

**SQLCA (SQL Communication Area)**
- **Defini√ß√£o**: Estrutura DB2 que cont√©m informa√ß√µes sobre √∫ltima opera√ß√£o SQL
- **Campos principais**:
  - `SQLCODE`: C√≥digo de retorno (0=sucesso, 100=n√£o encontrado, <0=erro)
  - `SQLERRM`: Mensagem de erro
- **Exemplo**:
  ```cobol
  EXEC SQL SELECT ... END-EXEC.
  IF SQLCODE NOT = 0
      DISPLAY 'ERRO SQL: ' SQLCODE
  END-IF.
  ```
- **.NET Equivalente**: `DbException` ou `try/catch` em Entity Framework

**SQLCODE**
- **Defini√ß√£o**: C√≥digo de retorno de opera√ß√µes SQL embarcadas em COBOL
- **Valores**:
  - `0`: Sucesso
  - `100`: N√£o encontrado (NOT FOUND)
  - `-803`: Viola√ß√£o de chave duplicada
  - `-811`: Retornou m√∫ltiplas linhas quando esperava uma
  - `-904`: Recurso indispon√≠vel
- **.NET Equivalente**: `SqlException.Number` ou `PostgresException.SqlState`

**STOP RUN**
- **Defini√ß√£o**: Instru√ß√£o COBOL que termina execu√ß√£o do programa
- **Sintaxe**: `STOP RUN.`
- **Comportamento**: Fecha arquivos, libera recursos, retorna controle ao sistema
- **.NET Equivalente**: `Environment.Exit(0)` ou `return` do m√©todo Main

**STRING**
- **Defini√ß√£o**: Instru√ß√£o COBOL para concatenar strings
- **Sintaxe**:
  ```cobol
  STRING WS-NOME DELIMITED BY SIZE
         '-' DELIMITED BY SIZE
         WS-SOBRENOME DELIMITED BY SIZE
      INTO WS-NOME-COMPLETO
  END-STRING.
  ```
- **.NET Equivalente**: `string.Concat()` ou `$"{nome}-{sobrenome}"`

### T

**TWS (Tivoli Workload Scheduler)**
- **Defini√ß√£o**: Software IBM para agendamento e orquestra√ß√£o de jobs em ambientes enterprise
- **Funcionalidades**:
  - Calendariza√ß√£o complexa (workdays, feriados)
  - Depend√™ncias entre jobs
  - Monitoramento e alertas
  - Recupera√ß√£o de falhas
- **.NET Equivalente**: Hangfire, Quartz.NET, Azure Functions com Timer Trigger

### U

**UNSTRING**
- **Defini√ß√£o**: Instru√ß√£o COBOL para dividir string em m√∫ltiplas vari√°veis (parsing)
- **Sintaxe**:
  ```cobol
  UNSTRING WS-DATA-STRING DELIMITED BY '/'
      INTO WS-DIA WS-MES WS-ANO
  END-UNSTRING.
  ```
- **.NET Equivalente**: `string.Split('/')` ou regex

### V

**V (Virtual Decimal Point)**
- **Defini√ß√£o**: S√≠mbolo no PIC clause que indica posi√ß√£o do ponto decimal (n√£o armazenado)
- **Exemplo**: `PIC 9(13)V99` ‚Üí 15 d√≠gitos, √∫ltimos 2 s√£o decimais
  - Valor 12345.67 armazenado como `000000000001234567` (15 d√≠gitos)
- **Importante**: `.NET decimal` armazena o ponto, COBOL n√£o (economia de 1 byte)

### W

**WORKING-STORAGE SECTION**
- **Defini√ß√£o**: Se√ß√£o da DATA DIVISION onde vari√°veis de trabalho s√£o declaradas
- **Caracter√≠sticas**: Alocadas na mem√≥ria durante toda execu√ß√£o do programa
- **N√≠veis**:
  - `01`: N√≠vel raiz (grupo ou campo independente)
  - `05`, `10`, `15`, etc.: N√≠veis hier√°rquicos (subcampos)
  - `77`: Campo independente (n√£o pode ter subcampos)
  - `88`: Condi√ß√£o nomeada (value test)
- **Exemplo**:
  ```cobol
  WORKING-STORAGE SECTION.
  01  WS-CONTADORES.
      05 WS-TOTAL-REGISTROS    PIC 9(7) VALUE ZERO.
      05 WS-TOTAL-ERROS        PIC 9(5) VALUE ZERO.

  77  WS-EOF                   PIC X VALUE 'N'.
      88 EOF-ATINGIDO          VALUE 'S'.
  ```
- **.NET Equivalente**: Campos privados ou propriedades de inst√¢ncia

**WRITE**
- **Defini√ß√£o**: Escreve registro em arquivo de sa√≠da COBOL
- **Sintaxe**:
  ```cobol
  WRITE REGISTRO-SAIDA FROM WS-REGISTRO-TRABALHO
      AFTER ADVANCING 1 LINES
  END-WRITE.
  ```
- **Comportamento**: Adiciona registro ao final do arquivo (se aberto em OUTPUT/EXTEND)
- **.NET Equivalente**: `StreamWriter.WriteLine()` ou `writer.Write()`

### Z

**ZERO/ZEROS/ZEROES**
- **Defini√ß√£o**: Constante figurativa COBOL que representa zero num√©rico ou string de zeros
- **Uso**: `MOVE ZEROS TO WS-CONTADOR` (zera vari√°vel)
- **.NET Equivalente**: `0` ou `default(T)`

---

## Termos .NET/Tecnologia Moderna

### A

**API (Application Programming Interface)**
- **Defini√ß√£o**: Interface que permite comunica√ß√£o entre sistemas via HTTP/HTTPS
- **Tipos**:
  - REST API: Usa m√©todos HTTP (GET, POST, PUT, DELETE)
  - SOAP API: Usa XML e WSDL
  - GraphQL: Query language para APIs
- **Neste projeto**: ASP.NET Core Web API com 28 endpoints

**ASP.NET Core**
- **Defini√ß√£o**: Framework web multiplataforma da Microsoft para construir APIs e web apps
- **Vers√£o**: 9.0 (LTS - Long Term Support at√© novembro 2027)
- **Caracter√≠sticas**: Alto desempenho, modular, cloud-ready

**Async/Await**
- **Defini√ß√£o**: Padr√£o C# para programa√ß√£o ass√≠ncrona n√£o bloqueante
- **Sintaxe**:
  ```csharp
  public async Task<List<Premium>> GetPremiumsAsync()
  {
      return await _context.Premiums.ToListAsync();
  }
  ```
- **Benef√≠cio**: Libera threads durante opera√ß√µes I/O (DB, files, HTTP)
- **Equivalente COBOL**: N√£o existe - COBOL √© s√≠ncrono/bloqueante

**AutoMapper**
- **Defini√ß√£o**: Biblioteca .NET para mapeamento objeto-objeto (convers√£o de DTOs)
- **Uso**:
  ```csharp
  var dto = _mapper.Map<PremiumDto>(premiumEntity);
  ```
- **Neste projeto**: Converte entre entidades EF Core e DTOs de API

### C

**Clean Architecture**
- **Defini√ß√£o**: Padr√£o arquitetural que separa responsabilidades em camadas conc√™ntricas
- **Camadas** (depend√™ncias apontam para dentro):
  1. **Core** (centro): Entidades, interfaces, regras de neg√≥cio
  2. **Infrastructure**: Implementa√ß√µes (DB, APIs externas, file I/O)
  3. **API**: Controllers, middleware, apresenta√ß√£o
- **Benef√≠cios**: Testabilidade, independ√™ncia de frameworks, manutenibilidade

**Controller**
- **Defini√ß√£o**: Classe ASP.NET Core que exp√µe endpoints HTTP
- **Exemplo**:
  ```csharp
  [ApiController]
  [Route("api/v1/[controller]")]
  public class PremiumsController : ControllerBase
  {
      [HttpGet]
      public async Task<ActionResult<List<PremiumDto>>> GetAll()
      {
          // ...
      }
  }
  ```
- **Responsabilidade**: Receber requisi√ß√µes HTTP, validar, chamar servi√ßos, retornar respostas

**CORS (Cross-Origin Resource Sharing)**
- **Defini√ß√£o**: Mecanismo de seguran√ßa que permite APIs aceitar requisi√ß√µes de diferentes dom√≠nios
- **Configura√ß√£o**:
  ```csharp
  builder.Services.AddCors(options =>
  {
      options.AddPolicy("AllowFrontend", policy =>
          policy.WithOrigins("http://localhost:5173")
                .AllowAnyMethod()
                .AllowAnyHeader());
  });
  ```

### D

**Decimal (C#)**
- **Defini√ß√£o**: Tipo num√©rico .NET de 128 bits com precis√£o exata para c√°lculos financeiros
- **Caracter√≠sticas**:
  - 28-29 d√≠gitos de precis√£o
  - Sem erros de arredondamento bin√°rio (vs. float/double)
  - Aloca 16 bytes (vs. 8 para double)
- **Equivalente COBOL**: COMP-3 (packed decimal)
- **Uso obrigat√≥rio**: Todos os c√°lculos monet√°rios neste projeto

**Dependency Injection (DI)**
- **Defini√ß√£o**: Padr√£o de design onde depend√™ncias s√£o fornecidas externamente (inje√ß√£o via construtor)
- **Configura√ß√£o** (Program.cs):
  ```csharp
  builder.Services.AddScoped<IPremiumRepository, PremiumRepository>();
  builder.Services.AddScoped<IPremiumService, PremiumService>();
  ```
- **Uso** (Controller):
  ```csharp
  public PremiumsController(IPremiumService premiumService)
  {
      _premiumService = premiumService;
  }
  ```
- **Benef√≠cios**: Testabilidade (mocking), desacoplamento, gerenciamento de lifetime

**DTO (Data Transfer Object)**
- **Defini√ß√£o**: Objeto simples usado para transferir dados entre camadas (API ‚Üî Cliente)
- **Exemplo**:
  ```csharp
  public class PremiumDto
  {
      public long PolicyNumber { get; set; }
      public decimal Amount { get; set; }
      public DateTime EffectiveDate { get; set; }
  }
  ```
- **Diferen√ßa de Entity**: DTO n√£o tem l√≥gica, n√£o √© rastreado pelo EF Core

### E

**Entity Framework Core (EF Core)**
- **Defini√ß√£o**: ORM (Object-Relational Mapper) da Microsoft para .NET
- **Vers√£o**: 9.0
- **Funcionalidades**:
  - Mapeia classes C# para tabelas SQL
  - LINQ to Entities para queries
  - Change tracking
  - Migrations (versionamento de schema)
- **Neste projeto**: Mapeia 15 entidades para views/tabelas DB2

**Environment Variables**
- **Defini√ß√£o**: Vari√°veis do sistema operacional usadas para configura√ß√£o (secrets, endpoints)
- **Leitura** (.NET):
  ```csharp
  var connString = Environment.GetEnvironmentVariable("DATABASE_URL");
  ```
- **Uso**: Separar configura√ß√£o de c√≥digo (12-factor app)

### H

**Hangfire**
- **Defini√ß√£o**: Biblioteca .NET para agendamento de jobs em background
- **Funcionalidades**:
  - Jobs recorrentes (cron expressions)
  - Retry autom√°tico
  - Dashboard web para monitoramento
- **Neste projeto**: Substitui TWS para execu√ß√£o mensal do RG1866B

**HTTP Status Codes**
- **Defini√ß√£o**: C√≥digos num√©ricos em respostas HTTP que indicam resultado
- **Principais**:
  - `200 OK`: Sucesso
  - `201 Created`: Recurso criado
  - `400 Bad Request`: Erro de valida√ß√£o
  - `404 Not Found`: Recurso n√£o encontrado
  - `500 Internal Server Error`: Erro no servidor

### I

**IAsyncEnumerable<T>**
- **Defini√ß√£o**: Interface .NET para streaming ass√≠ncrono de dados
- **Uso**:
  ```csharp
  public async IAsyncEnumerable<Premium> GetPremiumsAsync()
  {
      await foreach (var premium in _context.Premiums.AsAsyncEnumerable())
      {
          yield return premium;
      }
  }
  ```
- **Benef√≠cio**: Processa milh√µes de registros sem carregar tudo na mem√≥ria
- **Equivalente COBOL**: CURSOR (FETCH em loop)

**IoC (Inversion of Control)**
- **Defini√ß√£o**: Princ√≠pio de design onde o framework controla o fluxo (n√£o o c√≥digo do desenvolvedor)
- **Implementa√ß√£o**: Dependency Injection container (.NET)

### L

**LINQ (Language Integrated Query)**
- **Defini√ß√£o**: Sintaxe SQL-like dentro de C# para queries em cole√ß√µes/DB
- **Exemplo**:
  ```csharp
  var premiums = await _context.Premiums
      .Where(p => p.EffectiveDate >= startDate && p.EffectiveDate <= endDate)
      .OrderBy(p => p.PolicyNumber)
      .ToListAsync();
  ```
- **Equivalente COBOL**: Consultas SQL embarcadas com `EXEC SQL`

### M

**Middleware**
- **Defini√ß√£o**: Componentes ASP.NET Core que processam requisi√ß√µes HTTP em pipeline
- **Exemplos**: Logging, autentica√ß√£o, tratamento de exce√ß√µes, CORS
- **Ordem importa**: Executam na ordem definida em `Program.cs`

**Migration (EF Core)**
- **Defini√ß√£o**: Arquivo C# que descreve mudan√ßas no schema do banco de dados
- **Comandos**:
  - `dotnet ef migrations add InitialCreate`: Cria nova migration
  - `dotnet ef database update`: Aplica migrations pendentes
- **Versionamento**: Permite rollback e hist√≥rico de mudan√ßas

### O

**ORM (Object-Relational Mapper)**
- **Defini√ß√£o**: Framework que mapeia objetos (classes) para tabelas relacionais
- **Exemplos**: Entity Framework Core, Dapper, NHibernate
- **Benef√≠cio**: Elimina SQL manual, type-safety, produtividade

### R

**Repository Pattern**
- **Defini√ß√£o**: Padr√£o que encapsula acesso a dados, abstrai persist√™ncia
- **Exemplo**:
  ```csharp
  public interface IPremiumRepository
  {
      Task<Premium> GetByIdAsync(long id);
      IAsyncEnumerable<Premium> GetAllAsync();
      Task AddAsync(Premium premium);
  }
  ```
- **Benef√≠cio**: Substitui implementa√ß√£o (mock em testes, troca de DB)

**REST (Representational State Transfer)**
- **Defini√ß√£o**: Estilo arquitetural para APIs web baseado em HTTP
- **Princ√≠pios**:
  - Stateless (sem sess√£o no servidor)
  - Recursos identificados por URIs (`/api/v1/premiums/123`)
  - M√©todos HTTP sem√¢nticos (GET=leitura, POST=cria√ß√£o, PUT=atualiza√ß√£o, DELETE=remo√ß√£o)
  - Representa√ß√µes (JSON, XML)

### S

**Serilog**
- **Defini√ß√£o**: Biblioteca .NET para logging estruturado
- **Caracter√≠sticas**:
  - Logs em formato JSON com propriedades
  - M√∫ltiplos sinks (console, arquivos, Application Insights, Seq)
  - Performance otimizada
- **Exemplo**:
  ```csharp
  _logger.LogInformation("Processando {Count} pr√™mios para per√≠odo {StartDate}-{EndDate}",
      count, startDate, endDate);
  ```

**Swagger/OpenAPI**
- **Defini√ß√£o**: Especifica√ß√£o para descrever APIs REST + UI interativa para testar endpoints
- **Neste projeto**: Documenta√ß√£o autom√°tica em https://localhost:5001/swagger
- **Ferramenta**: Swashbuckle.AspNetCore

### T

**Task<T>**
- **Defini√ß√£o**: Tipo .NET que representa opera√ß√£o ass√≠ncrona que retorna `T`
- **Uso**: Todos os m√©todos async retornam `Task<T>` ou `Task` (void)
- **Exemplo**: `Task<List<Premium>>` representa opera√ß√£o que retornar√° lista de pr√™mios

### U

**Unit of Work Pattern**
- **Defini√ß√£o**: Padr√£o que agrupa m√∫ltiplas opera√ß√µes de reposit√≥rio em uma transa√ß√£o
- **EF Core**: DbContext j√° implementa Unit of Work (SaveChangesAsync commita tudo)

---

## Termos de Neg√≥cio - Seguros

### A

**Ap√≥lice**
- **Defini√ß√£o**: Contrato de seguro que formaliza acordo entre seguradora e segurado
- **Identificador**: N√∫mero da ap√≥lice (√∫nico por companhia)
- **Componentes**: Coberturas, pr√™mio, vig√™ncia, dados do segurado
- **Tabela DB2**: V0APOLICE

**Aviso de Sinistro**
- **Defini√ß√£o**: Comunica√ß√£o formal de ocorr√™ncia de sinistro √† seguradora
- **Prazo**: Varia por produto (geralmente 7 dias √∫teis)

### C

**Cancelamento**
- **Defini√ß√£o**: T√©rmino antecipado da ap√≥lice por solicita√ß√£o do segurado ou seguradora
- **Tipos**:
  - **A pedido do segurado**: Com direito a restitui√ß√£o proporcional
  - **Por inadimpl√™ncia**: Atraso no pagamento do pr√™mio
  - **Por perda total**: Sinistro que esgota capital segurado
- **Impacto no pr√™mio**: Movimenta√ß√£o negativa (cr√©dito/estorno)

**Capital Segurado**
- **Defini√ß√£o**: Valor m√°ximo que a seguradora se compromete a pagar em caso de sinistro
- **Exemplo**: Seguro residencial com capital de R$ 500.000
- **Rela√ß√£o**: Pr√™mio √© calculado como % do capital segurado

**Circular SUSEP**
- **Defini√ß√£o**: Norma regulat√≥ria emitida pela SUSEP (equivalente a resolu√ß√£o)
- **Circular 360/2008**: Estabelece regras para envio de pr√™mios emitidos
- **Obrigatoriedade**: Seguradoras devem reportar mensalmente

**Cliente/Segurado**
- **Defini√ß√£o**: Pessoa f√≠sica ou jur√≠dica que contrata seguro
- **Identifica√ß√£o**: CPF (pessoa f√≠sica) ou CNPJ (pessoa jur√≠dica)
- **Tabela DB2**: V0CLIENTE

**Cobertura**
- **Defini√ß√£o**: Risco espec√≠fico inclu√≠do na ap√≥lice (inc√™ndio, roubo, danos el√©tricos, etc.)
- **Tipos**:
  - **B√°sica**: Cobertura principal obrigat√≥ria
  - **Adicional**: Coberturas opcionais contratadas
- **Tabela DB2**: V0COBERTURAS

**Comiss√£o**
- **Defini√ß√£o**: Remunera√ß√£o paga ao corretor de seguros pela intermedia√ß√£o
- **Base de c√°lculo**: Percentual sobre o pr√™mio l√≠quido
- **Exemplo**: 15% de R$ 1.000 = R$ 150 de comiss√£o

**Cosseguro**
- **Defini√ß√£o**: Opera√ß√£o em que m√∫ltiplas seguradoras compartilham um mesmo risco
- **Componentes**:
  - **L√≠der**: Seguradora que administra a ap√≥lice (Caixa Seguradora)
  - **Participantes**: Demais seguradoras (com % de participa√ß√£o)
- **Exemplo**: Risco de R$ 10 milh√µes dividido entre 3 seguradoras (40%, 35%, 25%)
- **Tabela DB2**: V0COSSEGURO, GE399

### E

**Emiss√£o**
- **Defini√ß√£o**: Ato de formalizar nova ap√≥lice ou endosso
- **Data de emiss√£o**: Data em que o documento foi gerado
- **Pr√™mio emitido**: Valor total cobrado na emiss√£o
- **Tabela DB2**: V0PREMIOS (COD_MOVIMENTO=1 para emiss√£o)

**Endosso**
- **Defini√ß√£o**: Altera√ß√£o contratual em ap√≥lice vigente (n√£o renova√ß√£o)
- **Tipos**:
  - **Endosso de inclus√£o**: Adiciona cobertura/bem
  - **Endosso de exclus√£o**: Remove cobertura/bem
  - **Endosso de altera√ß√£o**: Modifica dados cadastrais, vig√™ncia, etc.
- **Impacto no pr√™mio**: Pode gerar pr√™mio adicional ou restitui√ß√£o
- **Tabela DB2**: V0ENDOSSO

**Estipulante**
- **Defini√ß√£o**: Pessoa jur√≠dica que contrata seguro em grupo (em nome de terceiros)
- **Exemplo**: Empresa que contrata seguro de vida para funcion√°rios
- **Diferen√ßa**: Estipulante paga, segurado √© beneficiado

### F

**Franquia**
- **Defini√ß√£o**: Valor ou percentual que o segurado assume em caso de sinistro (participa√ß√£o obrigat√≥ria)
- **Exemplo**: Franquia de R$ 2.000 em seguro auto - segurado paga esse valor, seguradora paga o restante
- **Tipos**: Simples (fixa), dedut√≠vel, proporcional

### I

**Indeniza√ß√£o**
- **Defini√ß√£o**: Valor pago pela seguradora ao segurado em caso de sinistro coberto
- **Limite**: N√£o pode exceder o capital segurado
- **C√°lculo**: Considera valor do dano, franquia, percentual de cobertura

**IOF (Imposto sobre Opera√ß√µes Financeiras)**
- **Defini√ß√£o**: Imposto federal incidente sobre pr√™mios de seguro
- **Al√≠quota**: 7,38% para seguros de dano (exceto sa√∫de)
- **Base de c√°lculo**: Pr√™mio l√≠quido (antes do IOF)
- **F√≥rmula**: `Pr√™mio total = Pr√™mio l√≠quido + IOF + adicional fracionamento`

### M

**Movimento**
- **Defini√ß√£o**: Tipo de opera√ß√£o que altera dados da ap√≥lice
- **C√≥digos** (sistema):
  - `1`: Emiss√£o (nova ap√≥lice)
  - `2`: Endosso
  - `3`: Cancelamento
  - `4`: Renova√ß√£o
- **Campo**: COD_MOVIMENTO na tabela V0PREMIOS

### P

**Pr√™mio**
- **Defini√ß√£o**: Valor pago pelo segurado √† seguradora pela transfer√™ncia de risco
- **Componentes**:
  - **Pr√™mio l√≠quido**: Valor puro do risco (c√°lculos atuariais)
  - **IOF**: Imposto (7,38%)
  - **Adicional de fracionamento**: Quando pago parcelado
  - **Pr√™mio total**: Soma dos componentes
- **F√≥rmula simplificada**: `Pr√™mio total = Pr√™mio l√≠quido √ó (1 + taxa_IOF) + adicional_fracionamento`
- **Tabela DB2**: V0PREMIOS

**Pr√™mio Cedido**
- **Defini√ß√£o**: Parcela do pr√™mio transferida a resseguradoras
- **Motivo**: Seguradora repassa parte do risco para limitar exposi√ß√£o
- **Arquivo SUSEP**: PREMCED.TXT (LRECL=800)

**Pr√™mio Emitido**
- **Defini√ß√£o**: Valor total de pr√™mios gerados em determinado per√≠odo (regime de compet√™ncia)
- **Importante**: Contabilizado na data de emiss√£o, n√£o na data de pagamento
- **Relat√≥rio**: Base da Circular SUSEP 360 (arquivo PREMIT.TXT)

**Produto**
- **Defini√ß√£o**: Modalidade de seguro comercializada (seguro auto, residencial, vida, etc.)
- **Identificador**: C√≥digo do produto + c√≥digo SUSEP
- **Tabela DB2**: V0PRODUTO

### R

**Resseguro**
- **Defini√ß√£o**: Opera√ß√£o em que seguradora transfere parte do risco para resseguradora
- **Tipos**:
  - **Facultativo**: Negociado caso a caso
  - **Proporcional**: Resseguradora assume % fixo do risco
  - **N√£o-proporcional**: Resseguradora paga excesso sobre limite (XL - Excess of Loss)
- **Exemplo**: Risco de R$ 50 milh√µes - seguradora ret√©m R$ 10 milh√µes, cede R$ 40 milh√µes ao resseguro
- **Pr√™mio cedido**: Parte do pr√™mio transferida √† resseguradora

**Renova√ß√£o**
- **Defini√ß√£o**: Cria√ß√£o de nova ap√≥lice ao fim da vig√™ncia anterior (continuidade)
- **Diferen√ßa de endosso**: Renova√ß√£o = nova ap√≥lice; Endosso = altera√ß√£o na ap√≥lice atual
- **Pr√™mio**: Emiss√£o normal, n√£o √© ajuste

### S

**Sinistro**
- **Defini√ß√£o**: Ocorr√™ncia do evento coberto pela ap√≥lice (inc√™ndio, roubo, acidente, etc.)
- **Processo**: Aviso ‚Üí Regula√ß√£o ‚Üí Indeniza√ß√£o
- **Impacto**: Reduz lucro t√©cnico da seguradora

**SUSEP (Superintend√™ncia de Seguros Privados)**
- **Defini√ß√£o**: Autarquia federal que regula e fiscaliza mercado de seguros no Brasil
- **Fun√ß√£o**: Proteger consumidor, garantir solidez das seguradoras, normatizar opera√ß√µes
- **Vincula√ß√£o**: Minist√©rio da Fazenda
- **Circular 360/2008**: Principal norma relacionada a este projeto

### V

**Vig√™ncia**
- **Defini√ß√£o**: Per√≠odo em que a ap√≥lice est√° ativa (cobertura vigente)
- **Datas**: Data de in√≠cio e data de fim
- **Exemplo**: Vig√™ncia de 01/10/2025 a 01/10/2026 (12 meses)
- **Importante**: Sinistros s√≥ s√£o cobertos se ocorrerem dentro da vig√™ncia

---

## Termos Regulat√≥rios SUSEP

### C

**Circular SUSEP 360/2008**
- **Defini√ß√£o**: Norma que estabelece envio mensal de pr√™mios emitidos e cedidos
- **Objetivo**: Monitorar mercado, calcular arrecada√ß√£o, fiscalizar opera√ß√µes
- **Arquivos obrigat√≥rios**:
  - **PREMIT.TXT**: Pr√™mios emitidos (LRECL=1200)
  - **PREMCED.TXT**: Pr√™mios cedidos a resseguradoras (LRECL=800)
- **Prazo**: At√© o 15¬∫ dia √∫til do m√™s seguinte
- **Penalidades**: Multa de R$ 50.000 a R$ 200.000 por atraso/diverg√™ncia

### L

**Layout SUSEP**
- **Defini√ß√£o**: Especifica√ß√£o oficial do formato dos arquivos de envio
- **Caracter√≠sticas**:
  - Fixed-width (largura fixa) - sem delimitadores
  - EBCDIC (mainframe) ou ASCII (sistemas modernos)
  - Campos com posi√ß√µes fixas (in√≠cio-fim)
  - Padding obrigat√≥rio (zeros √† esquerda para n√∫meros, espa√ßos √† direita para textos)
- **Exemplo** (PREMIT.TXT - posi√ß√µes 1-50):
  ```
  Pos 1-3:    C√≥digo da empresa (999)
  Pos 4-13:   N√∫mero da ap√≥lice (9999999999)
  Pos 14-21:  Data de emiss√£o (YYYYMMDD)
  Pos 22-36:  Pr√™mio total (999999999999999, √∫ltimos 2 = decimais)
  ...
  ```

### P

**Penalidades SUSEP**
- **Defini√ß√£o**: Multas aplicadas por descumprimento de normas
- **Valores** (Circular 360):
  - Atraso no envio: R$ 50.000 (prim√°ria), R$ 100.000 (reincidente)
  - Dados incorretos: R$ 75.000 a R$ 150.000
  - Omiss√£o de informa√ß√µes: R$ 100.000 a R$ 200.000
- **Processo**: Notifica√ß√£o ‚Üí Defesa ‚Üí Julgamento ‚Üí Pagamento ou recurso

### R

**Regime de Compet√™ncia**
- **Defini√ß√£o**: Crit√©rio cont√°bil onde receita √© reconhecida na data de emiss√£o (n√£o no pagamento)
- **SUSEP**: Exige reportar pr√™mios pelo regime de compet√™ncia
- **Exemplo**: Ap√≥lice emitida em 15/10/2025, paga em 05/11/2025 ‚Üí reportar em outubro

---

## Acr√¥nimos e Siglas

### A-E

- **API**: Application Programming Interface (Interface de Programa√ß√£o de Aplica√ß√µes)
- **ASCII**: American Standard Code for Information Interchange
- **CNPJ**: Cadastro Nacional da Pessoa Jur√≠dica
- **COMP-3**: Computational-3 (packed decimal no COBOL)
- **COBOL**: COmmon Business-Oriented Language
- **CORS**: Cross-Origin Resource Sharing
- **CPF**: Cadastro de Pessoas F√≠sicas
- **DB2**: Database 2 (IBM)
- **DCB**: Data Control Block (JCL)
- **DI**: Dependency Injection (Inje√ß√£o de Depend√™ncia)
- **DTO**: Data Transfer Object
- **EBCDIC**: Extended Binary Coded Decimal Interchange Code
- **EF Core**: Entity Framework Core

### F-J

- **FD**: File Description (COBOL)
- **FP**: Function Points (Pontos de Fun√ß√£o)
- **FTP**: File Transfer Protocol
- **HTTP**: HyperText Transfer Protocol
- **HTTPS**: HTTP Secure
- **IIB**: IBM Integration Bus
- **IOF**: Imposto sobre Opera√ß√µes Financeiras
- **I/O**: Input/Output (Entrada/Sa√≠da)
- **IoC**: Inversion of Control
- **JCL**: Job Control Language (linguagem de controle de jobs IBM)
- **JES**: Job Entry Subsystem (z/OS)
- **JSON**: JavaScript Object Notation

### L-R

- **LINQ**: Language Integrated Query
- **LRECL**: Logical RECord Length (tamanho do registro)
- **LTS**: Long Term Support (suporte de longo prazo)
- **MVC**: Model-View-Controller
- **ORM**: Object-Relational Mapper
- **REST**: Representational State Transfer
- **RECFM**: RECord ForMat (formato do registro no JCL)

### S-Z

- **SLA**: Service Level Agreement (acordo de n√≠vel de servi√ßo)
- **SOAP**: Simple Object Access Protocol
- **SQL**: Structured Query Language
- **SQLCA**: SQL Communication Area (DB2)
- **SUSEP**: Superintend√™ncia de Seguros Privados
- **TWS**: Tivoli Workload Scheduler (IBM)
- **URI**: Uniform Resource Identifier
- **URL**: Uniform Resource Locator
- **XML**: eXtensible Markup Language
- **z/OS**: Sistema operacional IBM para mainframes

---

## Mapeamento COBOL ‚Üí .NET

Esta se√ß√£o mapeia conceitos COBOL para seus equivalentes .NET no contexto deste projeto.

| Conceito COBOL | Equivalente .NET | Notas |
|---|---|---|
| **PROGRAM-ID** | `class Program` | Nome do programa ‚Üí Nome da classe |
| **WORKING-STORAGE SECTION** | Campos/propriedades privadas | Vari√°veis internas |
| **LINKAGE SECTION** | Par√¢metros de m√©todo/construtor | Par√¢metros recebidos |
| **PROCEDURE DIVISION** | M√©todos p√∫blicos/privados | L√≥gica execut√°vel |
| **PERFORM** | Chamada de m√©todo | `PerformCalculation()` |
| **GO TO** | `goto` (evitar), `return`, `break` | Desvio de fluxo |
| **IF/ELSE** | `if/else` ou `switch` | Estruturas condicionais |
| **EVALUATE** | `switch` expression (C# 8+) | M√∫ltiplas condi√ß√µes |
| **PERFORM UNTIL** | `while` loop | Loop condicional |
| **PERFORM VARYING** | `for` loop | Loop indexado |
| **MOVE** | Operador `=` | Atribui√ß√£o |
| **COMPUTE** | Express√µes aritm√©ticas | `var result = a + b * c` |
| **STRING** | `string.Concat()` ou interpola√ß√£o | Concatena√ß√£o |
| **UNSTRING** | `string.Split()` | Parsing de strings |
| **DISPLAY** | `Console.WriteLine()` ou `ILogger` | Output de mensagens |
| **ACCEPT** | `Console.ReadLine()` ou config | Input de dados |
| **STOP RUN** | `return` ou `Environment.Exit()` | T√©rmino do programa |
| **OPEN** | `File.OpenRead()` ou `FileStream` | Abrir arquivo |
| **READ** | `StreamReader.ReadLine()` | Ler registro |
| **WRITE** | `StreamWriter.WriteLine()` | Escrever registro |
| **CLOSE** | `stream.Close()` ou `Dispose()` | Fechar arquivo |
| **CALL 'subprogram'** | Chamada de m√©todo/servi√ßo | Invoca√ß√£o de m√≥dulo |
| **EXEC SQL** | LINQ to Entities ou EF Core | Queries SQL |
| **CURSOR** | `IAsyncEnumerable<T>` | Streaming de dados |
| **FETCH** | `yield return` em async enumerable | Pr√≥ximo item |
| **SQLCODE** | `DbException` ou try/catch | Tratamento de erros SQL |
| **COMP-3** | `decimal` (tipo C#) | Precis√£o exata |
| **PIC 9(n)** | `int`, `long` (dependendo de n) | Num√©rico inteiro |
| **PIC X(n)** | `string` | Alfanum√©rico |
| **PIC 9(n)V99** | `decimal` | Num√©rico com decimais |
| **PIC S9(n)** | `int`, `long` (com sinal) | Num√©rico com sinal |
| **OCCURS n TIMES** | `T[]` ou `List<T>` | Arrays |
| **REDEFINES** | `StructLayout` ou pattern matching | Uni√£o (mesma mem√≥ria) |
| **88 level (condition)** | `const bool` ou property | Valor nomeado |
| **JCL JOB** | Docker Compose ou script bash | Orquestra√ß√£o |
| **TWS scheduling** | Hangfire ou Quartz.NET | Agendamento de jobs |
| **Mainframe batch** | Console Application (.NET) | Processamento em lote |

---

## Tipos de Dados

### Compara√ß√£o COBOL ‚Üî C#

| COBOL PIC Clause | Tipo C# | Tamanho | Exemplo Valor | Notas |
|---|---|---|---|---|
| `PIC 9(3)` | `short` | 2 bytes | 123 | 0-999 |
| `PIC 9(5)` | `int` | 4 bytes | 12345 | 0-99999 |
| `PIC 9(9)` | `int` | 4 bytes | 123456789 | 0-999999999 |
| `PIC 9(10)` | `long` | 8 bytes | 1234567890 | Acima de 2 bilh√µes |
| `PIC S9(5)` | `int` | 4 bytes | -12345 | Com sinal |
| `PIC 9(5) COMP` | `int` | 4 bytes | 12345 | Bin√°rio |
| `PIC 9(5)V99` | `decimal` | 16 bytes | 123.45 | 5 d√≠gitos + 2 decimais |
| `PIC 9(13)V99` | `decimal` | 16 bytes | 1234567890123.45 | Pr√™mio/capital |
| `PIC 9(5)V99 COMP-3` | `decimal` | 16 bytes | 123.45 | Packed decimal |
| `PIC X(10)` | `string` | Vari√°vel | "ABCDE     " | Fixed-width 10 |
| `PIC X(100)` | `string` | Vari√°vel | "Raz√£o Social..." | Texto longo |
| `PIC 9(8)` (data) | `DateTime` | 8 bytes | 20251027 | YYYYMMDD |
| `PIC X(1)` (flag) | `bool` | 1 byte | 'S' ou 'N' | Booleano |

### Regras de Convers√£o

1. **Num√©rico COBOL ‚Üí C#**:
   - `PIC 9(n)` onde n ‚â§ 4 ‚Üí `short`
   - `PIC 9(n)` onde 5 ‚â§ n ‚â§ 9 ‚Üí `int`
   - `PIC 9(n)` onde n ‚â• 10 ‚Üí `long`
   - `PIC 9(n)Vdd` (com decimais) ‚Üí **SEMPRE** `decimal`
   - `PIC 9(n) COMP-3` ‚Üí **SEMPRE** `decimal`

2. **Alfanum√©rico COBOL ‚Üí C#**:
   - `PIC X(n)` ‚Üí `string` (usar `[MaxLength(n)]` em entidade)
   - Remover espa√ßos √† direita: `.TrimEnd()`
   - Adicionar espa√ßos √† direita: `.PadRight(n)`

3. **Data COBOL ‚Üí C#**:
   - `PIC 9(8)` (YYYYMMDD) ‚Üí `DateTime`
   - Convers√£o: `DateTime.ParseExact(dateString, "yyyyMMdd", CultureInfo.InvariantCulture)`
   - **Aten√ß√£o**: COBOL armazena como inteiro (20251027), n√£o string

4. **Flags COBOL ‚Üí C#**:
   - `PIC X(1)` com valores 'S'/'N' ‚Üí `bool`
   - Convers√£o: `flag == 'S'` ou `flag == '1'`

---

## Conceitos de Arquitetura

### Padr√µes de Design Usados Neste Projeto

**1. Clean Architecture**
- **Objetivo**: Separar responsabilidades, independ√™ncia de frameworks
- **Camadas**:
  - **Core**: Regras de neg√≥cio puras (sem depend√™ncias externas)
  - **Infrastructure**: Acesso a dados, APIs, file I/O
  - **API**: Apresenta√ß√£o, controllers HTTP
- **Regra de ouro**: Depend√™ncias apontam para dentro (API ‚Üí Core ‚Üê Infrastructure)

**2. Repository Pattern**
- **Objetivo**: Abstrair acesso a dados
- **Implementa√ß√£o**: Interface no Core, implementa√ß√£o na Infrastructure
- **Benef√≠cio**: Trocar banco de dados sem alterar l√≥gica de neg√≥cio

**3. Dependency Injection**
- **Objetivo**: Desacoplar depend√™ncias
- **Implementa√ß√£o**: Constructor injection + IoC container (.NET)
- **Benef√≠cio**: Testabilidade (mock de reposit√≥rios/servi√ßos)

**4. DTO Pattern**
- **Objetivo**: Separar modelos de dom√≠nio de representa√ß√£o de API
- **Implementa√ß√£o**: Classes DTO + AutoMapper
- **Benef√≠cio**: Evolu√ß√£o independente de API e dom√≠nio

**5. Unit of Work**
- **Objetivo**: Agrupar m√∫ltiplas opera√ß√µes em uma transa√ß√£o
- **Implementa√ß√£o**: `DbContext.SaveChangesAsync()` (EF Core)
- **Benef√≠cio**: Atomicidade (tudo ou nada)

**6. CQRS (Command Query Responsibility Segregation) - Simplificado**
- **Objetivo**: Separar opera√ß√µes de leitura (queries) de escrita (commands)
- **Implementa√ß√£o**: M√©todos de servi√ßo distintos (`GetAsync` vs `AddAsync`)
- **Benef√≠cio**: Otimiza√ß√£o independente (queries read-only com AsNoTracking)

**7. Async/Await Pattern**
- **Objetivo**: I/O n√£o bloqueante
- **Implementa√ß√£o**: Todos os m√©todos de reposit√≥rio/servi√ßo s√£o async
- **Benef√≠cio**: Escalabilidade (threads liberadas durante I/O)

### Princ√≠pios SOLID

**S - Single Responsibility Principle**
- Cada classe tem uma √∫nica responsabilidade
- Exemplo: `PremiumController` s√≥ trata HTTP, `PremiumService` s√≥ tem l√≥gica de neg√≥cio

**O - Open/Closed Principle**
- Aberto para extens√£o, fechado para modifica√ß√£o
- Exemplo: Novos reposit√≥rios implementam `IRepository<T>`, sem alterar c√≥digo existente

**L - Liskov Substitution Principle**
- Subtipos devem ser substitu√≠veis por seus tipos base
- Exemplo: Qualquer `IPremiumRepository` pode ser injetado sem quebrar c√≥digo

**I - Interface Segregation Principle**
- Interfaces espec√≠ficas > interfaces gordas
- Exemplo: `IPremiumRepository`, `IPolicyRepository` (n√£o um √∫nico `IRepository` com 50 m√©todos)

**D - Dependency Inversion Principle**
- Depender de abstra√ß√µes (interfaces), n√£o de implementa√ß√µes concretas
- Exemplo: Controller depende de `IPremiumService`, n√£o de `PremiumService` diretamente

---

## Gloss√°rio de Campos do Sistema

### Campos Comuns em M√∫ltiplas Tabelas

| Campo | Tipo COBOL | Tipo C# | Descri√ß√£o |
|---|---|---|---|
| `COD_EMPRESA` | `PIC 9(3)` | `short` | C√≥digo da seguradora (Caixa = 185) |
| `NUM_APOLICE` | `PIC 9(10)` | `long` | N√∫mero √∫nico da ap√≥lice |
| `NUM_ENDOSSO` | `PIC 9(5)` | `int` | N√∫mero sequencial do endosso (0 = ap√≥lice original) |
| `COD_PRODUTO` | `PIC 9(5)` | `int` | C√≥digo do produto de seguro |
| `COD_SUSEP` | `PIC X(10)` | `string` | C√≥digo do produto registrado na SUSEP |
| `DTA_EMISSAO` | `PIC 9(8)` | `DateTime` | Data de emiss√£o (YYYYMMDD) |
| `DTA_INICIO_VIGENCIA` | `PIC 9(8)` | `DateTime` | In√≠cio da vig√™ncia |
| `DTA_FIM_VIGENCIA` | `PIC 9(8)` | `DateTime` | Fim da vig√™ncia |
| `VLR_PREMIO_LIQUIDO` | `PIC 9(13)V99 COMP-3` | `decimal` | Pr√™mio l√≠quido (sem IOF) |
| `VLR_IOF` | `PIC 9(11)V99 COMP-3` | `decimal` | Imposto IOF |
| `VLR_PREMIO_TOTAL` | `PIC 9(13)V99 COMP-3` | `decimal` | Pr√™mio total (l√≠quido + IOF + adic.) |
| `COD_MOVIMENTO` | `PIC 9(1)` | `byte` | Tipo de movimento (1=emiss√£o, 2=endosso, 3=cancel.) |
| `CPF_CNPJ_SEGURADO` | `PIC X(14)` | `string` | CPF (11 d√≠gitos) ou CNPJ (14 d√≠gitos) do segurado |
| `NOM_SEGURADO` | `PIC X(100)` | `string` | Nome/raz√£o social do segurado |

### Campos Espec√≠ficos do Relat√≥rio SUSEP (PREMIT.TXT)

- **Posi√ß√µes 1-1200**: Layout completo definido pela Circular 360
- **687 campos** no total (conforme an√°lise COBOL)
- Ver documenta√ß√£o completa em `03-data-structures.md`

---

## Refer√™ncias Cruzadas

### Para Mais Informa√ß√µes

- **Estruturas de dados detalhadas**: Ver `03-data-structures.md`
- **Modelo de banco de dados**: Ver `04-database-model.md`
- **Regras de neg√≥cio**: Ver `05-business-logic.md`
- **M√≥dulos externos**: Ver `06-external-modules.md`
- **Opera√ß√µes mainframe**: Ver `07-operations-guide.md`
- **Hist√≥rico de manuten√ß√£o**: Ver `08-maintenance-history.md`
- **Guia de migra√ß√£o**: Ver `09-migration-guide.md`
- **Plano do projeto**: Ver `11-migration-project-plan.md`

### Documenta√ß√£o Externa

- **COBOL Language Reference**: IBM Enterprise COBOL for z/OS
- **DB2 SQL Reference**: IBM DB2 for z/OS
- **.NET Documentation**: https://learn.microsoft.com/dotnet
- **Entity Framework Core**: https://learn.microsoft.com/ef/core
- **ASP.NET Core**: https://learn.microsoft.com/aspnet/core
- **SUSEP Normativas**: https://www.gov.br/susep

---

**Fim do Gloss√°rio**

**Total de Termos**: 150+ termos t√©cnicos e de neg√≥cio
**√öltima Atualiza√ß√£o**: 27 de outubro de 2025
**Vers√£o**: 1.0.0

---

## Controle de Altera√ß√µes

| Vers√£o | Data | Autor | Descri√ß√£o |
|---|---|---|---|
| 1.0.0 | 27/10/2025 | Claude Code | Vers√£o inicial completa do gloss√°rio |# 11 - Projeto de Migra√ß√£o: Sistema Moderno SUSEP Premium Reporting

[‚Üê Voltar ao √çndice](README.md)

---

## Sum√°rio Executivo do Projeto

### Identifica√ß√£o do Projeto

| Atributo | Valor |
|----------|-------|
| **Nome do Projeto** | Migra√ß√£o RG1866B para .NET 9 + React |
| **C√≥digo do Projeto** | SUSEP-MIG-001 |
| **Patrocinador** | [Nome do Sponsor] |
| **Gerente de Projeto** | [Nome do GP] |
| **Dura√ß√£o Total** | 3 meses (13 semanas) |
| **Data In√≠cio Prevista** | 01/11/2025 |
| **Data Entrega Prevista** | 31/01/2026 |
| **Or√ßamento** | R$ 577.500 |
| **ROI Esperado** | 9 meses (R$ 800K/ano economia) |

### Objetivo do Projeto

Migrar o programa batch COBOL RG1866B (5.046 linhas, 8 anos em produ√ß√£o) para uma **plataforma moderna .NET 9 + React**, mantendo **100% de conformidade regulat√≥ria SUSEP Circular 360** e adicionando capacidades interativas que n√£o existiam no sistema legado.

---

## 1. Arquitetura do Sistema Proposto

### 1.1 Vis√£o Geral da Solu√ß√£o

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FRONTEND (React 18+)                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Interface Web Responsiva                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Dashboard de An√°lise                                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Gera√ß√£o Interativa de Relat√≥rios                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Query Builder (SQL visual)                            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Agendamento de Jobs                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Gest√£o de Mock Data                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                            ‚Üì HTTPS                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BACKEND (.NET 9 Web API)                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  API Layer (Controllers)                                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ 28 endpoints REST                                     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Swagger/OpenAPI documentation                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ JWT Authentication                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Rate limiting & throttling                            ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                            ‚Üì                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Core Layer (Business Logic)                            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Domain Entities (15 principais)                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Business Services                                     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Calculation Engine (COBOL logic migrada)             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Validation Rules                                     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                            ‚Üì                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Infrastructure Layer                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Entity Framework Core (ORM)                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Repositories (26+ tabelas)                           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ FixedWidthFormatter (PREMIT/PREMCED)                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ External Module Adapters (RE0001S, GE0009S, GE0010S) ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    DATABASE (SQLite Dev / SQL Server Prod)       ‚îÇ
‚îÇ  ‚Ä¢ 26+ tabelas migrando estrutura DB2                           ‚îÇ
‚îÇ  ‚Ä¢ √çndices otimizados para queries frequentes                   ‚îÇ
‚îÇ  ‚Ä¢ Migrations versionadas (EF Core)                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    INFRAESTRUTURA                                ‚îÇ
‚îÇ  ‚Ä¢ Docker containers (backend + frontend + database)            ‚îÇ
‚îÇ  ‚Ä¢ CI/CD Pipeline (GitHub Actions / Azure DevOps)              ‚îÇ
‚îÇ  ‚Ä¢ Logging centralizado (Serilog + Seq)                        ‚îÇ
‚îÇ  ‚Ä¢ Monitoring (Application Insights)                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 1.2 Stack Tecnol√≥gico Detalhado

#### Frontend

| Tecnologia | Vers√£o | Prop√≥sito |
|------------|--------|-----------|
| **React** | 18.3+ | Framework UI |
| **TypeScript** | 5.3+ | Type safety |
| **Vite** | 5.0+ | Build tool (dev server + bundler) |
| **TailwindCSS** | 3.4+ | Styling (Caixa branding) |
| **React Router** | 6.20+ | Navega√ß√£o SPA |
| **TanStack Query** | 5.14+ | State management (server state) |
| **Recharts** | 2.10+ | Data visualization |
| **Axios** | 1.6+ | HTTP client |
| **React Hook Form** | 7.49+ | Formul√°rios complexos |
| **Zod** | 3.22+ | Schema validation |
| **date-fns** | 3.0+ | Manipula√ß√£o de datas |
| **Vitest** | 1.0+ | Unit testing |
| **Playwright** | 1.40+ | E2E testing |

#### Backend

| Tecnologia | Vers√£o | Prop√≥sito |
|------------|--------|-----------|
| **.NET SDK** | 9.0 | Runtime + compilador |
| **ASP.NET Core** | 9.0 | Web framework |
| **Entity Framework Core** | 9.0 | ORM |
| **Serilog** | 3.1+ | Logging estruturado |
| **AutoMapper** | 12.0+ | Object mapping |
| **FluentValidation** | 11.9+ | Valida√ß√µes complexas |
| **Swashbuckle** | 6.5+ | Swagger/OpenAPI |
| **xUnit** | 2.6+ | Unit testing |
| **Moq** | 4.20+ | Mocking |
| **FluentAssertions** | 6.12+ | Test assertions |
| **BenchmarkDotNet** | 0.13+ | Performance testing |

#### Database

| Tecnologia | Vers√£o | Ambiente |
|------------|--------|----------|
| **SQLite** | 3.44+ | Desenvolvimento/Testes |
| **SQL Server** | 2022 | Produ√ß√£o (opcional) |
| **PostgreSQL** | 16+ | Produ√ß√£o (alternativa) |

#### DevOps

| Tecnologia | Prop√≥sito |
|------------|-----------|
| **Docker** | Containeriza√ß√£o |
| **Docker Compose** | Orquestra√ß√£o local |
| **GitHub Actions** | CI/CD |
| **Seq** | Log aggregation |
| **Application Insights** | APM (Azure) |

---

## 2. Funcionalidades do Sistema Modernizado

### 2.1 Matriz de Funcionalidades

| ID | Funcionalidade | Prioridade | Complexidade | Status Legado | Pontos de Fun√ß√£o |
|----|----------------|------------|--------------|---------------|------------------|
| **F01** | Dashboard de An√°lise | P1 | M√©dia | ‚ùå N√£o existe | 35 |
| **F02** | Gera√ß√£o Interativa de Relat√≥rios | P1 | Alta | ‚ö†Ô∏è Batch apenas | 89 |
| **F03** | Download de Arquivos (PREMIT/PREMCED) | P1 | Baixa | ‚ö†Ô∏è Via mainframe | 12 |
| **F04** | Valida√ß√£o de Par√¢metros | P1 | M√©dia | ‚úÖ Existe | 18 |
| **F05** | C√°lculo de Pr√™mios | P1 | Alta | ‚úÖ Existe | 65 |
| **F06** | Processamento de Cosseguro | P1 | Alta | ‚úÖ Existe | 58 |
| **F07** | Gera√ß√£o Fixed-Width Format | P1 | Alta | ‚úÖ Existe | 42 |
| **F08** | Query Builder Interativo | P2 | Alta | ‚ùå N√£o existe | 71 |
| **F09** | Visualiza√ß√£o de Dados (Charts) | P2 | M√©dia | ‚ùå N√£o existe | 38 |
| **F10** | Exporta√ß√£o Multi-formato (CSV/Excel/PDF) | P2 | M√©dia | ‚ùå N√£o existe | 25 |
| **F11** | Agendamento de Jobs | P3 | M√©dia | ‚ö†Ô∏è Via JCL | 45 |
| **F12** | Hist√≥rico de Execu√ß√µes | P3 | Baixa | ‚ö†Ô∏è Logs texto | 22 |
| **F13** | Monitoramento de Jobs | P3 | M√©dia | ‚ùå N√£o existe | 28 |
| **F14** | Gest√£o de Mock Data | P4 | Baixa | ‚ùå N√£o existe | 18 |
| **F15** | Valida√ß√£o vs COBOL (Comparison) | P4 | Alta | ‚ùå N√£o existe | 52 |
| **F16** | API REST (28 endpoints) | P1 | M√©dia | ‚ùå N√£o existe | 85 |
| **F17** | Autentica√ß√£o/Autoriza√ß√£o | P2 | M√©dia | ‚ùå N√£o existe | 32 |
| **F18** | Logging Centralizado | P2 | Baixa | ‚ö†Ô∏è Logs mainframe | 15 |
| **F19** | M√©tricas de Performance | P3 | Baixa | ‚ùå N√£o existe | 12 |
| **F20** | Documenta√ß√£o Swagger | P2 | Baixa | ‚ùå N√£o existe | 8 |
| **TOTAL** | - | - | - | - | **770 PF** |

### 2.2 Detalhamento por Funcionalidade

#### F01 - Dashboard de An√°lise (35 PF)

**Descri√ß√£o**: Tela inicial com m√©tricas de complexidade do sistema legado e status da migra√ß√£o.

**User Stories**:
- US-001: Como stakeholder, quero ver m√©tricas do sistema COBOL (linhas, vari√°veis, tabelas)
- US-002: Como gerente, quero visualizar progresso da migra√ß√£o em tempo real
- US-003: Como desenvolvedor, quero ver depend√™ncias entre m√≥dulos

**Componentes T√©cnicos**:
- `DashboardPage.tsx` (React)
- `DashboardController.cs` (.NET)
- `DashboardService.cs` (Business logic)
- 3 endpoints REST:
  - `GET /api/v1/dashboard/metrics`
  - `GET /api/v1/dashboard/function-points`
  - `GET /api/v1/dashboard/dependencies`

**Contagem de Pontos de Fun√ß√£o**:
- EI (External Inputs): 0
- EO (External Outputs): 3 x 5 = 15 PF (complexidade m√©dia)
- EQ (External Queries): 0
- ILF (Internal Logic Files): 1 x 10 = 10 PF
- EIF (External Interface Files): 2 x 5 = 10 PF
- **Total**: 35 PF

---

#### F02 - Gera√ß√£o Interativa de Relat√≥rios (89 PF)

**Descri√ß√£o**: Interface web para gerar relat√≥rios SUSEP on-demand com sele√ß√£o de par√¢metros.

**User Stories**:
- US-004: Como analista SUSEP, quero gerar relat√≥rios com per√≠odo customizado
- US-005: Como usu√°rio, quero ver progresso em tempo real (barra de progresso)
- US-006: Como auditor, quero baixar PREMIT.TXT e PREMCED.TXT gerados
- US-007: Como operador, quero ver mensagens de erro claras em portugu√™s

**Componentes T√©cnicos**:
- `ReportGenerationPage.tsx` (React)
- `ReportProgressBar.tsx` (React component)
- `ReportController.cs` (.NET)
- `PremiumReportService.cs` (Business logic - migra√ß√£o COBOL R0500-R5500)
- `FixedWidthFormatter.cs` (Formata√ß√£o byte-for-byte COBOL)
- 5 endpoints REST:
  - `POST /api/v1/reports/generate`
  - `GET /api/v1/reports/{id}/status`
  - `GET /api/v1/reports/{id}/download/premit`
  - `GET /api/v1/reports/{id}/download/premced`
  - `GET /api/v1/reports/history`

**L√≥gica de Neg√≥cio Cr√≠tica**:
- Migra√ß√£o de 63 se√ß√µes COBOL (R0000-R9999)
- C√°lculos financeiros com `decimal` (precis√£o COMP-3)
- 4 cursores DB2 ‚Üí `IAsyncEnumerable<T>` streaming
- Valida√ß√µes de 40+ ramos SUSEP
- Gera√ß√£o de arquivos fixed-width 1200/800 bytes

**Contagem de Pontos de Fun√ß√£o**:
- EI: 2 x 6 = 12 PF (form + cancelamento)
- EO: 5 x 7 = 35 PF (complexidade alta)
- EQ: 2 x 4 = 8 PF
- ILF: 3 x 15 = 45 PF (tabelas premiums, policies, cosseguro)
- **Total**: 100 PF (ajustado para 89 ap√≥s an√°lise de compartilhamento)

---

#### F08 - Query Builder Interativo (71 PF)

**Descri√ß√£o**: Interface visual para consultas ad-hoc em dados de pr√™mios, ap√≥lices e clientes.

**User Stories**:
- US-015: Como analista de neg√≥cio, quero filtrar pr√™mios por per√≠odo, produto e valor
- US-016: Como gerente, quero visualizar resultados em tabelas paginadas
- US-017: Como usu√°rio, quero ordenar por qualquer coluna
- US-018: Como analista, quero aplicar agrega√ß√µes (SUM, AVG, COUNT)

**Componentes T√©cnicos**:
- `QueryPage.tsx` (React)
- `QueryBuilderForm.tsx` (React)
- `QueryResultsTable.tsx` (React)
- `QueryController.cs` (.NET)
- `QueryService.cs` (Dynamic LINQ)
- 4 endpoints REST:
  - `POST /api/v1/query/execute`
  - `GET /api/v1/query/saved`
  - `POST /api/v1/query/save`
  - `DELETE /api/v1/query/{id}`

**Contagem de Pontos de Fun√ß√£o**:
- EI: 3 x 6 = 18 PF (form complexo + salvar + deletar)
- EO: 2 x 7 = 14 PF (resultados + queries salvas)
- EQ: 4 x 4 = 16 PF
- ILF: 2 x 10 = 20 PF
- EIF: 1 x 7 = 7 PF
- **Total**: 75 PF (ajustado para 71)

---

#### F16 - API REST (85 PF)

**Descri√ß√£o**: 28 endpoints RESTful para todas as opera√ß√µes do sistema.

**Categorias de Endpoints**:

1. **Reports (5 endpoints)**: Generate, status, download, history, compare
2. **Premiums (3)**: Query, details, statistics
3. **Policies (4)**: Details, endorsements, coverages, cossurance
4. **Products (2)**: List, details
5. **Clients (2)**: Details, addresses
6. **Batch Jobs (4)**: Create, list, details, executions
7. **Mock Data (3)**: Load, validate, reset
8. **Dashboard (3)**: Metrics, function points, dependencies
9. **System (2)**: Health, configuration

**Contagem de Pontos de Fun√ß√£o**:
- EI: 8 x 6 = 48 PF (POST/PUT/DELETE)
- EO: 12 x 7 = 84 PF (relat√≥rios complexos)
- EQ: 8 x 4 = 32 PF (GET simples)
- **Total Bruto**: 164 PF
- **Ajuste por compartilhamento**: 85 PF (muitos endpoints compartilham l√≥gica)

---

## 3. An√°lise de Pontos de Fun√ß√£o (APF)

### 3.1 Resumo Executivo

| Categoria | Quantidade | Complexidade M√©dia | Pontos de Fun√ß√£o |
|-----------|------------|-------------------|------------------|
| **EI (External Inputs)** | 15 | M√©dia (6 PF) | 90 |
| **EO (External Outputs)** | 22 | Alta (7 PF) | 154 |
| **EQ (External Queries)** | 18 | M√©dia (4 PF) | 72 |
| **ILF (Internal Logic Files)** | 26 | M√©dia (10 PF) | 260 |
| **EIF (External Interface Files)** | 8 | M√©dia (7 PF) | 56 |
| **TOTAL N√ÉO AJUSTADO** | - | - | **632 PF** |
| **Fator de Ajuste (VAF)** | - | 1.22 | - |
| **TOTAL AJUSTADO** | - | - | **770 PF** |

### 3.2 C√°lculo do Fator de Ajuste de Valor (VAF)

Baseado nas 14 Caracter√≠sticas Gerais do Sistema:

| # | Caracter√≠stica | Influ√™ncia (0-5) | Justificativa |
|---|----------------|------------------|---------------|
| 1 | Comunica√ß√£o de Dados | 5 | API REST, WebSockets para progresso real-time |
| 2 | Processamento Distribu√≠do | 3 | Backend + Frontend separados, container-based |
| 3 | Performance | 5 | 10K+ registros em < 5 min (cr√≠tico para SLA) |
| 4 | Configura√ß√£o Compartilhada | 2 | Alguns recursos compartilhados entre m√≥dulos |
| 5 | Taxa de Transa√ß√£o | 4 | Picos mensais (1¬∫ dia √∫til), concorr√™ncia at√© 10 users |
| 6 | Entrada de Dados Online | 5 | Formul√°rios complexos (React Hook Form + Zod) |
| 7 | Efici√™ncia do Usu√°rio Final | 5 | Dashboard, query builder, progresso em tempo real |
| 8 | Atualiza√ß√£o Online | 3 | Mock data upload, configura√ß√µes |
| 9 | Processamento Complexo | 5 | 63 se√ß√µes COBOL, c√°lculos financeiros cr√≠ticos |
| 10 | Reusabilidade | 4 | Clean Architecture, componentes React reutiliz√°veis |
| 11 | Facilidade de Instala√ß√£o | 4 | Docker Compose one-command setup |
| 12 | Facilidade Operacional | 5 | Logs centralizados, health checks, monitoring |
| 13 | M√∫ltiplos Sites | 2 | Deploy √∫nico (poss√≠vel multi-tenant futuro) |
| 14 | Facilidade de Mudan√ßa | 5 | Arquitetura modular, testes automatizados 90%+ |
| **TOTAL (TDI)** | - | **57** | - |

**C√°lculo VAF**:

```text
VAF = 0.65 + (0.01 √ó TDI)
VAF = 0.65 + (0.01 √ó 57)
VAF = 0.65 + 0.57
VAF = 1.22
```

**Pontos de Fun√ß√£o Ajustados**:

```text
PF Ajustados = PF N√£o Ajustados √ó VAF
PF Ajustados = 632 √ó 1.22
PF Ajustados = 770 PF
```

### 3.3 Distribui√ß√£o de Esfor√ßo por Funcionalidade

| Funcionalidade | PF | % do Total | Prioridade |
|----------------|----|-----------|-----------|
| Gera√ß√£o Interativa de Relat√≥rios (F02) | 89 | 11.6% | P1 üî¥ |
| API REST (F16) | 85 | 11.0% | P1 üî¥ |
| Query Builder (F08) | 71 | 9.2% | P2 üü° |
| C√°lculo de Pr√™mios (F05) | 65 | 8.4% | P1 üî¥ |
| Processamento Cosseguro (F06) | 58 | 7.5% | P1 üî¥ |
| Compara√ß√£o vs COBOL (F15) | 52 | 6.8% | P4 üü¢ |
| Agendamento de Jobs (F11) | 45 | 5.8% | P3 üü° |
| Gera√ß√£o Fixed-Width (F07) | 42 | 5.5% | P1 üî¥ |
| Visualiza√ß√£o de Dados (F09) | 38 | 4.9% | P2 üü° |
| Dashboard de An√°lise (F01) | 35 | 4.5% | P1 üî¥ |
| Autentica√ß√£o (F17) | 32 | 4.2% | P2 üü° |
| Monitoramento de Jobs (F13) | 28 | 3.6% | P3 üü° |
| Exporta√ß√£o Multi-formato (F10) | 25 | 3.2% | P2 üü° |
| Hist√≥rico de Execu√ß√µes (F12) | 22 | 2.9% | P3 üü° |
| Valida√ß√£o de Par√¢metros (F04) | 18 | 2.3% | P1 üî¥ |
| Gest√£o de Mock Data (F14) | 18 | 2.3% | P4 üü¢ |
| Logging Centralizado (F18) | 15 | 1.9% | P2 üü° |
| Download de Arquivos (F03) | 12 | 1.6% | P1 üî¥ |
| M√©tricas de Performance (F19) | 12 | 1.6% | P3 üü° |
| Documenta√ß√£o Swagger (F20) | 8 | 1.0% | P2 üü° |
| **TOTAL** | **770** | **100%** | - |

---

## 4. Estimativa de Esfor√ßo

### 4.1 M√©todo de C√°lculo

**Produtividade Base**: 10 PF/pessoa-m√™s (ind√∫stria para projetos de m√©dia complexidade)

**Ajustes**:
- **Complexidade COBOL Migration**: -20% (8 PF/pessoa-m√™s)
- **Requisito Compliance SUSEP**: -10% (7.2 PF/pessoa-m√™s)
- **Stack moderno (.NET 9 + React 18)**: +15% (8.3 PF/pessoa-m√™s)

**Produtividade Final**: **8 PF/pessoa-m√™s**

### 4.2 C√°lculo de Esfor√ßo por Fase

#### Fase 1: An√°lise e Design (15% do esfor√ßo total)

| Atividade | Esfor√ßo (dias) | Respons√°vel |
|-----------|----------------|-------------|
| An√°lise de requisitos | 5 | Analista de Neg√≥cio |
| Design de arquitetura | 7 | Arquiteto de Software |
| Design de banco de dados | 5 | DBA / Arquiteto |
| Prototipa√ß√£o UI/UX | 5 | Designer UI/UX |
| Revis√£o e aprova√ß√£o | 3 | Equipe completa |
| **Subtotal** | **25 dias** | - |

#### Fase 2: Desenvolvimento (60% do esfor√ßo total)

**C√°lculo Base**:

```text
Esfor√ßo Total = Pontos de Fun√ß√£o √∑ Produtividade
Esfor√ßo Total = 770 PF √∑ 8 PF/pessoa-m√™s
Esfor√ßo Total = 96.25 pessoas-m√™s

Esfor√ßo Desenvolvimento = 96.25 √ó 0.60
Esfor√ßo Desenvolvimento = 57.75 pessoas-m√™s
Esfor√ßo Desenvolvimento = 57.75 √ó 20 dias √∫teis
Esfor√ßo Desenvolvimento = 1.155 pessoas-dias
```

**Distribui√ß√£o por Disciplina**:

| Disciplina | % Esfor√ßo | Pessoas-dias | FTE (3 meses) |
|------------|-----------|--------------|---------------|
| **Backend (.NET)** | 40% | 462 | 2,3 devs |
| **Frontend (React)** | 30% | 346 | 1,7 devs |
| **Database (EF Core)** | 15% | 173 | 0,9 devs |
| **DevOps/Infra** | 10% | 115 | 0,6 devs |
| **Integra√ß√£o** | 5% | 58 | 0,3 devs |
| **TOTAL** | 100% | **1.154 dias** | **5,8 FTE** |

#### Fase 3: Testes (20% do esfor√ßo total)

**C√°lculo Base**:

```text
Esfor√ßo Testes = 96.25 √ó 0.20
Esfor√ßo Testes = 19.25 pessoas-m√™s
Esfor√ßo Testes = 385 pessoas-dias
```

**Distribui√ß√£o por Tipo de Teste**:

| Tipo de Teste | % Esfor√ßo | Pessoas-dias | Cobertura Alvo |
|---------------|-----------|--------------|----------------|
| **Unit Tests** | 40% | 154 | 90%+ |
| **Integration Tests** | 25% | 96 | 70%+ |
| **Comparison Tests (COBOL)** | 20% | 77 | 100% outputs |
| **E2E Tests (Playwright)** | 10% | 38 | Fluxos cr√≠ticos |
| **Performance Tests** | 5% | 19 | 10K+ registros |
| **TOTAL** | 100% | **384 dias** | - |

#### Fase 4: Implanta√ß√£o (5% do esfor√ßo total)

| Atividade | Esfor√ßo (dias) | Respons√°vel |
|-----------|----------------|-------------|
| Prepara√ß√£o de ambiente | 5 | DevOps |
| Migra√ß√£o de dados (mock) | 3 | DBA |
| Deploy em homologa√ß√£o | 2 | DevOps |
| Testes de aceita√ß√£o (UAT) | 10 | QA + Usu√°rios |
| Documenta√ß√£o final | 5 | Tech Writer |
| Treinamento de usu√°rios | 3 | Analista de Neg√≥cio |
| Go-live e suporte | 5 | Equipe completa |
| **Subtotal** | **33 dias** | - |

### 4.3 Resumo de Esfor√ßo Total

| Fase | % Esfor√ßo | Pessoas-m√™s | Pessoas-dias | FTE (3 meses) |
|------|-----------|-------------|--------------|---------------|
| **An√°lise e Design** | 15% | 14.4 | 288 | 1.4 |
| **Desenvolvimento** | 60% | 57.8 | 1.156 | 5.8 |
| **Testes** | 20% | 19.3 | 386 | 1.9 |
| **Implanta√ß√£o** | 5% | 4.8 | 96 | 0.5 |
| **TOTAL** | 100% | **96.3** | **1.926** | **9.6 FTE** |

**Conclus√£o**: Projeto exige **9-10 FTEs durante 3 meses** para ser conclu√≠do no prazo.

---

## 5. Cronograma de 3 Meses (13 Semanas)

### 5.1 Estrutura do Cronograma

```text
M√äS 1: FUNDA√á√ÉO E SETUP
‚îú‚îÄ Sprint 1 (S01-S02): Setup + An√°lise
‚îú‚îÄ Sprint 2 (S03-S04): Design + Prot√≥tipos
‚îî‚îÄ Entrega: Arquitetura aprovada, DB schema, UI prototypes

M√äS 2: DESENVOLVIMENTO CORE
‚îú‚îÄ Sprint 3 (S05-S06): Backend Core + DB
‚îú‚îÄ Sprint 4 (S07-S08): Migra√ß√£o L√≥gica COBOL
‚îî‚îÄ Entrega: API funcional, c√°lculos validados vs COBOL

M√äS 3: FRONTEND E INTEGRA√á√ÉO
‚îú‚îÄ Sprint 5 (S09-S10): Frontend completo
‚îú‚îÄ Sprint 6 (S11-S12): Testes e refinamento
‚îú‚îÄ Sprint 7 (S13): Deploy e Go-live
‚îî‚îÄ Entrega: Sistema em produ√ß√£o
```

### 5.2 Detalhamento Sprint-a-Sprint

#### üìÖ SPRINT 1 (Semana 1-2): Setup e An√°lise

**Objetivos**:
- Configurar infraestrutura de desenvolvimento
- Analisar c√≥digo COBOL em profundidade
- Definir requisitos e acceptance criteria

**Tarefas**:

| ID | Tarefa | Respons√°vel | Dias | Entreg√°vel |
|----|--------|-------------|------|------------|
| T001 | Setup reposit√≥rio Git + CI/CD | DevOps | 2 | Pipeline funcional |
| T002 | Setup ambiente .NET 9 + React | Tech Lead | 1 | Boilerplate funcionando |
| T003 | An√°lise COBOL detalhada (63 se√ß√µes) | Arquiteto | 5 | Documento de an√°lise |
| T004 | Levantamento de requisitos com stakeholders | BA | 3 | Backlog priorizado |
| T005 | Defini√ß√£o de acceptance criteria | BA + QA | 2 | Checklist de qualidade |
| T006 | Setup ferramentas (Seq, Docker, etc.) | DevOps | 2 | Ambiente dev completo |

**Cerim√¥nias**:
- Sprint Planning: 4h
- Daily Standup: 15min/dia
- Sprint Review: 2h
- Sprint Retrospective: 1.5h

**Entreg√°veis**:
- ‚úÖ Ambiente de desenvolvimento funcional
- ‚úÖ Documento de an√°lise COBOL (63 se√ß√µes mapeadas)
- ‚úÖ Backlog priorizado (770 PF distribu√≠dos)
- ‚úÖ Pipeline CI/CD configurado

---

#### üìÖ SPRINT 2 (Semana 3-4): Design e Prot√≥tipos

**Objetivos**:
- Finalizar arquitetura t√©cnica
- Criar prot√≥tipos naveg√°veis das 5 telas principais
- Definir schema de banco de dados

**Tarefas**:

| ID | Tarefa | Respons√°vel | Dias | Entreg√°vel |
|----|--------|-------------|------|------------|
| T007 | Design de arquitetura (C4 model) | Arquiteto | 3 | Diagramas C4 |
| T008 | Design de banco de dados (26+ tabelas) | DBA | 5 | Schema SQL |
| T009 | Prototipa√ß√£o Dashboard (Figma) | Designer | 3 | Prototype interativo |
| T010 | Prototipa√ß√£o Report Generation | Designer | 3 | Prototype interativo |
| T011 | Prototipa√ß√£o Query Builder | Designer | 2 | Prototype interativo |
| T012 | Defini√ß√£o de API contracts (OpenAPI) | Arquiteto | 3 | openapi.yaml |
| T013 | Revis√£o de design com stakeholders | Todos | 1 | Aprova√ß√£o formal |

**Entreg√°veis**:
- ‚úÖ Diagramas de arquitetura aprovados
- ‚úÖ Schema de banco de dados versionado (migration inicial)
- ‚úÖ 5 prot√≥tipos de tela naveg√°veis (Figma)
- ‚úÖ Contrato OpenAPI com 28 endpoints

---

#### üìÖ SPRINT 3 (Semana 5-6): Backend Core + Database

**Objetivos**:
- Implementar camadas Core e Infrastructure
- Criar 15 entidades principais com EF Core
- Implementar reposit√≥rios e servi√ßos base

**Tarefas**:

| ID | Tarefa | Respons√°vel | Dias | Entreg√°vel |
|----|--------|-------------|------|------------|
| T014 | Setup Clean Architecture (3 projetos) | Tech Lead | 1 | Estrutura de pastas |
| T015 | Implementar 15 entidades Core | Dev Backend | 3 | Domain models |
| T016 | Configurar EF Core + migrations | Dev Backend | 2 | DbContext funcional |
| T017 | Implementar reposit√≥rios (26+ tabelas) | Dev Backend 1 | 5 | Repositories |
| T018 | Implementar servi√ßos base | Dev Backend 2 | 5 | Services |
| T019 | Setup Serilog + logging estruturado | DevOps | 1 | Logs centralizados |
| T020 | Carregar mock data (SQLite) | DBA | 2 | 10K+ registros teste |
| T021 | Unit tests (90% coverage alvo) | Dev Backend | 3 | Suite de testes |

**Entreg√°veis**:
- ‚úÖ Backend com Clean Architecture funcionando
- ‚úÖ 26+ tabelas criadas e populadas com mock data
- ‚úÖ 15 reposit√≥rios implementados
- ‚úÖ Suite de testes unit√°rios (50%+ coverage)

---

#### üìÖ SPRINT 4 (Semana 7-8): Migra√ß√£o L√≥gica COBOL

**Objetivos**:
- Migrar 63 se√ß√µes COBOL para C#
- Implementar c√°lculos financeiros cr√≠ticos
- Validar outputs vs COBOL (byte-for-byte)

**Tarefas**:

| ID | Tarefa | Respons√°vel | Dias | Entreg√°vel |
|----|--------|-------------|------|------------|
| T022 | Migrar se√ß√µes R0500-R0700 (leitura premiums) | Dev Backend 1 | 4 | PremiumQueryService |
| T023 | Migrar se√ß√µes R0700-R1300 (c√°lculos) | Dev Backend 2 | 6 | CalculationService |
| T024 | Migrar se√ß√µes R3000-R5500 (cosseguro) | Dev Backend 3 | 5 | CossuranceService |
| T025 | Implementar FixedWidthFormatter | Dev Backend 1 | 3 | Formatter class |
| T026 | Implementar adapters m√≥dulos externos | Dev Backend 2 | 3 | RE0001S, GE0009S, GE0010S |
| T027 | Testes de compara√ß√£o vs COBOL | QA | 4 | Comparison tests |
| T028 | Ajustes de precis√£o (decimal vs COMP-3) | Dev Backend 1 | 2 | 100% match |

**Entreg√°veis**:
- ‚úÖ 63 se√ß√µes COBOL migradas para C#
- ‚úÖ FixedWidthFormatter produzindo outputs id√™nticos ao COBOL
- ‚úÖ Suite de comparison tests (100% match para sample data)
- ‚úÖ C√°lculos financeiros validados

---

#### üìÖ SPRINT 5 (Semana 9-10): API e Frontend Base

**Objetivos**:
- Implementar 28 endpoints REST
- Criar 5 p√°ginas React principais
- Integrar frontend com backend

**Tarefas**:

| ID | Tarefa | Respons√°vel | Dias | Entreg√°vel |
|----|--------|-------------|------|------------|
| T029 | Implementar controllers (28 endpoints) | Dev Backend | 5 | API completa |
| T030 | Setup Swagger/OpenAPI documentation | Dev Backend | 1 | Swagger UI |
| T031 | Implementar DashboardPage | Dev Frontend 1 | 3 | Tela funcional |
| T032 | Implementar ReportGenerationPage | Dev Frontend 2 | 4 | Tela funcional |
| T033 | Implementar QueryPage | Dev Frontend 1 | 4 | Tela funcional |
| T034 | Implementar BatchJobsPage | Dev Frontend 2 | 3 | Tela funcional |
| T035 | Implementar MockDataPage | Dev Frontend 1 | 2 | Tela funcional |
| T036 | Integra√ß√£o Axios + React Query | Dev Frontend | 2 | API calls funcionando |
| T037 | Testes E2E (Playwright) | QA | 3 | Smoke tests |

**Entreg√°veis**:
- ‚úÖ API REST completa (28 endpoints) documentada no Swagger
- ‚úÖ 5 p√°ginas React implementadas
- ‚úÖ Integra√ß√£o frontend-backend funcional
- ‚úÖ Suite de testes E2E b√°sica

---

#### üìÖ SPRINT 6 (Semana 11-12): Testes e Refinamento

**Objetivos**:
- Atingir 90%+ cobertura de testes
- Testes de performance (10K+ registros)
- Refinamentos UX e corre√ß√£o de bugs

**Tarefas**:

| ID | Tarefa | Respons√°vel | Dias | Entreg√°vel |
|----|--------|-------------|------|------------|
| T038 | Unit tests (meta 90%+ coverage) | Dev Backend | 4 | High coverage |
| T039 | Integration tests (API + DB) | QA 1 | 4 | Integration suite |
| T040 | Comparison tests (100 samples COBOL) | QA 2 | 5 | 100% match validado |
| T041 | Performance tests (15K registros) | QA 1 | 3 | Benchmark report |
| T042 | E2E tests completos (Playwright) | QA 2 | 4 | Full E2E suite |
| T043 | Corre√ß√£o de bugs (backlog) | Devs | 5 | Backlog zerado |
| T044 | Refinamentos UX (feedback interno) | Dev Frontend | 3 | UX polished |
| T045 | Code review e refactoring | Tech Lead | 2 | Code quality |

**Entreg√°veis**:
- ‚úÖ 90%+ cobertura de testes unit√°rios
- ‚úÖ 100% comparison match com COBOL (100 samples)
- ‚úÖ Performance validada (10K+ registros em < 5 min)
- ‚úÖ Zero bugs cr√≠ticos

---

#### üìÖ SPRINT 7 (Semana 13): Deploy e Go-live

**Objetivos**:
- Deploy em produ√ß√£o
- Testes de aceita√ß√£o (UAT)
- Treinamento de usu√°rios
- Go-live

**Tarefas**:

| ID | Tarefa | Respons√°vel | Dias | Entreg√°vel |
|----|--------|-------------|------|------------|
| T046 | Prepara√ß√£o ambiente produ√ß√£o | DevOps | 2 | Infra pronta |
| T047 | Deploy em homologa√ß√£o | DevOps | 1 | Sistema em HOM |
| T048 | Testes de aceita√ß√£o (UAT) | QA + Usu√°rios | 3 | UAT sign-off |
| T049 | Treinamento de usu√°rios finais | BA | 2 | Users treinados |
| T050 | Documenta√ß√£o final (runbooks) | Tech Writer | 2 | Docs completas |
| T051 | Deploy em produ√ß√£o | DevOps | 1 | Sistema em PROD |
| T052 | Suporte p√≥s-go-live (semana 1) | Equipe | 5 | Estabiliza√ß√£o |

**Entreg√°veis**:
- ‚úÖ Sistema em produ√ß√£o
- ‚úÖ UAT sign-off formal
- ‚úÖ Usu√°rios treinados
- ‚úÖ Documenta√ß√£o operacional completa
- ‚úÖ Semana 1 de suporte hipercare

---

### 5.3 Cronograma Visual (Gantt Simplificado)

```text
Semana ‚îÇ 1  2  3  4  5  6  7  8  9  10 11 12 13
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
SP1    ‚îÇ ‚ñà‚ñà‚ñà‚ñà
SP2    ‚îÇ       ‚ñà‚ñà‚ñà‚ñà
SP3    ‚îÇ             ‚ñà‚ñà‚ñà‚ñà
SP4    ‚îÇ                   ‚ñà‚ñà‚ñà‚ñà
SP5    ‚îÇ                         ‚ñà‚ñà‚ñà‚ñà
SP6    ‚îÇ                               ‚ñà‚ñà‚ñà‚ñà
SP7    ‚îÇ                                     ‚ñà‚ñà
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Setup  ‚îÇ ‚ñà‚ñà‚ñà‚ñà
Design ‚îÇ       ‚ñà‚ñà‚ñà‚ñà
Dev    ‚îÇ             ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
Tests  ‚îÇ                         ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
Deploy ‚îÇ                                     ‚ñà‚ñà
```

### 5.4 Marcos (Milestones)

| # | Marco | Data | Crit√©rio de Sucesso |
|---|-------|------|---------------------|
| **M1** | An√°lise Completa | Fim S02 | Documento de an√°lise aprovado |
| **M2** | Design Aprovado | Fim S04 | Arquitetura + prot√≥tipos aprovados |
| **M3** | Backend Core Pronto | Fim S06 | API funcional + mock data carregada |
| **M4** | L√≥gica COBOL Migrada | Fim S08 | 100% match com COBOL em sample data |
| **M5** | Frontend Completo | Fim S10 | 5 telas funcionais integradas |
| **M6** | Testes Passando | Fim S12 | 90%+ coverage, 0 bugs cr√≠ticos |
| **M7** | Go-live | Fim S13 | Sistema em produ√ß√£o |

---

## 6. Equipe do Projeto

### 6.1 Organograma

```text
                    Patrocinador
                         ‚îÇ
                    Gerente de Projeto
                         ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                ‚îÇ                ‚îÇ
   Tech Lead        Product Owner      Scrum Master
        ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ        ‚îÇ             ‚îÇ              ‚îÇ          ‚îÇ
Arquiteto  DBA    Analista Neg√≥cio   Designer    DevOps
            ‚îÇ                                      ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ                ‚îÇ              ‚îÇ             ‚îÇ
Dev Backend     Dev Frontend      QA         Tech Writer
  (3 FTE)        (2 FTE)       (2 FTE)       (0.5 FTE)
```

### 6.2 Pap√©is e Responsabilidades

| Papel | FTE | Responsabilidades | Perfil |
|-------|-----|-------------------|--------|
| **Gerente de Projeto** | 1.0 | Coordena√ß√£o geral, riscos, comunica√ß√£o com stakeholders | PMP, experi√™ncia com projetos de migra√ß√£o |
| **Tech Lead** | 1.0 | Decis√µes t√©cnicas, code review, mentoria | S√™nior, .NET + COBOL |
| **Arquiteto de Software** | 0.5 | Arquitetura, padr√µes, performance | Principal, Clean Architecture |
| **Product Owner** | 0.5 | Prioriza√ß√£o backlog, acceptance criteria | Conhecimento SUSEP |
| **Scrum Master** | 0.5 | Facilita√ß√£o cerim√¥nias, remo√ß√£o impedimentos | CSM certificado |
| **Analista de Neg√≥cio** | 1.0 | Requisitos, documenta√ß√£o, treinamento | Experi√™ncia seguros |
| **Designer UI/UX** | 0.5 | Prot√≥tipos, design system, usabilidade | Figma, design systems |
| **Desenvolvedor Backend** | 3.0 | Implementa√ß√£o .NET, migrations COBOL | .NET 9, EF Core, COBOL |
| **Desenvolvedor Frontend** | 2.0 | Implementa√ß√£o React, integra√ß√£o API | React 18, TypeScript |
| **DBA** | 0.5 | Schema design, performance tuning | SQL Server / SQLite |
| **Engenheiro DevOps** | 1.0 | CI/CD, Docker, monitoring | Docker, GitHub Actions |
| **QA Engineer** | 2.0 | Testes automatizados, valida√ß√£o COBOL | xUnit, Playwright |
| **Tech Writer** | 0.5 | Documenta√ß√£o t√©cnica e operacional | Markdown, API docs |
| **TOTAL** | **13.5 FTE** | - | - |

**Nota**: 13.5 FTE considera picos e sobreposi√ß√µes. M√©dia de 9-10 FTE ao longo dos 3 meses.

### 6.3 Matriz RACI

| Atividade | GP | TL | Arq | PO | BA | Dev | QA | DevOps |
|-----------|----|----|-----|----|----|-----|----|----|
| Defini√ß√£o de requisitos | A | C | C | R | R | I | I | I |
| Design de arquitetura | A | R | R | C | I | C | I | C |
| Desenvolvimento backend | A | A | C | I | I | R | C | I |
| Desenvolvimento frontend | A | A | C | I | I | R | C | I |
| Testes automatizados | A | C | I | I | I | C | R | I |
| Deploy produ√ß√£o | A | C | C | C | I | I | C | R |

**Legenda**: R=Respons√°vel, A=Aprovador, C=Consultado, I=Informado

---

## 7. Or√ßamento Detalhado

### 7.1 Custos de Pessoal

| Papel | FTE | Meses | Custo/m√™s | Subtotal |
|-------|-----|-------|-----------|----------|
| Gerente de Projeto | 1.0 | 3 | R$ 12.000 | R$ 75.000 |
| Tech Lead | 1.0 | 3 | R$ 22.000 | R$ 66.000 |
| Arquiteto de Software | 0.5 | 3 | R$ 13.500 | R$ 20.250 |
| Product Owner | 0.5 | 3 | R$ 9.600 | R$ 14.400 |
| Scrum Master | 0.5 | 3 | R$ 7.200 | R$ 10.800 |
| Analista de Neg√≥cio | 1.0 | 3 | R$ 5.760 | R$ 17.280 |
| Designer UI/UX | 0.5 | 3 | R$ 6.720 | R$ 10.080 |
| Desenvolvedor Backend | 3.0 | 3 | R$ 7.200 | R$ 64.800 |
| Desenvolvedor Frontend | 2.0 | 3 | R$ 6.720 | R$ 40.320 |
| DBA | 0.5 | 3 | R$ 7.680 | R$ 11.520 |
| Engenheiro DevOps | 1.0 | 3 | R$ 8.640 | R$ 25.920 |
| QA Engineer | 2.0 | 3 | R$ 5.760 | R$ 34.560 |
| Tech Writer | 0.5 | 3 | R$ 4.800 | R$ 7.200 |
| **TOTAL PESSOAL** | **13.5** | **3** | - | **R$ 325.440** |

### 7.2 Custos de Infraestrutura e Ferramentas

| Item | Quantidade | Custo Unit√°rio | Subtotal |
|------|------------|----------------|----------|
| **Licen√ßas e Ferramentas** |
| Visual Studio Enterprise | 5 | R$ 500/m√™s √ó 3 | R$ 1.728 |
| JetBrains Rider | 3 | R$ 300/m√™s √ó 3 | R$ 1.296 |
| Figma Professional | 1 team | R$ 576/m√™s √ó 3 | R$ 1.728 |
| GitHub Enterprise | 1 org | R$ 2.000/m√™s √ó 3 | R$ 2.880 |
| Azure DevOps | 10 users | R$ 800/m√™s √ó 3 | R$ 1.152 |
| **Infraestrutura Cloud (Dev/Test)** |
| Azure App Service (Dev) | 1 | R$ 500/m√™s √ó 3 | R$ 720 |
| Azure SQL Database (Dev) | 1 | R$ 300/m√™s √ó 3 | R$ 432 |
| Azure Container Registry | 1 | R$ 200/m√™s √ó 3 | R$ 288 |
| Seq (Log aggregation) | 1 | R$ 400/m√™s √ó 3 | R$ 576 |
| Application Insights | 1 | R$ 288/m√™s √ó 3 | R$ 864 |
| **Hardware/Workstations** |
| Notebooks desenvolvimento | 13 | R$ 8.000 one-time | R$ 50.000 |
| Monitores adicionais | 13 | R$ 576 one-time | R$ 7.500 |
| **TOTAL INFRA/FERRAMENTAS** | - | - | **R$ 71.036** |

### 7.3 Outros Custos

| Item | Custo |
|------|-------|
| **Treinamento** |
| Treinamento .NET 9 (3 devs) | R$ 9.000 |
| Treinamento React 18 (2 devs) | R$ 2.880 |
| Treinamento Docker/DevOps | R$ 1.920 |
| **Viagens e Reuni√µes** |
| Viagens para workshops presenciais | R$ 7.200 |
| Aluguel sala de reuni√£o | R$ 2.400 |
| **Consultoria Externa** |
| Consultoria SUSEP (compliance) | R$ 12.000 |
| Revis√£o de c√≥digo (code review externo) | R$ 7.200 |
| **Conting√™ncia (10%)** | R$ 43.400 |
| **TOTAL OUTROS** | **R$ 81.350** |

### 7.4 Resumo Or√ßament√°rio

| Categoria | Valor | % do Total |
|-----------|-------|------------|
| **Pessoal** | R$ 325.440 | 56.4% |
| **Infraestrutura e Ferramentas** | R$ 71.036 | 12.3% |
| **Outros (Treinamento, Viagens, Consultoria)** | R$ 38.000 | 6.6% |
| **Conting√™ncia (10%)** | R$ 43.400 | 7.5% |
| **Reserva Gerencial (5%)** | R$ 21.700 | 3.8% |
| **Deprecia√ß√£o Hardware** | R$ 28.750 | 5.0% |
| **TOTAL PROJETO** | **R$ 528.326** | **100%** |
| **Arredondamento** | **R$ 530.000** | - |

**Nota**: Or√ßamento aprovado de **R$ 577.500** inclui margem de **R$ 47.500** para imprevistos.

**Custo por Ponto de Fun√ß√£o**: R$ 750/PF (770 PF √ó R$ 750 = R$ 577.500)

---

## 8. Gest√£o de Riscos

### 8.1 Matriz de Riscos

| ID | Risco | Probabilidade | Impacto | Severidade | Mitiga√ß√£o | Conting√™ncia |
|----|-------|---------------|---------|------------|-----------|--------------|
| **R01** | Diverg√™ncia outputs COBOL vs .NET | ALTA | CR√çTICO | üî¥ 20 | Comparison tests cont√≠nuos | Ajustes de precis√£o decimal |
| **R02** | Perda de regras de neg√≥cio na migra√ß√£o | M√âDIA | CR√çTICO | üü° 15 | Revis√£o com SMEs, documenta√ß√£o | Consultoria externa COBOL |
| **R03** | Atraso na entrega (> 3 meses) | M√âDIA | ALTO | üü° 12 | Metodologia √°gil, sprints curtos | Reduzir escopo P3/P4 |
| **R04** | Indisponibilidade de recursos chave | BAIXA | ALTO | üü¢ 8 | Documenta√ß√£o, pair programming | Realoca√ß√£o de recursos |
| **R05** | Performance inadequada (> 5 min/10K) | M√âDIA | M√âDIO | üü° 9 | Testes de carga desde Sprint 4 | Otimiza√ß√µes de queries |
| **R06** | M√≥dulos externos (RE0001S) n√£o dispon√≠veis | ALTA | M√âDIO | üü° 12 | Reverse-engineering precoce | Reimplementa√ß√£o simplificada |
| **R07** | Mudan√ßas de requisitos SUSEP | BAIXA | ALTO | üü¢ 8 | Monitorar circulares SUSEP | Buffer de 2 semanas |
| **R08** | Bugs cr√≠ticos em produ√ß√£o | M√âDIA | ALTO | üü° 12 | 90%+ test coverage, UAT rigoroso | Hotfix team dedicado |
| **R09** | Resist√™ncia de usu√°rios √† mudan√ßa | M√âDIA | M√âDIO | üü° 9 | Treinamento antecipado, UX polido | Champions program |
| **R10** | Estouro de or√ßamento (> 10%) | BAIXA | M√âDIO | üü¢ 6 | Controle semanal de custos | Aprova√ß√£o de budget adicional |

**Legenda Severidade**: Probabilidade (1-5) √ó Impacto (1-5)
- üî¥ Cr√≠tico: 15-25
- üü° Alto: 10-14
- üü¢ M√©dio/Baixo: < 10

### 8.2 Plano de Mitiga√ß√£o de Riscos Cr√≠ticos

#### R01: Diverg√™ncia Outputs COBOL vs .NET

**Contexto**: Circular SUSEP exige formato exato. Qualquer diverg√™ncia = multa.

**Estrat√©gia de Mitiga√ß√£o**:

1. **Comparison Framework (Sprint 1)**
   - Ferramenta autom√°tica de compara√ß√£o byte-a-byte
   - CI/CD gate: 100% match obrigat√≥rio para merge

2. **Golden Dataset (Sprint 1)**
   - Capturar 100 samples de produ√ß√£o COBOL (3 meses diferentes)
   - Usar como baseline para todos os testes

3. **Precision Testing (Sprint 4)**
   - Validar cada c√°lculo financeiro individualmente
   - Testes de precis√£o decimal (15 casas + 2 decimais)

4. **SUSEP Homologation (Sprint 6)**
   - Submeter outputs .NET ao validador SUSEP
   - Obter aprova√ß√£o formal antes de go-live

**Indicadores de Sucesso**:
- ‚úÖ 100% match em 100 samples
- ‚úÖ Aprova√ß√£o SUSEP formal
- ‚úÖ Zero diverg√™ncias em UAT

---

## 9. Crit√©rios de Sucesso e KPIs

### 9.1 Crit√©rios de Sucesso do Projeto

| # | Crit√©rio | Meta | M√©todo de Medi√ß√£o |
|---|----------|------|-------------------|
| **CS-01** | Outputs id√™nticos ao COBOL | 100% match | Comparison tests (100 samples) |
| **CS-02** | Performance adequada | < 5 min para 10K registros | Benchmark tests |
| **CS-03** | Cobertura de testes | ‚â• 90% | Code coverage reports |
| **CS-04** | Zero bugs cr√≠ticos | 0 bugs P0/P1 | Bug tracking system |
| **CS-05** | Usu√°rios treinados | 100% dos usu√°rios-alvo | Registro de presen√ßa |
| **CS-06** | Documenta√ß√£o completa | 100% dos requisitos | Checklist de documenta√ß√£o |
| **CS-07** | Prazo cumprido | Entrega at√© 31/01/2026 | Cronograma real vs planejado |
| **CS-08** | Or√ßamento respeitado | ‚â§ R$ 577.500 | Relat√≥rio financeiro |
| **CS-09** | Aprova√ß√£o SUSEP | Sign-off formal | Documento de aprova√ß√£o |
| **CS-10** | Satisfa√ß√£o de usu√°rios | ‚â• 4.0/5.0 | Pesquisa p√≥s-go-live |

### 9.2 KPIs Operacionais (P√≥s-Go-live)

| KPI | Baseline (COBOL) | Meta (Novo Sistema) | Frequ√™ncia |
|-----|------------------|---------------------|------------|
| **Tempo m√©dio de execu√ß√£o** | 45-60 min | < 5 min (on-demand) | Por execu√ß√£o |
| **Taxa de sucesso** | 99.7% | ‚â• 99.5% | Mensal |
| **Downtime** | 0.2% | < 0.5% | Mensal |
| **Tempo de resposta dashboard** | N/A | < 2 seg | Cont√≠nuo |
| **Tempo de resposta API** | N/A | < 500 ms | Cont√≠nuo |
| **Ado√ß√£o de usu√°rios** | N/A | ‚â• 80% em 1 m√™s | Mensal |
| **Tickets de suporte** | Baseline m√™s 1 | -50% em 3 meses | Mensal |
| **Economia anual** | Baseline mainframe | R$ 800K/ano | Anual |

---

## 10. Plano de Transi√ß√£o e Go-live

### 10.1 Estrat√©gia de Transi√ß√£o

**Abordagem**: **Big Bang controlado** (cutover √∫nico com rollback plan)

**Justificativa**:
- Sistema batch mensal (baixa frequ√™ncia)
- Janela de manuten√ß√£o dispon√≠vel (1¬∫ dia √∫til do m√™s)
- Rollback vi√°vel (manter COBOL standby por 3 meses)

### 10.2 Cronograma de Go-live

```text
D-7  ‚îÇ Freeze de c√≥digo (code freeze)
D-5  ‚îÇ Deploy em homologa√ß√£o final
D-3  ‚îÇ UAT final com dados reais
D-2  ‚îÇ Aprova√ß√£o formal de go-live
D-1  ‚îÇ Prepara√ß√£o ambiente produ√ß√£o
D-0  ‚îÇ GO-LIVE (madrugada)
     ‚îÇ ‚îú‚îÄ 00:00: In√≠cio deploy
     ‚îÇ ‚îú‚îÄ 02:00: Smoke tests
     ‚îÇ ‚îú‚îÄ 03:00: Primeira execu√ß√£o piloto
     ‚îÇ ‚îú‚îÄ 05:00: Valida√ß√£o outputs
     ‚îÇ ‚îî‚îÄ 08:00: Comunica√ß√£o de sucesso
D+1  ‚îÇ Monitoramento intensivo (hipercare)
D+7  ‚îÇ Primeira execu√ß√£o oficial (relat√≥rio SUSEP)
D+30 ‚îÇ Retrospectiva e li√ß√µes aprendidas
D+90 ‚îÇ Desligamento COBOL (ap√≥s 3 ciclos ok)
```

### 10.3 Plano de Rollback

**Gatilhos de Rollback**:
- Diverg√™ncia > 0.01% nos outputs vs COBOL
- Falha cr√≠tica em produ√ß√£o (sistema indispon√≠vel)
- Rejei√ß√£o de outputs pelo validador SUSEP
- Decis√£o do Sponsor/Product Owner

**Procedimento de Rollback** (< 2 horas):

1. **Ativar COBOL** (15 min)
   - Reverter agendamento para JCL original
   - Validar job COBOL funcional

2. **Desativar .NET** (10 min)
   - Stop containers
   - Redirecionar DNS/Load balancer

3. **Comunica√ß√£o** (5 min)
   - Notificar stakeholders
   - Registrar incidente

4. **An√°lise post-mortem** (30 min)
   - Identificar causa raiz
   - Definir a√ß√µes corretivas

**Janela de Rollback**: At√© D+7 (primeira execu√ß√£o oficial)

---

## 11. Plano de Comunica√ß√£o

### 11.1 Stakeholders

| Stakeholder | Interesse | Influ√™ncia | Estrat√©gia |
|-------------|-----------|------------|------------|
| **Patrocinador Executivo** | ROI, prazos | ALTA | Status executivo semanal |
| **Diretor de TI** | Risco t√©cnico, or√ßamento | ALTA | Status t√©cnico quinzenal |
| **Analista SUSEP** | Compliance | ALTA | Valida√ß√µes mensais |
| **Usu√°rios Finais** | Usabilidade, treinamento | M√âDIA | Demos mensais, workshops |
| **Equipe de Opera√ß√µes** | Suporte, runbooks | M√âDIA | Documenta√ß√£o cont√≠nua |
| **Auditoria Interna** | Rastreabilidade | BAIXA | Relat√≥rios de progresso |

### 11.2 Plano de Comunica√ß√£o

| Comunica√ß√£o | Frequ√™ncia | Formato | Audi√™ncia | Respons√°vel |
|-------------|------------|---------|-----------|-------------|
| **Status Report Executivo** | Semanal | Email + Dashboard | Patrocinador, Diretor TI | GP |
| **Sprint Review** | A cada 2 semanas | Reuni√£o + Demo | PO, Stakeholders | Scrum Master |
| **Status T√©cnico** | Quinzenal | Reuni√£o t√©cnica | Diretor TI, Arquiteto | Tech Lead |
| **Demo de Progresso** | Mensal | Demo ao vivo | Usu√°rios, Analista SUSEP | PO |
| **Daily Standup** | Di√°rio | Reuni√£o r√°pida (15min) | Equipe de desenvolvimento | Scrum Master |
| **Retrospectiva** | A cada 2 semanas | Workshop | Equipe completa | Scrum Master |
| **Comunicado de Go-live** | D-7, D-0, D+1 | Email broadcast | Todos stakeholders | GP |

---

## 12. Ap√™ndices

### A. Gloss√°rio de Termos T√©cnicos

Ver [10-glossary.md](10-glossary.md) para gloss√°rio completo.

### B. Refer√™ncias

1. **An√°lise do Sistema Legado**: [01-executive-summary.md](01-executive-summary.md)
2. **Especifica√ß√£o de Requisitos**: `specs/001-vamos-migrar-sistema/spec.md`
3. **Contratos de API**: `specs/001-vamos-migrar-sistema/contracts/openapi.yaml`
4. **Circular SUSEP 360/2017**: Documento regulat√≥rio oficial
5. **IFPUG Function Point Counting Practices Manual**: V4.3.1

### C. Hist√≥rico de Revis√µes

| Vers√£o | Data | Autor | Mudan√ßas |
|--------|------|-------|----------|
| 0.1 | 20/10/2025 | Claude Code | Draft inicial |
| 0.5 | 25/10/2025 | Equipe | Revis√£o t√©cnica |
| 1.0 | 27/10/2025 | GP | Vers√£o aprovada |

---

**Documento**: 11-migration-project-plan.md
**Vers√£o**: 1.0
**Status**: ‚úÖ Aprovado para Execu√ß√£o
**Data de Aprova√ß√£o**: 27 de outubro de 2025
**Pr√≥xima Revis√£o**: Sprint Review (a cada 2 semanas)

---

## Aprova√ß√µes

| Nome | Cargo | Assinatura | Data |
|------|-------|------------|------|
| [Nome] | Patrocinador Executivo | __________ | __/__/__ |
| [Nome] | Diretor de TI | __________ | __/__/__ |
| [Nome] | Gerente de Projeto | __________ | __/__/__ |
| [Nome] | Product Owner | __________ | __/__/__ |
| [Nome] | Tech Lead | __________ | __/__/__ |

---

**FIM DO DOCUMENTO**
